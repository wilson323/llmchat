# LLMChat 项目宪章 v1.0.0

**生效日期**: 2025-01-16  
**版本**: 1.0.0  
**状态**: 生效

---

## 核心原则

### 1. 质量优先原则

#### MUST (必须遵守)
- **TypeScript严格模式**: 启用strict: true，零编译错误容忍
- **测试覆盖率**: 整体≥80%，核心模块（Auth, Chat, Agent）≥90%
- **错误处理**: 所有API端点必须有完整的错误处理和标准化错误响应
- **代码审查**: 所有PR必须经过至少1人审查通过

#### SHOULD (应该遵守)
- 代码复杂度控制：函数圈复杂度<10
- 文档覆盖：所有公共API有JSDoc注释
- 性能监控：关键路径有性能指标追踪

---

### 2. 安全第一原则

#### MUST (必须遵守)
- **身份认证**: JWT token认证，算法HS256，过期时间1小时
- **密码安全**: bcrypt哈希，salt rounds = 10，禁止明文存储
- **输入验证**: 所有用户输入必须验证和清理，防止注入攻击
- **敏感信息管理**: API密钥、数据库密码等通过环境变量管理，禁止硬编码
- **HTTPS**: 生产环境强制使用HTTPS

#### SHOULD (应该遵守)
- 定期安全扫描：使用npm audit检查依赖漏洞
- 日志脱敏：日志中自动屏蔽密码、token等敏感信息
- 速率限制：API端点实施合理的速率限制

---

### 3. 真实环境原则

#### MUST (必须遵守)
- **禁止模拟数据**: 开发和测试必须使用真实API和数据库
- **禁止模拟服务**: 集成测试必须连接真实的外部服务（或官方测试环境）
- **端到端验证**: 所有功能必须在真实环境中验证通过

#### SHOULD (应该遵守)
- 使用Docker容器提供一致的开发环境
- 建立staging环境进行预生产测试

---

### 4. 文档即代码原则

#### MUST (必须遵守)
- **同步更新**: 代码变更时必须同步更新相关文档
- **API规范**: API变更必须更新OpenAPI/Swagger规范
- **架构图**: 使用Mermaid维护架构图，禁止使用二进制图片
- **变更日志**: 遵循Keep a Changelog格式，使用Conventional Commits

#### SHOULD (应该遵守)
- README包含快速开始指南
- 关键决策记录在ADR（Architecture Decision Records）
- 复杂算法有详细注释和示例

---

### 5. 渐进增强原则

#### MUST (必须遵守)
- **MVP优先**: 先实现核心功能，确保基本可用
- **可测试性**: 每个功能必须可独立测试
- **向后兼容**: API变更必须保持向后兼容或提供迁移路径

#### SHOULD (应该遵守)
- 功能开关：使用feature flags控制新功能发布
- 灰度发布：重大变更采用灰度发布策略
- 用户反馈：根据真实用户反馈调整优先级

---

## 开发流程规范

### 代码提交规范
- **Commit Message**: 遵循Conventional Commits（feat/fix/docs/style/refactor/test/chore）
- **PR标题**: 清晰描述变更内容
- **PR描述**: 包含变更原因、影响范围、测试证据

### 质量门禁
在合并到main分支前，必须满足：
1. ✅ TypeScript编译无错误
2. ✅ ESLint检查无错误
3. ✅ 所有测试通过
4. ✅ 测试覆盖率≥80%
5. ✅ 至少1人代码审查批准
6. ✅ CI/CD流水线通过

### 发布流程
1. 更新版本号（语义化版本）
2. 更新CHANGELOG.md
3. 创建Git tag
4. 自动化部署到生产环境
5. 部署后健康检查

---

## 技术债务管理

### 技术债务记录
- 使用GitHub Issues标记technical-debt标签
- 每个技术债务必须评估影响和优先级
- 每个Sprint预留20%时间处理技术债务

### 重构原则
- **童子军规则**: 离开代码时比接手时更干净
- **小步重构**: 避免大规模重构，采用小步迭代
- **测试保护**: 重构前必须有充足的测试覆盖

---

## 例外处理

### 紧急修复
生产环境严重问题可以绕过部分流程：
- 可以跳过代码审查，但事后必须补充
- 可以降低测试覆盖率要求，但事后必须补充测试
- 必须在24小时内创建事后分析报告

### 实验性功能
标记为experimental的功能可以：
- 降低测试覆盖率要求至60%
- 使用feature flag控制，默认关闭
- 文档中明确标注实验性质

---

## 宪章修订

### 修订流程
1. 提出修订PR，说明原因和影响
2. 团队讨论和投票（≥2/3同意）
3. 更新版本号和生效日期
4. 全员通知和培训

### 版本历史
- v1.0.0 (2025-01-16): 初始版本

---

**维护者**: LLMChat 开发团队  
**最后更新**: 2025-01-16

