#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” è¿è¡Œè´¨é‡é—¨ç¦æ£€æŸ¥..."

# 1. TypeScriptç±»å‹æ£€æŸ¥
echo "ğŸ“ TypeScriptç±»å‹æ£€æŸ¥..."
if ! pnpm run type-check; then
  echo "âŒ TypeScriptç±»å‹æ£€æŸ¥å¤±è´¥"
  exit 1
fi
echo "âœ… TypeScriptç±»å‹æ£€æŸ¥é€šè¿‡"

# 2. ä»£ç è´¨é‡æ£€æŸ¥
echo "ğŸ”§ ESLintä»£ç è´¨é‡æ£€æŸ¥..."
if ! pnpm run lint; then
  echo "âŒ ESLintä»£ç è´¨é‡æ£€æŸ¥å¤±è´¥"
  exit 1
fi
echo "âœ… ESLintä»£ç è´¨é‡æ£€æŸ¥é€šè¿‡"

# 3. æµ‹è¯•è¿è¡Œ
echo "ğŸ§ª è¿è¡Œæµ‹è¯•å¥—ä»¶..."
if ! pnpm run test -- --passWithNoTests; then
  echo "âŒ æµ‹è¯•è¿è¡Œå¤±è´¥"
  exit 1
fi
echo "âœ… æµ‹è¯•å¥—ä»¶é€šè¿‡"

# 4. æ„å»ºéªŒè¯
echo "ğŸ—ï¸ æ„å»ºéªŒè¯..."
if ! pnpm run build; then
  echo "âŒ æ„å»ºå¤±è´¥"
  exit 1
fi
echo "âœ… æ„å»ºéªŒè¯é€šè¿‡"

# 5. å®‰å…¨æ£€æŸ¥
echo "ğŸ›¡ï¸ ä¾èµ–å®‰å…¨æ£€æŸ¥..."
if ! pnpm audit --audit-level moderate; then
  echo "âŒ ä¾èµ–å®‰å…¨æ£€æŸ¥å¤±è´¥"
  echo "ğŸ’¡ è¯·è¿è¡Œ 'pnpm audit fix' ä¿®å¤å®‰å…¨é—®é¢˜"
  exit 1
fi
echo "âœ… å®‰å…¨æ£€æŸ¥é€šè¿‡"

echo "ğŸ‰ æ‰€æœ‰è´¨é‡é—¨ç¦æ£€æŸ¥é€šè¿‡ï¼æäº¤æˆåŠŸã€‚"