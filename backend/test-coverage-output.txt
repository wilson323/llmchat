
> @llmchat/backend@1.0.0 test:coverage F:\ss\aa\sssss\llmchat\backend
> c8 npm test

node.exe : npm warn Unknown env config "cache-dir". This will stop working in the next major version of npm.
At C:\Users\wss\AppData\Roaming\npm\pnpm.ps1:24 char:5
+     & "node$exe"  "$basedir/node_modules/pnpm/bin/pnpm.cjs" $args
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (npm warn Unknow...version of npm.:String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
 
npm warn Unknown env config "store-dir". This will stop working in the next major version of npm.

> @llmchat/backend@1.0.0 test
> jest --runInBand

FAIL src/__tests__/services/SmartCacheService.test.ts (20.396 s)
  ● SmartCacheService › Basic Cache Operations › should return cached value without calling fallback

    expect(received).toBe(expected) // Object.is equality

    Expected: "cached-value"
    Received: "test-value"

    [0m [90m 48 |[39m       [36mconst[39m result [33m=[39m [36mawait[39m service[33m.[39mgetOrSet([
32m'test-key'[39m[33m,[39m fallback[33m,[39m [33mCacheConfigs[39m[33m.[39m[33mAGENTS_LIST[39m)[33m;
[39m
     [90m 49 |[39m
    [31m[1m>[22m[39m[90m 50 |[39m       expect(result)[33m.[39mtoBe([32m'cached-value'[39m)[33m;[39
m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 51 |[39m       expect(fallback)[33m.[39mnot[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m 52 |[39m     })[33m;[39m
     [90m 53 |[39m[0m

      at Object.<anonymous> (src/__tests__/services/SmartCacheService.test.ts:50:22)

  ● SmartCacheService › Basic Cache Operations › should use memory cache for repeated requests

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 1
    Received number of calls: 0

    [0m [90m 66 |[39m       expect(result1)[33m.[39mtoBe([32m'test-value'[39m)[33m;[39m
     [90m 67 |[39m       expect(result2)[33m.[39mtoBe([32m'test-value'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 68 |[39m       expect(fallback)[33m.[39mtoHaveBeenCalledTimes([35m1[39m)[33
m;[39m
     [90m    |[39m                        [31m[1m^[22m[39m
     [90m 69 |[39m       expect(mockCacheService[33m.[39m[36mget[39m)[33m.[39mtoHaveBeenCalledTimes([3
5m1[39m)[33m;[39m [90m// 只查询Redis一次[39m
     [90m 70 |[39m     })[33m;[39m
     [90m 71 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/services/SmartCacheService.test.ts:68:24)

  ● SmartCacheService › Cache Invalidation › should invalidate by pattern

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 89 |[39m       [36mconst[39m invalidated [33m=[39m [36mawait[39m service[33m.[39minvali
datePattern([32m'user:sessions'[39m)[33m;[39m
     [90m 90 |[39m
    [31m[1m>[22m[39m[90m 91 |[39m       expect(invalidated)[33m.[39mtoBeGreaterThan([35m0[39m)[33m;
[39m
     [90m    |[39m                           [31m[1m^[22m[39m
     [90m 92 |[39m       expect(mockCacheService[33m.[39mdel)[33m.[39mtoHaveBeenCalled()[33m;[39m
     [90m 93 |[39m     })[33m;[39m
     [90m 94 |[39m[0m

      at Object.<anonymous> (src/__tests__/services/SmartCacheService.test.ts:91:27)

FAIL src/__tests__/integration/agentController.integration.test.ts
  ● Test suite failed to run

    [96msrc/__tests__/integration/agentController.integration.test.ts[0m:[93m748[0m:[93m32[0m - [91merro
r[0m[90m TS7052: [0mElement implicitly has an 'any' type because type 'TestAgent<Test>' has no index signatu
re. Did you mean to call 'get'?

    [7m748[0m         const response = await request(app)[endpoint.method](endpoint.path);
    [7m   [0m [91m                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m

FAIL src/__tests__/integration/queueManager.integration.test.ts
  ● Test suite failed to run

    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m19[0m:[93m3[0m - [91merror[0m
[90m TS2375: [0mType '{ name: string; concurrency: number; maxRetries: number; retryDelay: number; backoffMul
tiplier: number; removeOnComplete: number; removeOnFail: number; defaultPriority: MessagePriority; ... 5 more .
..; visibilityTimeout: number; }' is not assignable to type 'QueueConfig' with 'exactOptionalPropertyTypes: tru
e'. Consider adding 'undefined' to the types of the target's properties.
      Types of property 'deadLetterQueue' are incompatible.
        Type 'string | undefined' is not assignable to type 'string'.
          Type 'undefined' is not assignable to type 'string'.

    [7m19[0m   return {
    [7m  [0m [91m  ~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m66[0m:[93m7[0m - [91merror[0m
[90m TS2739: [0mType 'Redis' is missing the following properties from type '{ host: string; port: number; pas
sword?: string; db?: number; keyPrefix?: string; }': host, port

    [7m66[0m       redis,
    [7m  [0m [91m      ~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m123[0m:[93m19[0m - [91merror[
0m[90m TS1361: [0m'MessagePriority' cannot be used as a value because it was imported using 'import type'.

    [7m123[0m         priority: MessagePriority.NORMAL,
    [7m   [0m [91m                  ~~~~~~~~~~~~~~~[0m

      [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m15[0m:[93m28[0m
        [7m15[0m import type { QueueConfig, MessagePriority } from '../../types/queue';
        [7m  [0m [96m                           ~~~~~~~~~~~~~~~[0m
        'MessagePriority' was imported here.
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m239[0m:[93m21[0m - [91merror[
0m[90m TS2339: [0mProperty 'queueName' does not exist on type 'QueueStats'.

    [7m239[0m       expect(stats!.queueName).toBe(testQueueName);
    [7m   [0m [91m                    ~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m299[0m:[93m63[0m - [91merror[
0m[90m TS1361: [0m'MessagePriority' cannot be used as a value because it was imported using 'import type'.

    [7m299[0m       await queueOpsService.addJob(testQueueName, { priority: MessagePriority.LOW }, { priority
: MessagePriority.LOW });
    [7m   [0m [91m                                                              ~~~~~~~~~~~~~~~[0m

      [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m15[0m:[93m28[0m
        [7m15[0m import type { QueueConfig, MessagePriority } from '../../types/queue';
        [7m  [0m [96m                           ~~~~~~~~~~~~~~~[0m
        'MessagePriority' was imported here.
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m299[0m:[93m98[0m - [91merror[
0m[90m TS1361: [0m'MessagePriority' cannot be used as a value because it was imported using 'import type'.

    [7m299[0m       await queueOpsService.addJob(testQueueName, { priority: MessagePriority.LOW }, { priority
: MessagePriority.LOW });
    [7m   [0m [91m                                                                                          
       ~~~~~~~~~~~~~~~[0m

      [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m15[0m:[93m28[0m
        [7m15[0m import type { QueueConfig, MessagePriority } from '../../types/queue';
        [7m  [0m [96m                           ~~~~~~~~~~~~~~~[0m
        'MessagePriority' was imported here.
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m300[0m:[93m63[0m - [91merror[
0m[90m TS1361: [0m'MessagePriority' cannot be used as a value because it was imported using 'import type'.

    [7m300[0m       await queueOpsService.addJob(testQueueName, { priority: MessagePriority.NORMAL }, { prior
ity: MessagePriority.NORMAL });
    [7m   [0m [91m                                                              ~~~~~~~~~~~~~~~[0m

      [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m15[0m:[93m28[0m
        [7m15[0m import type { QueueConfig, MessagePriority } from '../../types/queue';
        [7m  [0m [96m                           ~~~~~~~~~~~~~~~[0m
        'MessagePriority' was imported here.
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m300[0m:[93m101[0m - [91merror
[0m[90m TS1361: [0m'MessagePriority' cannot be used as a value because it was imported using 'import type'.

    [7m300[0m       await queueOpsService.addJob(testQueueName, { priority: MessagePriority.NORMAL }, { prior
ity: MessagePriority.NORMAL });
    [7m   [0m [91m                                                                                          
          ~~~~~~~~~~~~~~~[0m

      [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m15[0m:[93m28[0m
        [7m15[0m import type { QueueConfig, MessagePriority } from '../../types/queue';
        [7m  [0m [96m                           ~~~~~~~~~~~~~~~[0m
        'MessagePriority' was imported here.
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m301[0m:[93m63[0m - [91merror[
0m[90m TS1361: [0m'MessagePriority' cannot be used as a value because it was imported using 'import type'.

    [7m301[0m       await queueOpsService.addJob(testQueueName, { priority: MessagePriority.HIGH }, { priorit
y: MessagePriority.HIGH });
    [7m   [0m [91m                                                              ~~~~~~~~~~~~~~~[0m

      [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m15[0m:[93m28[0m
        [7m15[0m import type { QueueConfig, MessagePriority } from '../../types/queue';
        [7m  [0m [96m                           ~~~~~~~~~~~~~~~[0m
        'MessagePriority' was imported here.
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m301[0m:[93m99[0m - [91merror[
0m[90m TS1361: [0m'MessagePriority' cannot be used as a value because it was imported using 'import type'.

    [7m301[0m       await queueOpsService.addJob(testQueueName, { priority: MessagePriority.HIGH }, { priorit
y: MessagePriority.HIGH });
    [7m   [0m [91m                                                                                          
        ~~~~~~~~~~~~~~~[0m

      [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m15[0m:[93m28[0m
        [7m15[0m import type { QueueConfig, MessagePriority } from '../../types/queue';
        [7m  [0m [96m                           ~~~~~~~~~~~~~~~[0m
        'MessagePriority' was imported here.
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m302[0m:[93m63[0m - [91merror[
0m[90m TS1361: [0m'MessagePriority' cannot be used as a value because it was imported using 'import type'.

    [7m302[0m       await queueOpsService.addJob(testQueueName, { priority: MessagePriority.CRITICAL }, { pri
ority: MessagePriority.CRITICAL });
    [7m   [0m [91m                                                              ~~~~~~~~~~~~~~~[0m

      [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m15[0m:[93m28[0m
        [7m15[0m import type { QueueConfig, MessagePriority } from '../../types/queue';
        [7m  [0m [96m                           ~~~~~~~~~~~~~~~[0m
        'MessagePriority' was imported here.
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m302[0m:[93m103[0m - [91merror
[0m[90m TS1361: [0m'MessagePriority' cannot be used as a value because it was imported using 'import type'.

    [7m302[0m       await queueOpsService.addJob(testQueueName, { priority: MessagePriority.CRITICAL }, { pri
ority: MessagePriority.CRITICAL });
    [7m   [0m [91m                                                                                          
            ~~~~~~~~~~~~~~~[0m

      [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m15[0m:[93m28[0m
        [7m15[0m import type { QueueConfig, MessagePriority } from '../../types/queue';
        [7m  [0m [96m                           ~~~~~~~~~~~~~~~[0m
        'MessagePriority' was imported here.
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m305[0m:[93m43[0m - [91merror[
0m[90m TS1361: [0m'MessagePriority' cannot be used as a value because it was imported using 'import type'.

    [7m305[0m       expect(distribution).toHaveProperty(MessagePriority.LOW);
    [7m   [0m [91m                                          ~~~~~~~~~~~~~~~[0m

      [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m15[0m:[93m28[0m
        [7m15[0m import type { QueueConfig, MessagePriority } from '../../types/queue';
        [7m  [0m [96m                           ~~~~~~~~~~~~~~~[0m
        'MessagePriority' was imported here.
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m305[0m:[93m43[0m - [91merror[
0m[90m TS2345: [0mArgument of type 'import("F:/ss/aa/sssss/llmchat/backend/src/types/queue").MessagePriority'
 is not assignable to parameter of type 'string | readonly any[]'.

    [7m305[0m       expect(distribution).toHaveProperty(MessagePriority.LOW);
    [7m   [0m [91m                                          ~~~~~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m306[0m:[93m43[0m - [91merror[
0m[90m TS1361: [0m'MessagePriority' cannot be used as a value because it was imported using 'import type'.

    [7m306[0m       expect(distribution).toHaveProperty(MessagePriority.NORMAL);
    [7m   [0m [91m                                          ~~~~~~~~~~~~~~~[0m

      [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m15[0m:[93m28[0m
        [7m15[0m import type { QueueConfig, MessagePriority } from '../../types/queue';
        [7m  [0m [96m                           ~~~~~~~~~~~~~~~[0m
        'MessagePriority' was imported here.
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m306[0m:[93m43[0m - [91merror[
0m[90m TS2345: [0mArgument of type 'import("F:/ss/aa/sssss/llmchat/backend/src/types/queue").MessagePriority'
 is not assignable to parameter of type 'string | readonly any[]'.

    [7m306[0m       expect(distribution).toHaveProperty(MessagePriority.NORMAL);
    [7m   [0m [91m                                          ~~~~~~~~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m307[0m:[93m43[0m - [91merror[
0m[90m TS1361: [0m'MessagePriority' cannot be used as a value because it was imported using 'import type'.

    [7m307[0m       expect(distribution).toHaveProperty(MessagePriority.HIGH);
    [7m   [0m [91m                                          ~~~~~~~~~~~~~~~[0m

      [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m15[0m:[93m28[0m
        [7m15[0m import type { QueueConfig, MessagePriority } from '../../types/queue';
        [7m  [0m [96m                           ~~~~~~~~~~~~~~~[0m
        'MessagePriority' was imported here.
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m307[0m:[93m43[0m - [91merror[
0m[90m TS2345: [0mArgument of type 'import("F:/ss/aa/sssss/llmchat/backend/src/types/queue").MessagePriority'
 is not assignable to parameter of type 'string | readonly any[]'.

    [7m307[0m       expect(distribution).toHaveProperty(MessagePriority.HIGH);
    [7m   [0m [91m                                          ~~~~~~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m308[0m:[93m43[0m - [91merror[
0m[90m TS1361: [0m'MessagePriority' cannot be used as a value because it was imported using 'import type'.

    [7m308[0m       expect(distribution).toHaveProperty(MessagePriority.CRITICAL);
    [7m   [0m [91m                                          ~~~~~~~~~~~~~~~[0m

      [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m15[0m:[93m28[0m
        [7m15[0m import type { QueueConfig, MessagePriority } from '../../types/queue';
        [7m  [0m [96m                           ~~~~~~~~~~~~~~~[0m
        'MessagePriority' was imported here.
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m308[0m:[93m43[0m - [91merror[
0m[90m TS2345: [0mArgument of type 'import("F:/ss/aa/sssss/llmchat/backend/src/types/queue").MessagePriority'
 is not assignable to parameter of type 'string | readonly any[]'.

    [7m308[0m       expect(distribution).toHaveProperty(MessagePriority.CRITICAL);
    [7m   [0m [91m                                          ~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m309[0m:[93m27[0m - [91merror[
0m[90m TS1361: [0m'MessagePriority' cannot be used as a value because it was imported using 'import type'.

    [7m309[0m       expect(distribution[MessagePriority.LOW]).toBe(1);
    [7m   [0m [91m                          ~~~~~~~~~~~~~~~[0m

      [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m15[0m:[93m28[0m
        [7m15[0m import type { QueueConfig, MessagePriority } from '../../types/queue';
        [7m  [0m [96m                           ~~~~~~~~~~~~~~~[0m
        'MessagePriority' was imported here.
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m310[0m:[93m27[0m - [91merror[
0m[90m TS1361: [0m'MessagePriority' cannot be used as a value because it was imported using 'import type'.

    [7m310[0m       expect(distribution[MessagePriority.NORMAL]).toBe(1);
    [7m   [0m [91m                          ~~~~~~~~~~~~~~~[0m

      [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m15[0m:[93m28[0m
        [7m15[0m import type { QueueConfig, MessagePriority } from '../../types/queue';
        [7m  [0m [96m                           ~~~~~~~~~~~~~~~[0m
        'MessagePriority' was imported here.
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m311[0m:[93m27[0m - [91merror[
0m[90m TS1361: [0m'MessagePriority' cannot be used as a value because it was imported using 'import type'.

    [7m311[0m       expect(distribution[MessagePriority.HIGH]).toBe(1);
    [7m   [0m [91m                          ~~~~~~~~~~~~~~~[0m

      [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m15[0m:[93m28[0m
        [7m15[0m import type { QueueConfig, MessagePriority } from '../../types/queue';
        [7m  [0m [96m                           ~~~~~~~~~~~~~~~[0m
        'MessagePriority' was imported here.
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m312[0m:[93m27[0m - [91merror[
0m[90m TS1361: [0m'MessagePriority' cannot be used as a value because it was imported using 'import type'.

    [7m312[0m       expect(distribution[MessagePriority.CRITICAL]).toBe(1);
    [7m   [0m [91m                          ~~~~~~~~~~~~~~~[0m

      [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m15[0m:[93m28[0m
        [7m15[0m import type { QueueConfig, MessagePriority } from '../../types/queue';
        [7m  [0m [96m                           ~~~~~~~~~~~~~~~[0m
        'MessagePriority' was imported here.
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m399[0m:[93m50[0m - [91merror[
0m[90m TS2345: [0mArgument of type 'string | undefined' is not assignable to parameter of type 'string'.
      Type 'undefined' is not assignable to type 'string'.

    [7m399[0m       queueManager.createQueue(createQueueConfig(queueNames[1]));
    [7m   [0m [91m                                                 ~~~~~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m402[0m:[93m9[0m - [91merror[0
m[90m TS2464: [0mA computed property name must be of type 'string', 'number', 'symbol', or 'any'.

    [7m402[0m         [queueNames[0]]: { concurrency: 2 },
    [7m   [0m [91m        ~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m403[0m:[93m9[0m - [91merror[0
m[90m TS2464: [0mA computed property name must be of type 'string', 'number', 'symbol', or 'any'.

    [7m403[0m         [queueNames[1]]: { concurrency: 1 },
    [7m   [0m [91m        ~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m406[0m:[93m48[0m - [91merror[
0m[90m TS2345: [0mArgument of type 'string | undefined' is not assignable to parameter of type 'string | read
only any[]'.
      Type 'undefined' is not assignable to type 'string | readonly any[]'.

    [7m406[0m       expect(batchHealthStatus).toHaveProperty(queueNames[0]);
    [7m   [0m [91m                                               ~~~~~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m407[0m:[93m48[0m - [91merror[
0m[90m TS2345: [0mArgument of type 'string | undefined' is not assignable to parameter of type 'string | read
only any[]'.
      Type 'undefined' is not assignable to type 'string | readonly any[]'.

    [7m407[0m       expect(batchHealthStatus).toHaveProperty(queueNames[1]);
    [7m   [0m [91m                                               ~~~~~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m463[0m:[93m10[0m - [91merror[
0m[90m TS2554: [0mExpected 2 arguments, but got 3.

    [7m463[0m       }, {
    [7m   [0m [91m         ~[0m
    [7m464[0m         alertThresholds: {
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m469[0m         },
    [7m   [0m [91m~~~~~~~~~~[0m
    [7m470[0m       });
    [7m   [0m [91m~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m506[0m:[93m16[0m - [91merror[
0m[90m TS2532: [0mObject is possibly 'undefined'.

    [7m506[0m         expect(history[i].timestamp).toBeGreaterThanOrEqual(history[i - 1].timestamp);
    [7m   [0m [91m               ~~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m506[0m:[93m61[0m - [91merror[
0m[90m TS2532: [0mObject is possibly 'undefined'.

    [7m506[0m         expect(history[i].timestamp).toBeGreaterThanOrEqual(history[i - 1].timestamp);
    [7m   [0m [91m                                                            ~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m529[0m:[93m31[0m - [91merror[
0m[90m TS2554: [0mExpected 2-3 arguments, but got 1.

    [7m529[0m         await queueOpsService.addJob(queueName));
    [7m   [0m [91m                              ~~~~~~[0m

      [96msrc/services/QueueOperationsService.ts[0m:[93m33[0m:[93m5[0m
        [7m33[0m     data: T,
        [7m  [0m [96m    ~~~~~~~[0m
        An argument for 'data' was not provided.
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m532[0m:[93m36[0m - [91merror[
0m[90m TS2304: [0mCannot find name 'queueName'.

    [7m532[0m           .get(`/api/queue/stats/${queueName}`)
    [7m   [0m [91m                                   ~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m537[0m:[93m64[0m - [91merror[
0m[90m TS2304: [0mCannot find name 'queueName'.

    [7m537[0m         expect(response.body.data).toHaveProperty('queueName', queueName);
    [7m   [0m [91m                                                               ~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m615[0m:[93m31[0m - [91merror[
0m[90m TS2554: [0mExpected 2-3 arguments, but got 1.

    [7m615[0m         await queueOpsService.addJob(queueName));
    [7m   [0m [91m                              ~~~~~~[0m

      [96msrc/services/QueueOperationsService.ts[0m:[93m33[0m:[93m5[0m
        [7m33[0m     data: T,
        [7m  [0m [96m    ~~~~~~~[0m
        An argument for 'data' was not provided.
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m616[0m:[93m38[0m - [91merror[
0m[90m TS2304: [0mCannot find name 'queueName'.

    [7m616[0m         await queueOpsService.addJob(queueName, { test: true });
    [7m   [0m [91m                                     ~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m620[0m:[93m31[0m - [91merror[
0m[90m TS2304: [0mCannot find name 'queueName'.

    [7m620[0m           .post(`/api/queue/${queueName}/clear`)
    [7m   [0m [91m                              ~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m628[0m:[93m61[0m - [91merror[
0m[90m TS2304: [0mCannot find name 'queueName'.

    [7m628[0m         const stats = await queueStatsService.getQueueStats(queueName);
    [7m   [0m [91m                                                            ~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m641[0m:[93m27[0m - [91merror[
0m[90m TS2304: [0mCannot find name 'queueStatsService'.

    [7m641[0m       const stats = await queueStatsService.getQueueStats(nonExistentQueue);
    [7m   [0m [91m                          ~~~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m645[0m:[93m34[0m - [91merror[
0m[90m TS2304: [0mCannot find name 'queueHealthService'.

    [7m645[0m       const healthStatus = await queueHealthService.performHealthCheck(nonExistentQueue);
    [7m   [0m [91m                                 ~~~~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m651[0m:[93m21[0m - [91merror[
0m[90m TS2304: [0mCannot find name 'app'.

    [7m651[0m       await request(app)
    [7m   [0m [91m                    ~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m653[0m:[93m41[0m - [91merror[
0m[90m TS2304: [0mCannot find name 'authToken'.

    [7m653[0m         .set('Authorization', `Bearer ${authToken}`)
    [7m   [0m [91m                                        ~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m668[0m:[93m7[0m - [91merror[0
m[90m TS2552: [0mCannot find name 'queueManager'. Did you mean 'QueueManager'?

    [7m668[0m       queueManager.createQueue(createQueueConfig(queueName);
    [7m   [0m [91m      ~~~~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m671[0m:[93m27[0m - [91merror[
0m[90m TS2304: [0mCannot find name 'queueOpsService'.

    [7m671[0m       const jobId = await queueOpsService.addJob(queueName));
    [7m   [0m [91m                          ~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m674[0m:[93m13[0m - [91merror[
0m[90m TS2552: [0mCannot find name 'redis'. Did you mean 'Redis'?

    [7m674[0m       await redis.hset(`${queueName}:jobs`, jobId, 'invalid json');
    [7m   [0m [91m            ~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m674[0m:[93m27[0m - [91merror[
0m[90m TS2304: [0mCannot find name 'queueName'.

    [7m674[0m       await redis.hset(`${queueName}:jobs`, jobId, 'invalid json');
    [7m   [0m [91m                          ~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m674[0m:[93m45[0m - [91merror[
0m[90m TS2552: [0mCannot find name 'jobId'. Did you mean 'job'?

    [7m674[0m       await redis.hset(`${queueName}:jobs`, jobId, 'invalid json');
    [7m   [0m [91m                                            ~~~~~[0m

      [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m677[0m:[93m13[0m
        [7m677[0m       const job = await queueOpsService.getJob(queueName, jobId);
        [7m   [0m [96m            ~~~[0m
        'job' is declared here.
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m677[0m:[93m25[0m - [91merror[
0m[90m TS2552: [0mCannot find name 'queueOpsService'. Did you mean 'QueueStatsService'?

    [7m677[0m       const job = await queueOpsService.getJob(queueName, jobId);
    [7m   [0m [91m                        ~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m677[0m:[93m48[0m - [91merror[
0m[90m TS2304: [0mCannot find name 'queueName'.

    [7m677[0m       const job = await queueOpsService.getJob(queueName, jobId);
    [7m   [0m [91m                                               ~~~~~~~~~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m677[0m:[93m59[0m - [91merror[
0m[90m TS2552: [0mCannot find name 'jobId'. Did you mean 'job'?

    [7m677[0m       const job = await queueOpsService.getJob(queueName, jobId);
    [7m   [0m [91m                                                          ~~~~~[0m

      [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m677[0m:[93m13[0m
        [7m677[0m       const job = await queueOpsService.getJob(queueName, jobId);
        [7m   [0m [96m            ~~~[0m
        'job' is declared here.
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m526[0m:[93m62[0m - [91merror[
0m[90m TS1005: [0m')' expected.

    [7m526[0m         queueManager.createQueue(createQueueConfig(queueName);
    [7m   [0m [91m                                                             ~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m529[0m:[93m48[0m - [91merror[
0m[90m TS1005: [0m';' expected.

    [7m529[0m         await queueOpsService.addJob(queueName));
    [7m   [0m [91m                                               ~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m612[0m:[93m62[0m - [91merror[
0m[90m TS1005: [0m')' expected.

    [7m612[0m         queueManager.createQueue(createQueueConfig(queueName);
    [7m   [0m [91m                                                             ~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m615[0m:[93m48[0m - [91merror[
0m[90m TS1005: [0m';' expected.

    [7m615[0m         await queueOpsService.addJob(queueName));
    [7m   [0m [91m                                               ~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m634[0m:[93m3[0m - [91merror[0
m[90m TS1128: [0mDeclaration or statement expected.

    [7m634[0m   });
    [7m   [0m [91m  ~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m634[0m:[93m4[0m - [91merror[0
m[90m TS1128: [0mDeclaration or statement expected.

    [7m634[0m   });
    [7m   [0m [91m   ~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m668[0m:[93m60[0m - [91merror[
0m[90m TS1005: [0m')' expected.

    [7m668[0m       queueManager.createQueue(createQueueConfig(queueName);
    [7m   [0m [91m                                                           ~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m671[0m:[93m60[0m - [91merror[
0m[90m TS1005: [0m',' expected.

    [7m671[0m       const jobId = await queueOpsService.addJob(queueName));
    [7m   [0m [91m                                                           ~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m682[0m:[93m3[0m - [91merror[0
m[90m TS1128: [0mDeclaration or statement expected.

    [7m682[0m   });
    [7m   [0m [91m  ~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m682[0m:[93m4[0m - [91merror[0
m[90m TS1128: [0mDeclaration or statement expected.

    [7m682[0m   });
    [7m   [0m [91m   ~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m683[0m:[93m1[0m - [91merror[0
m[90m TS1128: [0mDeclaration or statement expected.

    [7m683[0m });
    [7m   [0m [91m~[0m
    [96msrc/__tests__/integration/queueManager.integration.test.ts[0m:[93m683[0m:[93m2[0m - [91merror[0
m[90m TS1128: [0mDeclaration or statement expected.

    [7m683[0m });
    [7m   [0m [91m ~[0m

FAIL src/__tests__/controllers/cacheController.test.ts
  ● Test suite failed to run

    [96msrc/__tests__/controllers/cacheController.test.ts[0m:[93m90[0m:[93m26[0m - [91merror[0m[90m TS
2339: [0mProperty 'mockReturnValue' does not exist on type 'Send<any, Response<any, Record<string, any>>>'.

    [7m90[0m       mockResponse.json!.mockReturnValue(mockResponse as Response);
    [7m  [0m [91m                         ~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/controllers/cacheController.test.ts[0m:[93m683[0m:[93m49[0m - [91merror[0m[90m T
S2345: [0mArgument of type '{ memoryItems: number; memorySize: number; redisConnected: boolean; connected: boo
lean; hits: number; misses: number; hitRate: number; sets: number; dels: number; errors: number; }' is not assi
gnable to parameter of type 'RedisCacheStats'.
      Type '{ memoryItems: number; memorySize: number; redisConnected: boolean; connected: boolean; hits: numbe
r; misses: number; hitRate: number; sets: number; dels: number; errors: number; }' is missing the following pro
perties from type 'RedisCacheStats': compressionHits, locks, prewarmedHits, protectionHits, and 3 more.

    [7m683[0m       mockCacheManager.getStats.mockReturnValue(mockRedisStats);
    [7m   [0m [91m                                                ~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/controllers/cacheController.test.ts[0m:[93m737[0m:[93m50[0m - [91merror[0m[90m T
S2345: [0mArgument of type '{ defaultTtl: number; maxMemoryItems: number; enableCompression: boolean; }' is no
t assignable to parameter of type 'RedisCacheConfig'.
      Type '{ defaultTtl: number; maxMemoryItems: number; enableCompression: boolean; }' is missing the followi
ng properties from type 'RedisCacheConfig': maxMemorySize, compressionThreshold, keyPrefix, enableLocks, and 3 
more.

    [7m737[0m       mockCacheManager.getConfig.mockReturnValue(mockConfig);
    [7m   [0m [91m                                                 ~~~~~~~~~~[0m
    [96msrc/__tests__/controllers/cacheController.test.ts[0m:[93m802[0m:[93m49[0m - [91merror[0m[90m T
S2345: [0mArgument of type '{ memoryItems: number; memorySize: number; redisConnected: boolean; connected: boo
lean; hits: number; misses: number; hitRate: number; sets: number; dels: number; errors: number; }' is not assi
gnable to parameter of type 'RedisCacheStats'.
      Type '{ memoryItems: number; memorySize: number; redisConnected: boolean; connected: boolean; hits: numbe
r; misses: number; hitRate: number; sets: number; dels: number; errors: number; }' is missing the following pro
perties from type 'RedisCacheStats': compressionHits, locks, prewarmedHits, protectionHits, and 3 more.

    [7m802[0m       mockCacheManager.getStats.mockReturnValue(mockStats);
    [7m   [0m [91m                                                ~~~~~~~~~[0m
    [96msrc/__tests__/controllers/cacheController.test.ts[0m:[93m842[0m:[93m49[0m - [91merror[0m[90m T
S2345: [0mArgument of type '{ memoryItems: number; memorySize: number; redisConnected: false; connected: false
; hits: number; misses: number; hitRate: number; sets: number; dels: number; errors: number; }' is not assignab
le to parameter of type 'RedisCacheStats'.
      Type '{ memoryItems: number; memorySize: number; redisConnected: false; connected: false; hits: number; m
isses: number; hitRate: number; sets: number; dels: number; errors: number; }' is missing the following propert
ies from type 'RedisCacheStats': compressionHits, locks, prewarmedHits, protectionHits, and 3 more.

    [7m842[0m       mockCacheManager.getStats.mockReturnValue({
    [7m   [0m [91m                                                ~[0m
    [7m843[0m         memoryItems: 0,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m852[0m         errors: 10,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~[0m
    [7m853[0m       });
    [7m   [0m [91m~~~~~~~[0m

FAIL src/__tests__/integration/authController.integration.test.ts
  ● Test suite failed to run

    [96msrc/__tests__/integration/authController.integration.test.ts[0m:[93m577[0m:[93m36[0m - [91merror
[0m[90m TS2339: [0mProperty 'value' does not exist on type 'PromiseSettledResult<Response>'.
      Property 'value' does not exist on type 'PromiseRejectedResult'.

    [7m577[0m         expect(rateLimitedResponse.value.status).toBe(429);
    [7m   [0m [91m                                   ~~~~~[0m

PASS src/test/visualization.test.ts
  ● Console

    console.error
      Error getting queue stats: Error: Test error
          at VisualizationDataService.<anonymous> (F:\ss\aa\sssss\llmchat\backend\src\test\visualization.test.t
s:548:15)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-mock@29.7.0\node_modules\jest-mock\build\index.js:3
97:39
          at VisualizationDataService.<anonymous> (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-mock@29.7.0\n
ode_modules\jest-mock\build\index.js:404:13)
          at VisualizationDataService.mockConstructor (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-mock@29.7
.0\node_modules\jest-mock\build\index.js:148:19)
          at VisualizationController.getQueueStats (F:\ss\aa\sssss\llmchat\backend\src\controllers\Visualizatio
nController.ts:186:34)
          at Object.<anonymous> (F:\ss\aa\sssss\llmchat\backend\src\test\visualization.test.ts:551:24)
          at Promise.then.completed (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\
jest-circus\build\utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-
circus\build\utils.js:231:10)
          at _callCircusTest (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-ci
rcus\build\run.js:316:40)
          at async _runTest (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-cir
cus\build\run.js:252:3)
          at async _runTestsForDescribeBlock (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node
_modules\jest-circus\build\run.js:126:9)
          at async _runTestsForDescribeBlock (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node
_modules\jest-circus\build\run.js:121:9)
          at async _runTestsForDescribeBlock (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node
_modules\jest-circus\build\run.js:121:9)
          at async run (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-circus\b
uild\run.js:71:3)
          at async runAndTransformResultsToJestFormat (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29
.7.0\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
          at async jestAdapter (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-
circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
          at async runTestInternal (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-runner@29.7.0\node_modules\j
est-runner\build\runTest.js:367:16)
          at async runTest (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-runner@29.7.0\node_modules\jest-runn
er\build\runTest.js:444:34)

    [0m [90m 195 |[39m       })[33m;[39m
     [90m 196 |[39m     } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 197 |[39m       console[33m.[39merror([32m'Error getting queue stats:'[39m[
33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 198 |[39m       res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 199 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 200 |[39m         error[33m:[39m [32m'Failed to get queue stats'[39m[33m,[39m[0m

      at VisualizationController.getQueueStats (src/controllers/VisualizationController.ts:197:15)
      at Object.<anonymous> (src/test/visualization.test.ts:551:24)

    console.error
      Error getting Redis stats: Error: Connection pool error
          at MockRedisConnectionPool.<anonymous> (F:\ss\aa\sssss\llmchat\backend\src\test\visualization.test.ts
:697:15)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-mock@29.7.0\node_modules\jest-mock\build\index.js:3
97:39
          at MockRedisConnectionPool.<anonymous> (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-mock@29.7.0\no
de_modules\jest-mock\build\index.js:404:13)
          at MockRedisConnectionPool.mockConstructor [as getStats] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\j
est-mock@29.7.0\node_modules\jest-mock\build\index.js:148:19)
          at VisualizationController.getRedisStats (F:\ss\aa\sssss\llmchat\backend\src\controllers\Visualizatio
nController.ts:258:45)
          at Object.<anonymous> (F:\ss\aa\sssss\llmchat\backend\src\test\visualization.test.ts:700:24)
          at Promise.then.completed (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\
jest-circus\build\utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-
circus\build\utils.js:231:10)
          at _callCircusTest (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-ci
rcus\build\run.js:316:40)
          at async _runTest (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-cir
cus\build\run.js:252:3)
          at async _runTestsForDescribeBlock (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node
_modules\jest-circus\build\run.js:126:9)
          at async _runTestsForDescribeBlock (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node
_modules\jest-circus\build\run.js:121:9)
          at async _runTestsForDescribeBlock (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node
_modules\jest-circus\build\run.js:121:9)
          at async run (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-circus\b
uild\run.js:71:3)
          at async runAndTransformResultsToJestFormat (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29
.7.0\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
          at async jestAdapter (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-
circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
          at async runTestInternal (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-runner@29.7.0\node_modules\j
est-runner\build\runTest.js:367:16)
          at async runTest (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-runner@29.7.0\node_modules\jest-runn
er\build\runTest.js:444:34)

    [0m [90m 267 |[39m       })[33m;[39m
     [90m 268 |[39m     } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 269 |[39m       console[33m.[39merror([32m'Error getting Redis stats:'[39m[
33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 270 |[39m       res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 271 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 272 |[39m         error[33m:[39m [32m'Failed to get Redis stats'[39m[33m,[39m[0m

      at VisualizationController.getRedisStats (src/controllers/VisualizationController.ts:269:15)
      at Object.<anonymous> (src/test/visualization.test.ts:700:24)

    console.error
      Error getting queue stats: Error: Queue manager error
          at VisualizationDataService.<anonymous> (F:\ss\aa\sssss\llmchat\backend\src\test\visualization.test.t
s:721:15)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-mock@29.7.0\node_modules\jest-mock\build\index.js:3
97:39
          at VisualizationDataService.<anonymous> (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-mock@29.7.0\n
ode_modules\jest-mock\build\index.js:404:13)
          at VisualizationDataService.mockConstructor (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-mock@29.7
.0\node_modules\jest-mock\build\index.js:148:19)
          at VisualizationController.getQueueStats (F:\ss\aa\sssss\llmchat\backend\src\controllers\Visualizatio
nController.ts:186:34)
          at Object.<anonymous> (F:\ss\aa\sssss\llmchat\backend\src\test\visualization.test.ts:724:24)
          at Promise.then.completed (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\
jest-circus\build\utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-
circus\build\utils.js:231:10)
          at _callCircusTest (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-ci
rcus\build\run.js:316:40)
          at async _runTest (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-cir
cus\build\run.js:252:3)
          at async _runTestsForDescribeBlock (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node
_modules\jest-circus\build\run.js:126:9)
          at async _runTestsForDescribeBlock (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node
_modules\jest-circus\build\run.js:121:9)
          at async _runTestsForDescribeBlock (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node
_modules\jest-circus\build\run.js:121:9)
          at async run (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-circus\b
uild\run.js:71:3)
          at async runAndTransformResultsToJestFormat (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29
.7.0\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
          at async jestAdapter (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-
circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
          at async runTestInternal (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-runner@29.7.0\node_modules\j
est-runner\build\runTest.js:367:16)
          at async runTest (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-runner@29.7.0\node_modules\jest-runn
er\build\runTest.js:444:34)

    [0m [90m 195 |[39m       })[33m;[39m
     [90m 196 |[39m     } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 197 |[39m       console[33m.[39merror([32m'Error getting queue stats:'[39m[
33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 198 |[39m       res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 199 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 200 |[39m         error[33m:[39m [32m'Failed to get queue stats'[39m[33m,[39m[0m

      at VisualizationController.getQueueStats (src/controllers/VisualizationController.ts:197:15)
      at Object.<anonymous> (src/test/visualization.test.ts:724:24)

    console.error
      Error getting dashboard data: Error: Monitoring service error
          at VisualizationDataService.<anonymous> (F:\ss\aa\sssss\llmchat\backend\src\test\visualization.test.t
s:745:15)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-mock@29.7.0\node_modules\jest-mock\build\index.js:3
97:39
          at VisualizationDataService.<anonymous> (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-mock@29.7.0\n
ode_modules\jest-mock\build\index.js:404:13)
          at VisualizationDataService.mockConstructor [as getRealtimeSummary] (F:\ss\aa\sssss\llmchat\node_modu
les\.pnpm\jest-mock@29.7.0\node_modules\jest-mock\build\index.js:148:19)
          at VisualizationController.getDashboardData (F:\ss\aa\sssss\llmchat\backend\src\controllers\Visualiza
tionController.ts:146:46)
          at Object.<anonymous> (F:\ss\aa\sssss\llmchat\backend\src\test\visualization.test.ts:748:24)
          at Promise.then.completed (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\
jest-circus\build\utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-
circus\build\utils.js:231:10)
          at _callCircusTest (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-ci
rcus\build\run.js:316:40)
          at async _runTest (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-cir
cus\build\run.js:252:3)
          at async _runTestsForDescribeBlock (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node
_modules\jest-circus\build\run.js:126:9)
          at async _runTestsForDescribeBlock (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node
_modules\jest-circus\build\run.js:121:9)
          at async _runTestsForDescribeBlock (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node
_modules\jest-circus\build\run.js:121:9)
          at async run (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-circus\b
uild\run.js:71:3)
          at async runAndTransformResultsToJestFormat (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29
.7.0\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
          at async jestAdapter (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-
circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
          at async runTestInternal (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-runner@29.7.0\node_modules\j
est-runner\build\runTest.js:367:16)
          at async runTest (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-runner@29.7.0\node_modules\jest-runn
er\build\runTest.js:444:34)

    [0m [90m 156 |[39m       })[33m;[39m
     [90m 157 |[39m     } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 158 |[39m       console[33m.[39merror([32m'Error getting dashboard data:'[39
m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 159 |[39m       res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 160 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 161 |[39m         error[33m:[39m [32m'Failed to get dashboard data'[39m[33m,[39m[0m

      at VisualizationController.getDashboardData (src/controllers/VisualizationController.ts:158:15)
      at Object.<anonymous> (src/test/visualization.test.ts:748:24)

PASS src/__tests__/services/AuthServiceV2.test.ts
FAIL src/__tests__/integration/crossService.integration.test.ts
  ● Console

    console.warn
      [WARN] Redis server does not require a password, but a password was supplied.

      at ../node_modules/.pnpm/ioredis@5.8.1/node_modules/ioredis/built/redis/event_handler.js:24:33
      at tryCatcher (../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/u
tils.js:12:23)
      at ../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/index.js:33:5
1

    console.warn
      [WARN] Redis server does not require a password, but a password was supplied.

      at ../node_modules/.pnpm/ioredis@5.8.1/node_modules/ioredis/built/redis/event_handler.js:24:33
      at tryCatcher (../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/u
tils.js:12:23)
      at ../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/index.js:33:5
1

    console.warn
      [WARN] Redis server does not require a password, but a password was supplied.

      at ../node_modules/.pnpm/ioredis@5.8.1/node_modules/ioredis/built/redis/event_handler.js:24:33
      at tryCatcher (../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/u
tils.js:12:23)
      at ../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/index.js:33:5
1

    console.warn
      [WARN] Redis server does not require a password, but a password was supplied.

      at ../node_modules/.pnpm/ioredis@5.8.1/node_modules/ioredis/built/redis/event_handler.js:24:33
      at tryCatcher (../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/u
tils.js:12:23)
      at ../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/index.js:33:5
1

    console.warn
      [WARN] Redis server does not require a password, but a password was supplied.

      at ../node_modules/.pnpm/ioredis@5.8.1/node_modules/ioredis/built/redis/event_handler.js:24:33
      at tryCatcher (../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/u
tils.js:12:23)
      at ../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/index.js:33:5
1

    console.warn
      [WARN] Redis server does not require a password, but a password was supplied.

      at ../node_modules/.pnpm/ioredis@5.8.1/node_modules/ioredis/built/redis/event_handler.js:24:33
      at tryCatcher (../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/u
tils.js:12:23)
      at ../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/index.js:33:5
1

    console.warn
      [WARN] Redis server does not require a password, but a password was supplied.

      at ../node_modules/.pnpm/ioredis@5.8.1/node_modules/ioredis/built/redis/event_handler.js:24:33
      at tryCatcher (../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/u
tils.js:12:23)
      at ../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/index.js:33:5
1

  ● Cross-Service Integration Tests › Authentication ↔ Chat Integration › should associate chat sessions with a
uthenticated users

    TypeError: testDb.query is not a function

    [0m [90m 35 |[39m     [36mconst[39m bcrypt [33m=[39m require([32m'bcryptjs'[39m)[33m;[39m
     [90m 36 |[39m     [36mconst[39m hashedPassword [33m=[39m [36mawait[39m bcrypt[33m.[39mhash([32m
'testpassword123'[39m[33m,[39m [35m10[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 37 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m testDb[33m.[39
mquery(
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 38 |[39m       [32m'INSERT INTO users (email, password_hash, full_name, created_at, updated_at) VA
LUES ($1, $2, $3, NOW(), NOW()) RETURNING *'[39m[33m,[39m
     [90m 39 |[39m       [[32m'test@example.com'[39m[33m,[39m hashedPassword[33m,[39m [32m'Test User'
[39m]
     [90m 40 |[39m     )[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/crossService.integration.test.ts:37:33)

  ● Cross-Service Integration Tests › Authentication ↔ Chat Integration › should enforce user permissions on ch
at operations

    TypeError: testDb.query is not a function

    [0m [90m 35 |[39m     [36mconst[39m bcrypt [33m=[39m require([32m'bcryptjs'[39m)[33m;[39m
     [90m 36 |[39m     [36mconst[39m hashedPassword [33m=[39m [36mawait[39m bcrypt[33m.[39mhash([32m
'testpassword123'[39m[33m,[39m [35m10[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 37 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m testDb[33m.[39
mquery(
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 38 |[39m       [32m'INSERT INTO users (email, password_hash, full_name, created_at, updated_at) VA
LUES ($1, $2, $3, NOW(), NOW()) RETURNING *'[39m[33m,[39m
     [90m 39 |[39m       [[32m'test@example.com'[39m[33m,[39m hashedPassword[33m,[39m [32m'Test User'
[39m]
     [90m 40 |[39m     )[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/crossService.integration.test.ts:37:33)

  ● Cross-Service Integration Tests › Authentication ↔ Chat Integration › should handle user session lifecycle 
with chat data

    TypeError: testDb.query is not a function

    [0m [90m 35 |[39m     [36mconst[39m bcrypt [33m=[39m require([32m'bcryptjs'[39m)[33m;[39m
     [90m 36 |[39m     [36mconst[39m hashedPassword [33m=[39m [36mawait[39m bcrypt[33m.[39mhash([32m
'testpassword123'[39m[33m,[39m [35m10[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 37 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m testDb[33m.[39
mquery(
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 38 |[39m       [32m'INSERT INTO users (email, password_hash, full_name, created_at, updated_at) VA
LUES ($1, $2, $3, NOW(), NOW()) RETURNING *'[39m[33m,[39m
     [90m 39 |[39m       [[32m'test@example.com'[39m[33m,[39m hashedPassword[33m,[39m [32m'Test User'
[39m]
     [90m 40 |[39m     )[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/crossService.integration.test.ts:37:33)

  ● Cross-Service Integration Tests › Queue ↔ Chat Integration › should queue chat processing jobs

    TypeError: testDb.query is not a function

    [0m [90m 35 |[39m     [36mconst[39m bcrypt [33m=[39m require([32m'bcryptjs'[39m)[33m;[39m
     [90m 36 |[39m     [36mconst[39m hashedPassword [33m=[39m [36mawait[39m bcrypt[33m.[39mhash([32m
'testpassword123'[39m[33m,[39m [35m10[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 37 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m testDb[33m.[39
mquery(
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 38 |[39m       [32m'INSERT INTO users (email, password_hash, full_name, created_at, updated_at) VA
LUES ($1, $2, $3, NOW(), NOW()) RETURNING *'[39m[33m,[39m
     [90m 39 |[39m       [[32m'test@example.com'[39m[33m,[39m hashedPassword[33m,[39m [32m'Test User'
[39m]
     [90m 40 |[39m     )[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/crossService.integration.test.ts:37:33)

  ● Cross-Service Integration Tests › Queue ↔ Chat Integration › should track chat processing metrics in queue

    TypeError: testDb.query is not a function

    [0m [90m 35 |[39m     [36mconst[39m bcrypt [33m=[39m require([32m'bcryptjs'[39m)[33m;[39m
     [90m 36 |[39m     [36mconst[39m hashedPassword [33m=[39m [36mawait[39m bcrypt[33m.[39mhash([32m
'testpassword123'[39m[33m,[39m [35m10[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 37 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m testDb[33m.[39
mquery(
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 38 |[39m       [32m'INSERT INTO users (email, password_hash, full_name, created_at, updated_at) VA
LUES ($1, $2, $3, NOW(), NOW()) RETURNING *'[39m[33m,[39m
     [90m 39 |[39m       [[32m'test@example.com'[39m[33m,[39m hashedPassword[33m,[39m [32m'Test User'
[39m]
     [90m 40 |[39m     )[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/crossService.integration.test.ts:37:33)

  ● Cross-Service Integration Tests › Queue ↔ Chat Integration › should handle chat processing failures and ret
ries

    TypeError: testDb.query is not a function

    [0m [90m 35 |[39m     [36mconst[39m bcrypt [33m=[39m require([32m'bcryptjs'[39m)[33m;[39m
     [90m 36 |[39m     [36mconst[39m hashedPassword [33m=[39m [36mawait[39m bcrypt[33m.[39mhash([32m
'testpassword123'[39m[33m,[39m [35m10[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 37 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m testDb[33m.[39
mquery(
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 38 |[39m       [32m'INSERT INTO users (email, password_hash, full_name, created_at, updated_at) VA
LUES ($1, $2, $3, NOW(), NOW()) RETURNING *'[39m[33m,[39m
     [90m 39 |[39m       [[32m'test@example.com'[39m[33m,[39m hashedPassword[33m,[39m [32m'Test User'
[39m]
     [90m 40 |[39m     )[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/crossService.integration.test.ts:37:33)

  ● Cross-Service Integration Tests › Event Bus Integration › should propagate events across services

    TypeError: testDb.query is not a function

    [0m [90m 35 |[39m     [36mconst[39m bcrypt [33m=[39m require([32m'bcryptjs'[39m)[33m;[39m
     [90m 36 |[39m     [36mconst[39m hashedPassword [33m=[39m [36mawait[39m bcrypt[33m.[39mhash([32m
'testpassword123'[39m[33m,[39m [35m10[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 37 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m testDb[33m.[39
mquery(
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 38 |[39m       [32m'INSERT INTO users (email, password_hash, full_name, created_at, updated_at) VA
LUES ($1, $2, $3, NOW(), NOW()) RETURNING *'[39m[33m,[39m
     [90m 39 |[39m       [[32m'test@example.com'[39m[33m,[39m hashedPassword[33m,[39m [32m'Test User'
[39m]
     [90m 40 |[39m     )[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/crossService.integration.test.ts:37:33)

  ● Cross-Service Integration Tests › Event Bus Integration › should handle event failures gracefully

    TypeError: testDb.query is not a function

    [0m [90m 35 |[39m     [36mconst[39m bcrypt [33m=[39m require([32m'bcryptjs'[39m)[33m;[39m
     [90m 36 |[39m     [36mconst[39m hashedPassword [33m=[39m [36mawait[39m bcrypt[33m.[39mhash([32m
'testpassword123'[39m[33m,[39m [35m10[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 37 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m testDb[33m.[39
mquery(
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 38 |[39m       [32m'INSERT INTO users (email, password_hash, full_name, created_at, updated_at) VA
LUES ($1, $2, $3, NOW(), NOW()) RETURNING *'[39m[33m,[39m
     [90m 39 |[39m       [[32m'test@example.com'[39m[33m,[39m hashedPassword[33m,[39m [32m'Test User'
[39m]
     [90m 40 |[39m     )[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/crossService.integration.test.ts:37:33)

  ● Cross-Service Integration Tests › Database Transaction Integration › should maintain data consistency acros
s services

    TypeError: testDb.query is not a function

    [0m [90m 35 |[39m     [36mconst[39m bcrypt [33m=[39m require([32m'bcryptjs'[39m)[33m;[39m
     [90m 36 |[39m     [36mconst[39m hashedPassword [33m=[39m [36mawait[39m bcrypt[33m.[39mhash([32m
'testpassword123'[39m[33m,[39m [35m10[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 37 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m testDb[33m.[39
mquery(
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 38 |[39m       [32m'INSERT INTO users (email, password_hash, full_name, created_at, updated_at) VA
LUES ($1, $2, $3, NOW(), NOW()) RETURNING *'[39m[33m,[39m
     [90m 39 |[39m       [[32m'test@example.com'[39m[33m,[39m hashedPassword[33m,[39m [32m'Test User'
[39m]
     [90m 40 |[39m     )[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/crossService.integration.test.ts:37:33)

  ● Cross-Service Integration Tests › Database Transaction Integration › should handle transaction rollbacks on
 errors

    TypeError: testDb.query is not a function

    [0m [90m 35 |[39m     [36mconst[39m bcrypt [33m=[39m require([32m'bcryptjs'[39m)[33m;[39m
     [90m 36 |[39m     [36mconst[39m hashedPassword [33m=[39m [36mawait[39m bcrypt[33m.[39mhash([32m
'testpassword123'[39m[33m,[39m [35m10[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 37 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m testDb[33m.[39
mquery(
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 38 |[39m       [32m'INSERT INTO users (email, password_hash, full_name, created_at, updated_at) VA
LUES ($1, $2, $3, NOW(), NOW()) RETURNING *'[39m[33m,[39m
     [90m 39 |[39m       [[32m'test@example.com'[39m[33m,[39m hashedPassword[33m,[39m [32m'Test User'
[39m]
     [90m 40 |[39m     )[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/crossService.integration.test.ts:37:33)

  ● Cross-Service Integration Tests › Cache Integration › should cache frequently accessed data

    TypeError: testDb.query is not a function

    [0m [90m 35 |[39m     [36mconst[39m bcrypt [33m=[39m require([32m'bcryptjs'[39m)[33m;[39m
     [90m 36 |[39m     [36mconst[39m hashedPassword [33m=[39m [36mawait[39m bcrypt[33m.[39mhash([32m
'testpassword123'[39m[33m,[39m [35m10[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 37 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m testDb[33m.[39
mquery(
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 38 |[39m       [32m'INSERT INTO users (email, password_hash, full_name, created_at, updated_at) VA
LUES ($1, $2, $3, NOW(), NOW()) RETURNING *'[39m[33m,[39m
     [90m 39 |[39m       [[32m'test@example.com'[39m[33m,[39m hashedPassword[33m,[39m [32m'Test User'
[39m]
     [90m 40 |[39m     )[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/crossService.integration.test.ts:37:33)

  ● Cross-Service Integration Tests › Cache Integration › should invalidate cache on data changes

    TypeError: testDb.query is not a function

    [0m [90m 35 |[39m     [36mconst[39m bcrypt [33m=[39m require([32m'bcryptjs'[39m)[33m;[39m
     [90m 36 |[39m     [36mconst[39m hashedPassword [33m=[39m [36mawait[39m bcrypt[33m.[39mhash([32m
'testpassword123'[39m[33m,[39m [35m10[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 37 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m testDb[33m.[39
mquery(
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 38 |[39m       [32m'INSERT INTO users (email, password_hash, full_name, created_at, updated_at) VA
LUES ($1, $2, $3, NOW(), NOW()) RETURNING *'[39m[33m,[39m
     [90m 39 |[39m       [[32m'test@example.com'[39m[33m,[39m hashedPassword[33m,[39m [32m'Test User'
[39m]
     [90m 40 |[39m     )[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/crossService.integration.test.ts:37:33)

  ● Cross-Service Integration Tests › Performance Integration › should handle concurrent requests efficiently

    TypeError: testDb.query is not a function

    [0m [90m 35 |[39m     [36mconst[39m bcrypt [33m=[39m require([32m'bcryptjs'[39m)[33m;[39m
     [90m 36 |[39m     [36mconst[39m hashedPassword [33m=[39m [36mawait[39m bcrypt[33m.[39mhash([32m
'testpassword123'[39m[33m,[39m [35m10[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 37 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m testDb[33m.[39
mquery(
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 38 |[39m       [32m'INSERT INTO users (email, password_hash, full_name, created_at, updated_at) VA
LUES ($1, $2, $3, NOW(), NOW()) RETURNING *'[39m[33m,[39m
     [90m 39 |[39m       [[32m'test@example.com'[39m[33m,[39m hashedPassword[33m,[39m [32m'Test User'
[39m]
     [90m 40 |[39m     )[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/crossService.integration.test.ts:37:33)

  ● Cross-Service Integration Tests › Performance Integration › should maintain system stability under load

    TypeError: testDb.query is not a function

    [0m [90m 35 |[39m     [36mconst[39m bcrypt [33m=[39m require([32m'bcryptjs'[39m)[33m;[39m
     [90m 36 |[39m     [36mconst[39m hashedPassword [33m=[39m [36mawait[39m bcrypt[33m.[39mhash([32m
'testpassword123'[39m[33m,[39m [35m10[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 37 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m testDb[33m.[39
mquery(
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 38 |[39m       [32m'INSERT INTO users (email, password_hash, full_name, created_at, updated_at) VA
LUES ($1, $2, $3, NOW(), NOW()) RETURNING *'[39m[33m,[39m
     [90m 39 |[39m       [[32m'test@example.com'[39m[33m,[39m hashedPassword[33m,[39m [32m'Test User'
[39m]
     [90m 40 |[39m     )[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/crossService.integration.test.ts:37:33)

  ● Cross-Service Integration Tests › Error Propagation Integration › should propagate errors correctly across 
service boundaries

    TypeError: testDb.query is not a function

    [0m [90m 35 |[39m     [36mconst[39m bcrypt [33m=[39m require([32m'bcryptjs'[39m)[33m;[39m
     [90m 36 |[39m     [36mconst[39m hashedPassword [33m=[39m [36mawait[39m bcrypt[33m.[39mhash([32m
'testpassword123'[39m[33m,[39m [35m10[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 37 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m testDb[33m.[39
mquery(
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 38 |[39m       [32m'INSERT INTO users (email, password_hash, full_name, created_at, updated_at) VA
LUES ($1, $2, $3, NOW(), NOW()) RETURNING *'[39m[33m,[39m
     [90m 39 |[39m       [[32m'test@example.com'[39m[33m,[39m hashedPassword[33m,[39m [32m'Test User'
[39m]
     [90m 40 |[39m     )[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/crossService.integration.test.ts:37:33)

  ● Cross-Service Integration Tests › Error Propagation Integration › should handle service unavailability grac
efully

    TypeError: testDb.query is not a function

    [0m [90m 35 |[39m     [36mconst[39m bcrypt [33m=[39m require([32m'bcryptjs'[39m)[33m;[39m
     [90m 36 |[39m     [36mconst[39m hashedPassword [33m=[39m [36mawait[39m bcrypt[33m.[39mhash([32m
'testpassword123'[39m[33m,[39m [35m10[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 37 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m testDb[33m.[39
mquery(
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 38 |[39m       [32m'INSERT INTO users (email, password_hash, full_name, created_at, updated_at) VA
LUES ($1, $2, $3, NOW(), NOW()) RETURNING *'[39m[33m,[39m
     [90m 39 |[39m       [[32m'test@example.com'[39m[33m,[39m hashedPassword[33m,[39m [32m'Test User'
[39m]
     [90m 40 |[39m     )[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/crossService.integration.test.ts:37:33)

  ● Cross-Service Integration Tests › Resource Cleanup Integration › should clean up resources properly

    TypeError: testDb.query is not a function

    [0m [90m 35 |[39m     [36mconst[39m bcrypt [33m=[39m require([32m'bcryptjs'[39m)[33m;[39m
     [90m 36 |[39m     [36mconst[39m hashedPassword [33m=[39m [36mawait[39m bcrypt[33m.[39mhash([32m
'testpassword123'[39m[33m,[39m [35m10[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 37 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m testDb[33m.[39
mquery(
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 38 |[39m       [32m'INSERT INTO users (email, password_hash, full_name, created_at, updated_at) VA
LUES ($1, $2, $3, NOW(), NOW()) RETURNING *'[39m[33m,[39m
     [90m 39 |[39m       [[32m'test@example.com'[39m[33m,[39m hashedPassword[33m,[39m [32m'Test User'
[39m]
     [90m 40 |[39m     )[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/crossService.integration.test.ts:37:33)

  ● Cross-Service Integration Tests › Resource Cleanup Integration › should handle orphaned resource cleanup

    TypeError: testDb.query is not a function

    [0m [90m 35 |[39m     [36mconst[39m bcrypt [33m=[39m require([32m'bcryptjs'[39m)[33m;[39m
     [90m 36 |[39m     [36mconst[39m hashedPassword [33m=[39m [36mawait[39m bcrypt[33m.[39mhash([32m
'testpassword123'[39m[33m,[39m [35m10[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 37 |[39m     [36mconst[39m result [33m=[39m [36mawait[39m testDb[33m.[39
mquery(
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 38 |[39m       [32m'INSERT INTO users (email, password_hash, full_name, created_at, updated_at) VA
LUES ($1, $2, $3, NOW(), NOW()) RETURNING *'[39m[33m,[39m
     [90m 39 |[39m       [[32m'test@example.com'[39m[33m,[39m hashedPassword[33m,[39m [32m'Test User'
[39m]
     [90m 40 |[39m     )[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/crossService.integration.test.ts:37:33)

FAIL src/__tests__/integration/databasePerformance.integration.test.ts
  ● Database Performance Benchmarking › Connection Performance › should establish connections quickly

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39m [36mawait[39m [36mthis[39m
[33m.[39mtestPool[33m.[39mconnect()[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUtils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databasePerformance.integration.test.ts:38:5)

  ● Database Performance Benchmarking › Connection Performance › should handle connection pool exhaustion grace
fully

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39m [36mawait[39m [36mthis[39m
[33m.[39mtestPool[33m.[39mconnect()[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUtils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databasePerformance.integration.test.ts:38:5)

  ● Database Performance Benchmarking › CRUD Operations Performance › should perform inserts efficiently

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39m [36mawait[39m [36mthis[39m
[33m.[39mtestPool[33m.[39mconnect()[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUtils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databasePerformance.integration.test.ts:38:5)

  ● Database Performance Benchmarking › CRUD Operations Performance › should perform bulk inserts efficiently

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39m [36mawait[39m [36mthis[39m
[33m.[39mtestPool[33m.[39mconnect()[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUtils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databasePerformance.integration.test.ts:38:5)

  ● Database Performance Benchmarking › CRUD Operations Performance › should perform queries efficiently

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39m [36mawait[39m [36mthis[39m
[33m.[39mtestPool[33m.[39mconnect()[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUtils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databasePerformance.integration.test.ts:38:5)

  ● Database Performance Benchmarking › CRUD Operations Performance › should perform updates efficiently

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39m [36mawait[39m [36mthis[39m
[33m.[39mtestPool[33m.[39mconnect()[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUtils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databasePerformance.integration.test.ts:38:5)

  ● Database Performance Benchmarking › Transaction Performance › should handle nested transactions efficiently

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39m [36mawait[39m [36mthis[39m
[33m.[39mtestPool[33m.[39mconnect()[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUtils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databasePerformance.integration.test.ts:38:5)

  ● Database Performance Benchmarking › Transaction Performance › should handle rollback efficiently

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39m [36mawait[39m [36mthis[39m
[33m.[39mtestPool[33m.[39mconnect()[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUtils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databasePerformance.integration.test.ts:38:5)

  ● Database Performance Benchmarking › JSON Performance › should handle JSONB operations efficiently

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39m [36mawait[39m [36mthis[39m
[33m.[39mtestPool[33m.[39mconnect()[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUtils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databasePerformance.integration.test.ts:38:5)


  ● Test suite failed to run

    read ECONNRESET

    [0m [90m 200 |[39m   [36masync[39m cleanupTestData()[33m:[39m [33mPromise[39m[33m<[39m[36mvoid
[39m[33m>[39m {
     [90m 201 |[39m     [36mconst[39m pool [33m=[39m [36mthis[39m[33m.[39mgetTestPool()[33m;[39m
    [31m[1m>[22m[39m[90m 202 |[39m     [36mconst[39m client [33m=[39m [36mawait[39m pool[33m.[39m
connect()[33m;[39m
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 203 |[39m
     [90m 204 |[39m     [36mtry[39m {
     [90m 205 |[39m       [90m// 按依赖关系顺序清理数据[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.cleanupTestData (src/__tests__/utils/dbTestUtils.ts:202:20)
      at async DatabaseTestEnvironment.close (src/__tests__/utils/dbTestUtils.ts:254:7)
      at async Object.afterAll (src/__tests__/utils/dbTestUtils.ts:445:5)
      at async Object.<anonymous> (src/__tests__/integration/databasePerformance.integration.test.ts:46:5)

FAIL src/__tests__/integration/database.integration.test.ts
  ● Test suite failed to run

    [96msrc/__tests__/integration/database.integration.test.ts[0m:[93m145[0m:[93m79[0m - [91merror[0m[
90m TS2304: [0mCannot find name 'userId'.

    [7m145[0m       await DatabaseAssertions.assertExists('chat_sessions', 'user_id = $1', [userId]);
    [7m   [0m [91m                                                                              ~~~~~~[0m
    [96msrc/__tests__/integration/database.integration.test.ts[0m:[93m146[0m:[93m130[0m - [91merror[0m
[90m TS2304: [0mCannot find name 'userId'.

    [7m146[0m       await DatabaseAssertions.assertExists('chat_messages', 'session_id IN (SELECT id FROM cha
t_sessions WHERE user_id = $1)', [userId]);
    [7m   [0m [91m                                                                                          
                                       ~~~~~~[0m
    [96msrc/__tests__/integration/database.integration.test.ts[0m:[93m168[0m:[93m7[0m - [91merror[0m[9
0m TS2554: [0mExpected 2 arguments, but got 3.

    [7m168[0m       await DatabaseAssertions.assertCount('users', 5);
    [7m   [0m [91m      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/integration/database.integration.test.ts[0m:[93m144[0m:[93m90[0m - [91merror[0m[
90m TS1005: [0m',' expected.

    [7m144[0m       await DatabaseAssertions.assertExists('users', 'username = $1', ['test@example.com')]);
    [7m   [0m [91m                                                                                         ~
[0m
    [96msrc/__tests__/integration/database.integration.test.ts[0m:[93m144[0m:[93m91[0m - [91merror[0m[
90m TS1005: [0m';' expected.

    [7m144[0m       await DatabaseAssertions.assertExists('users', 'username = $1', ['test@example.com')]);
    [7m   [0m [91m                                                                                          
~[0m
    [96msrc/__tests__/integration/database.integration.test.ts[0m:[93m144[0m:[93m92[0m - [91merror[0m[
90m TS1128: [0mDeclaration or statement expected.

    [7m144[0m       await DatabaseAssertions.assertExists('users', 'username = $1', ['test@example.com')]);
    [7m   [0m [91m                                                                                          
 ~[0m
    [96msrc/__tests__/integration/database.integration.test.ts[0m:[93m165[0m:[93m81[0m - [91merror[0m[
90m TS1005: [0m';' expected.

    [7m165[0m         await DatabaseAssertions.assertExists('users', 'username = $1'), [email]);
    [7m   [0m [91m                                                                                ~[0m
    [96msrc/__tests__/integration/database.integration.test.ts[0m:[93m168[0m:[93m7[0m - [91merror[0m[9
0m TS1005: [0m',' expected.

    [7m168[0m       await DatabaseAssertions.assertCount('users', 5);
    [7m   [0m [91m      ~~~~~[0m
    [96msrc/__tests__/integration/database.integration.test.ts[0m:[93m168[0m:[93m55[0m - [91merror[0m[
90m TS1005: [0m')' expected.

    [7m168[0m       await DatabaseAssertions.assertCount('users', 5);
    [7m   [0m [91m                                                      ~[0m
    [96msrc/__tests__/integration/database.integration.test.ts[0m:[93m169[0m:[93m5[0m - [91merror[0m[9
0m TS1128: [0mDeclaration or statement expected.

    [7m169[0m     });
    [7m   [0m [91m    ~[0m
    [96msrc/__tests__/integration/database.integration.test.ts[0m:[93m169[0m:[93m6[0m - [91merror[0m[9
0m TS1128: [0mDeclaration or statement expected.

    [7m169[0m     });
    [7m   [0m [91m     ~[0m
    [96msrc/__tests__/integration/database.integration.test.ts[0m:[93m170[0m:[93m3[0m - [91merror[0m[9
0m TS1128: [0mDeclaration or statement expected.

    [7m170[0m   });
    [7m   [0m [91m  ~[0m
    [96msrc/__tests__/integration/database.integration.test.ts[0m:[93m170[0m:[93m4[0m - [91merror[0m[9
0m TS1128: [0mDeclaration or statement expected.

    [7m170[0m   });
    [7m   [0m [91m   ~[0m
    [96msrc/__tests__/integration/database.integration.test.ts[0m:[93m183[0m:[93m88[0m - [91merror[0m[
90m TS1005: [0m';' expected.

    [7m183[0m       await DatabaseAssertions.assertExists('users', 'username = $1'), [userData.email]);
    [7m   [0m [91m                                                                                       ~[
0m
    [96msrc/__tests__/integration/database.integration.test.ts[0m:[93m285[0m:[93m3[0m - [91merror[0m[9
0m TS1128: [0mDeclaration or statement expected.

    [7m285[0m   });
    [7m   [0m [91m  ~[0m
    [96msrc/__tests__/integration/database.integration.test.ts[0m:[93m285[0m:[93m4[0m - [91merror[0m[9
0m TS1128: [0mDeclaration or statement expected.

    [7m285[0m   });
    [7m   [0m [91m   ~[0m
    [96msrc/__tests__/integration/database.integration.test.ts[0m:[93m525[0m:[93m1[0m - [91merror[0m[9
0m TS1128: [0mDeclaration or statement expected.

    [7m525[0m });
    [7m   [0m [91m~[0m
    [96msrc/__tests__/integration/database.integration.test.ts[0m:[93m525[0m:[93m2[0m - [91merror[0m[9
0m TS1128: [0mDeclaration or statement expected.

    [7m525[0m });
    [7m   [0m [91m ~[0m

FAIL src/__tests__/frontend/HybridStorageService.test.ts
  ● Test suite failed to run

    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m42[0m:[93m25[0m - [91merror[0m[90m 
TS2304: [0mCannot find name 'window'.

    [7m42[0m   Object.defineProperty(window, 'indexedDB', {
    [7m  [0m [91m                        ~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m47[0m:[93m25[0m - [91merror[0m[90m 
TS2304: [0mCannot find name 'window'.

    [7m47[0m   Object.defineProperty(window, 'localStorage', {
    [7m  [0m [91m                        ~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m52[0m:[93m25[0m - [91merror[0m[90m 
TS2304: [0mCannot find name 'window'.

    [7m52[0m   Object.defineProperty(window, 'sessionStorage', {
    [7m  [0m [91m                        ~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m72[0m:[93m50[0m - [91merror[0m[90m 
TS2345: [0mArgument of type '{ maxSize: number; maxEntries: number; }' is not assignable to parameter of type 
'number'.

    [7m72[0m       memoryProvider = new MemoryStorageProvider({
    [7m  [0m [91m                                                 ~[0m
    [7m73[0m         maxSize: 1024 * 1024, // 1MB
    [7m  [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m74[0m         maxEntries: 100
    [7m  [0m [91m~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m75[0m       });
    [7m  [0m [91m~~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m98[0m:[93m28[0m - [91merror[0m[90m 
TS2339: [0mProperty 'del' does not exist on type 'MemoryStorageProvider'.

    [7m98[0m       await memoryProvider.del(key);
    [7m  [0m [91m                           ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m147[0m:[93m22[0m - [91merror[0m[90m
 TS2554: [0mExpected 2 arguments, but got 1.

    [7m147[0m       cacheManager = new CacheManager({
    [7m   [0m [91m                     ~~~~~~~~~~~~~~~~~~[0m
    [7m148[0m         maxSize: 512 * 1024, // 512KB
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m151[0m         ttl: 60000 // 1 minute
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m152[0m       });
    [7m   [0m [91m~~~~~~~~[0m

      [96m../frontend/src/services/cache/CacheManager.ts[0m:[93m47[0m:[93m5[0m
        [7m47[0m     indexedDBProvider: IStorageProvider,
        [7m  [0m [96m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
        An argument for 'indexedDBProvider' was not provided.
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m150[0m:[93m19[0m - [91merror[0m[90m
 TS1362: [0m'CacheStrategy' cannot be used as a value because it was exported using 'export type'.

    [7m150[0m         strategy: CacheStrategy.LRU,
    [7m   [0m [91m                  ~~~~~~~~~~~~~[0m

      [96m../frontend/src/services/HybridStorageService.ts[0m:[93m57[0m:[93m3[0m
        [7m57[0m   CacheStrategy,
        [7m  [0m [96m  ~~~~~~~~~~~~~[0m
        'CacheStrategy' was exported here.
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m170[0m:[93m29[0m - [91merror[0m[90m
 TS2554: [0mExpected 2 arguments, but got 1.

    [7m170[0m       const shortTtlCache = new CacheManager({
    [7m   [0m [91m                            ~~~~~~~~~~~~~~~~~~[0m
    [7m171[0m         maxSize: 512 * 1024,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m174[0m         ttl: 1 // 1ms
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~[0m
    [7m175[0m       });
    [7m   [0m [91m~~~~~~~~[0m

      [96m../frontend/src/services/cache/CacheManager.ts[0m:[93m47[0m:[93m5[0m
        [7m47[0m     indexedDBProvider: IStorageProvider,
        [7m  [0m [96m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
        An argument for 'indexedDBProvider' was not provided.
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m173[0m:[93m19[0m - [91merror[0m[90m
 TS1362: [0m'CacheStrategy' cannot be used as a value because it was exported using 'export type'.

    [7m173[0m         strategy: CacheStrategy.LRU,
    [7m   [0m [91m                  ~~~~~~~~~~~~~[0m

      [96m../frontend/src/services/HybridStorageService.ts[0m:[93m57[0m:[93m3[0m
        [7m57[0m   CacheStrategy,
        [7m  [0m [96m  ~~~~~~~~~~~~~[0m
        'CacheStrategy' was exported here.
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m214[0m:[93m34[0m - [91merror[0m[90m
 TS2339: [0mProperty 'getStats' does not exist on type 'CacheManager'.

    [7m214[0m       const stats = cacheManager.getStats();
    [7m   [0m [91m                                 ~~~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m229[0m:[93m26[0m - [91merror[0m[90m
 TS2339: [0mProperty 'warm' does not exist on type 'CacheManager'.

    [7m229[0m       await cacheManager.warm(initialData);
    [7m   [0m [91m                         ~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m250[0m:[93m23[0m - [91merror[0m[90m
 TS1362: [0m'CacheStrategy' cannot be used as a value because it was exported using 'export type'.

    [7m250[0m             strategy: CacheStrategy.LRU,
    [7m   [0m [91m                      ~~~~~~~~~~~~~[0m

      [96m../frontend/src/services/HybridStorageService.ts[0m:[93m57[0m:[93m3[0m
        [7m57[0m   CacheStrategy,
        [7m  [0m [96m  ~~~~~~~~~~~~~[0m
        'CacheStrategy' was exported here.
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m273[0m:[93m27[0m - [91merror[0m[90m
 TS2339: [0mProperty 'set' does not exist on type 'HybridStorageManager'.

    [7m273[0m       await hybridStorage.set(key, testData, {
    [7m   [0m [91m                          ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m278[0m:[93m42[0m - [91merror[0m[90m
 TS2339: [0mProperty 'get' does not exist on type 'HybridStorageManager'.

    [7m278[0m       const result = await hybridStorage.get(key);
    [7m   [0m [91m                                         ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m287[0m:[93m27[0m - [91merror[0m[90m
 TS2339: [0mProperty 'set' does not exist on type 'HybridStorageManager'.

    [7m287[0m       await hybridStorage.set(key, testData, { tier: 'cold' });
    [7m   [0m [91m                          ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m291[0m:[93m29[0m - [91merror[0m[90m
 TS2339: [0mProperty 'get' does not exist on type 'HybridStorageManager'.

    [7m291[0m         await hybridStorage.get(key);
    [7m   [0m [91m                            ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m295[0m:[93m44[0m - [91merror[0m[90m
 TS2339: [0mProperty 'getMetadata' does not exist on type 'HybridStorageManager'.

    [7m295[0m       const metadata = await hybridStorage.getMetadata(key);
    [7m   [0m [91m                                           ~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m303[0m:[93m27[0m - [91merror[0m[90m
 TS2339: [0mProperty 'set' does not exist on type 'HybridStorageManager'.

    [7m303[0m       await hybridStorage.set(key, testData, {
    [7m   [0m [91m                          ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m309[0m:[93m46[0m - [91merror[0m[90m
 TS2339: [0mProperty 'sync' does not exist on type 'HybridStorageManager'.

    [7m309[0m       const syncResult = await hybridStorage.sync();
    [7m   [0m [91m                                             ~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m319[0m:[93m41[0m - [91merror[0m[90m
 TS2339: [0mProperty 'set' does not exist on type 'HybridStorageManager'.

    [7m319[0m       const originalSet = hybridStorage.set;
    [7m   [0m [91m                                        ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m320[0m:[93m21[0m - [91merror[0m[90m
 TS2339: [0mProperty 'set' does not exist on type 'HybridStorageManager'.

    [7m320[0m       hybridStorage.set = jest.fn().mockImplementation(async (key, data, options) => {
    [7m   [0m [91m                    ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m322[0m:[93m28[0m - [91merror[0m[90m
 TS2339: [0mProperty 'set' does not exist on type 'HybridStorageManager'.

    [7m322[0m         if (!hybridStorage.set.mock.calls.length) {
    [7m   [0m [91m                           ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m328[0m:[93m27[0m - [91merror[0m[90m
 TS2339: [0mProperty 'set' does not exist on type 'HybridStorageManager'.

    [7m328[0m       await hybridStorage.set(key, testData, { tier: 'hot' });
    [7m   [0m [91m                          ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m330[0m:[93m42[0m - [91merror[0m[90m
 TS2339: [0mProperty 'get' does not exist on type 'HybridStorageManager'.

    [7m330[0m       const result = await hybridStorage.get(key);
    [7m   [0m [91m                                         ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m346[0m:[93m27[0m - [91merror[0m[90m
 TS2339: [0mProperty 'set' does not exist on type 'HybridStorageManager'.

    [7m346[0m       await hybridStorage.set(key, largeData, {
    [7m   [0m [91m                          ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m351[0m:[93m42[0m - [91merror[0m[90m
 TS2339: [0mProperty 'get' does not exist on type 'HybridStorageManager'.

    [7m351[0m       const result = await hybridStorage.get(key);
    [7m   [0m [91m                                         ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m356[0m:[93m20[0m - [91merror[0m[90m
 TS2339: [0mProperty 'compressionRatio' does not exist on type '{ memory: any; indexedDB: any; fastgpt: any; c
ache: any; }'.

    [7m356[0m       expect(stats.compressionRatio).toBeLessThan(1.0);
    [7m   [0m [91m                   ~~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m368[0m:[93m27[0m - [91merror[0m[90m
 TS2339: [0mProperty 'set' does not exist on type 'HybridStorageManager'.

    [7m368[0m       await hybridStorage.set(key, sensitiveData, {
    [7m   [0m [91m                          ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m373[0m:[93m42[0m - [91merror[0m[90m
 TS2339: [0mProperty 'get' does not exist on type 'HybridStorageManager'.

    [7m373[0m       const result = await hybridStorage.get(key);
    [7m   [0m [91m                                         ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m377[0m:[93m45[0m - [91merror[0m[90m
 TS2339: [0mProperty 'getStorageProvider' does not exist on type 'HybridStorageManager'.

    [7m377[0m       const storageProvider = hybridStorage.getStorageProvider('cold');
    [7m   [0m [91m                                            ~~~~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m397[0m:[93m21[0m - [91merror[0m[90m
 TS2554: [0mExpected 3-4 arguments, but got 1.

    [7m397[0m       syncManager = new SyncManager({
    [7m   [0m [91m                    ~~~~~~~~~~~~~~~~~[0m
    [7m398[0m         autoSync: false,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m402[0m         conflictResolution: 'prompt'
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m403[0m       });
    [7m   [0m [91m~~~~~~~~[0m

      [96m../frontend/src/services/sync/SyncManager.ts[0m:[93m38[0m:[93m5[0m
        [7m38[0m     indexedDBProvider: IStorageProvider,
        [7m  [0m [96m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
        An argument for 'indexedDBProvider' was not provided.
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m414[0m:[93m27[0m - [91merror[0m[90m
 TS2339: [0mProperty 'queueOperation' does not exist on type 'SyncManager'.

    [7m414[0m         await syncManager.queueOperation(op);
    [7m   [0m [91m                          ~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m417[0m:[93m38[0m - [91merror[0m[90m
 TS2339: [0mProperty 'getQueueStats' does not exist on type 'SyncManager'.

    [7m417[0m       const queueStats = syncManager.getQueueStats();
    [7m   [0m [91m                                     ~~~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m429[0m:[93m27[0m - [91merror[0m[90m
 TS2339: [0mProperty 'queueOperation' does not exist on type 'SyncManager'.

    [7m429[0m         await syncManager.queueOperation(op);
    [7m   [0m [91m                          ~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m432[0m:[93m44[0m - [91merror[0m[90m
 TS2339: [0mProperty 'processQueue' does not exist on type 'SyncManager'.

    [7m432[0m       const syncResult = await syncManager.processQueue(mockStorageProvider);
    [7m   [0m [91m                                           ~~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m451[0m:[93m25[0m - [91merror[0m[90m
 TS2339: [0mProperty 'queueOperation' does not exist on type 'SyncManager'.

    [7m451[0m       await syncManager.queueOperation(conflictOp);
    [7m   [0m [91m                        ~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m453[0m:[93m44[0m - [91merror[0m[90m
 TS2339: [0mProperty 'processQueue' does not exist on type 'SyncManager'.

    [7m453[0m       const syncResult = await syncManager.processQueue(mockStorageProvider);
    [7m   [0m [91m                                           ~~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m470[0m:[93m25[0m - [91merror[0m[90m
 TS2339: [0mProperty 'queueOperation' does not exist on type 'SyncManager'.

    [7m470[0m       await syncManager.queueOperation(retryOp);
    [7m   [0m [91m                        ~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m472[0m:[93m44[0m - [91merror[0m[90m
 TS2339: [0mProperty 'processQueue' does not exist on type 'SyncManager'.

    [7m472[0m       const syncResult = await syncManager.processQueue(mockStorageProvider);
    [7m   [0m [91m                                           ~~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m489[0m:[93m23[0m - [91merror[0m[90m
 TS1362: [0m'CacheStrategy' cannot be used as a value because it was exported using 'export type'.

    [7m489[0m             strategy: CacheStrategy.LFU,
    [7m   [0m [91m                      ~~~~~~~~~~~~~[0m

      [96m../frontend/src/services/HybridStorageService.ts[0m:[93m57[0m:[93m3[0m
        [7m57[0m   CacheStrategy,
        [7m  [0m [96m  ~~~~~~~~~~~~~[0m
        'CacheStrategy' was exported here.
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m522[0m:[93m27[0m - [91merror[0m[90m
 TS2339: [0mProperty 'set' does not exist on type 'HybridStorageManager'.

    [7m522[0m       await hybridStorage.set('text-data', textData, { tier: 'hot' });
    [7m   [0m [91m                          ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m523[0m:[93m27[0m - [91merror[0m[90m
 TS2339: [0mProperty 'set' does not exist on type 'HybridStorageManager'.

    [7m523[0m       await hybridStorage.set('binary-data', binaryData, { tier: 'warm' });
    [7m   [0m [91m                          ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m524[0m:[93m27[0m - [91merror[0m[90m
 TS2339: [0mProperty 'set' does not exist on type 'HybridStorageManager'.

    [7m524[0m       await hybridStorage.set('complex-data', complexObject, { tier: 'cold' });
    [7m   [0m [91m                          ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m527[0m:[93m49[0m - [91merror[0m[90m
 TS2339: [0mProperty 'get' does not exist on type 'HybridStorageManager'.

    [7m527[0m       const retrievedText = await hybridStorage.get('text-data');
    [7m   [0m [91m                                                ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m528[0m:[93m51[0m - [91merror[0m[90m
 TS2339: [0mProperty 'get' does not exist on type 'HybridStorageManager'.

    [7m528[0m       const retrievedBinary = await hybridStorage.get('binary-data');
    [7m   [0m [91m                                                  ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m529[0m:[93m52[0m - [91merror[0m[90m
 TS2339: [0mProperty 'get' does not exist on type 'HybridStorageManager'.

    [7m529[0m       const retrievedComplex = await hybridStorage.get('complex-data');
    [7m   [0m [91m                                                   ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m536[0m:[93m48[0m - [91merror[0m[90m
 TS2339: [0mProperty 'getMetadata' does not exist on type 'HybridStorageManager'.

    [7m536[0m       const textMetadata = await hybridStorage.getMetadata('text-data');
    [7m   [0m [91m                                               ~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m537[0m:[93m50[0m - [91merror[0m[90m
 TS2339: [0mProperty 'getMetadata' does not exist on type 'HybridStorageManager'.

    [7m537[0m       const binaryMetadata = await hybridStorage.getMetadata('binary-data');
    [7m   [0m [91m                                                 ~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m538[0m:[93m51[0m - [91merror[0m[90m
 TS2339: [0mProperty 'getMetadata' does not exist on type 'HybridStorageManager'.

    [7m538[0m       const complexMetadata = await hybridStorage.getMetadata('complex-data');
    [7m   [0m [91m                                                  ~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m555[0m:[93m25[0m - [91merror[0m[90m
 TS2339: [0mProperty 'set' does not exist on type 'HybridStorageManager'.

    [7m555[0m           hybridStorage.set(op.key, op.data, { tier: op.tier })
    [7m   [0m [91m                        ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m561[0m:[93m44[0m - [91merror[0m[90m
 TS2339: [0mProperty 'get' does not exist on type 'HybridStorageManager'.

    [7m561[0m         operations.map(op => hybridStorage.get(op.key))
    [7m   [0m [91m                                           ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m564[0m:[93m24[0m - [91merror[0m[90m
 TS7006: [0mParameter 'result' implicitly has an 'any' type.

    [7m564[0m       results.forEach((result, index) => {
    [7m   [0m [91m                       ~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m564[0m:[93m32[0m - [91merror[0m[90m
 TS7006: [0mParameter 'index' implicitly has an 'any' type.

    [7m564[0m       results.forEach((result, index) => {
    [7m   [0m [91m                               ~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m565[0m:[93m32[0m - [91merror[0m[90m
 TS2532: [0mObject is possibly 'undefined'.

    [7m565[0m         expect(result).toEqual(operations[index].data);
    [7m   [0m [91m                               ~~~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m570[0m:[93m20[0m - [91merror[0m[90m
 TS2339: [0mProperty 'totalEntries' does not exist on type '{ memory: any; indexedDB: any; fastgpt: any; cache
: any; }'.

    [7m570[0m       expect(stats.totalEntries).toBe(20);
    [7m   [0m [91m                   ~~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m577[0m:[93m9[0m - [91merror[0m[90m 
TS2554: [0mExpected 2 arguments, but got 1.

    [7m577[0m         new CacheManager({
    [7m   [0m [91m        ~~~~~~~~~~~~~~~~~~[0m
    [7m578[0m           maxSize: 1024,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m581[0m           ttl: 60000
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~[0m
    [7m582[0m         });
    [7m   [0m [91m~~~~~~~~~~[0m

      [96m../frontend/src/services/cache/CacheManager.ts[0m:[93m47[0m:[93m5[0m
        [7m47[0m     indexedDBProvider: IStorageProvider,
        [7m  [0m [96m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
        An argument for 'indexedDBProvider' was not provided.
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m587[0m:[93m28[0m - [91merror[0m[90m
 TS2554: [0mExpected 2 arguments, but got 1.

    [7m587[0m       const cacheManager = new CacheManager({
    [7m   [0m [91m                           ~~~~~~~~~~~~~~~~~~[0m
    [7m588[0m         maxSize: 1024,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m591[0m         ttl: 60000
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~[0m
    [7m592[0m       });
    [7m   [0m [91m~~~~~~~~[0m

      [96m../frontend/src/services/cache/CacheManager.ts[0m:[93m47[0m:[93m5[0m
        [7m47[0m     indexedDBProvider: IStorageProvider,
        [7m  [0m [96m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
        An argument for 'indexedDBProvider' was not provided.
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m590[0m:[93m19[0m - [91merror[0m[90m
 TS1362: [0m'CacheStrategy' cannot be used as a value because it was exported using 'export type'.

    [7m590[0m         strategy: CacheStrategy.LRU,
    [7m   [0m [91m                  ~~~~~~~~~~~~~[0m

      [96m../frontend/src/services/HybridStorageService.ts[0m:[93m57[0m:[93m3[0m
        [7m57[0m   CacheStrategy,
        [7m  [0m [96m  ~~~~~~~~~~~~~[0m
        'CacheStrategy' was exported here.
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m607[0m:[93m23[0m - [91merror[0m[90m
 TS1362: [0m'CacheStrategy' cannot be used as a value because it was exported using 'export type'.

    [7m607[0m             strategy: CacheStrategy.LRU,
    [7m   [0m [91m                      ~~~~~~~~~~~~~[0m

      [96m../frontend/src/services/HybridStorageService.ts[0m:[93m57[0m:[93m3[0m
        [7m57[0m   CacheStrategy,
        [7m  [0m [96m  ~~~~~~~~~~~~~[0m
        'CacheStrategy' was exported here.
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m617[0m:[93m29[0m - [91merror[0m[90m
 TS2339: [0mProperty 'set' does not exist on type 'HybridStorageManager'.

    [7m617[0m         await hybridStorage.set('large1', 'x'.repeat(1000));
    [7m   [0m [91m                            ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m618[0m:[93m29[0m - [91merror[0m[90m
 TS2339: [0mProperty 'set' does not exist on type 'HybridStorageManager'.

    [7m618[0m         await hybridStorage.set('large2', 'x'.repeat(1000));
    [7m   [0m [91m                            ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m619[0m:[93m29[0m - [91merror[0m[90m
 TS2339: [0mProperty 'set' does not exist on type 'HybridStorageManager'.

    [7m619[0m         await hybridStorage.set('large3', 'x'.repeat(1000)); // Should trigger eviction
    [7m   [0m [91m                            ~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m622[0m:[93m22[0m - [91merror[0m[90m
 TS2339: [0mProperty 'totalEntries' does not exist on type '{ memory: any; indexedDB: any; fastgpt: any; cache
: any; }'.

    [7m622[0m         expect(stats.totalEntries).toBeLessThanOrEqual(2);
    [7m   [0m [91m                     ~~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m629[0m:[93m27[0m - [91merror[0m[90m
 TS2554: [0mExpected 3-4 arguments, but got 1.

    [7m629[0m       const syncManager = new SyncManager({
    [7m   [0m [91m                          ~~~~~~~~~~~~~~~~~[0m
    [7m630[0m         autoSync: false,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m634[0m         networkTimeout: 100
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m635[0m       });
    [7m   [0m [91m~~~~~~~~[0m

      [96m../frontend/src/services/sync/SyncManager.ts[0m:[93m38[0m:[93m5[0m
        [7m38[0m     indexedDBProvider: IStorageProvider,
        [7m  [0m [96m    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~[0m
        An argument for 'indexedDBProvider' was not provided.
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m652[0m:[93m25[0m - [91merror[0m[90m
 TS2339: [0mProperty 'queueOperation' does not exist on type 'SyncManager'.

    [7m652[0m       await syncManager.queueOperation(operation);
    [7m   [0m [91m                        ~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/HybridStorageService.test.ts[0m:[93m654[0m:[93m44[0m - [91merror[0m[90m
 TS2339: [0mProperty 'processQueue' does not exist on type 'SyncManager'.

    [7m654[0m       const syncResult = await syncManager.processQueue(mockNetworkProvider);
    [7m   [0m [91m                                           ~~~~~~~~~~~~[0m

PASS src/__tests__/testUtils.ts
FAIL src/__tests__/integration/chatController.integration.test.ts
  ● Console

    console.error
      Test app error: TypeError: router.post is not a function
          at authRoutes (F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:84:10)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:45:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:32:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at urlencodedParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-p
arser\lib\types\urlencoded.js:85:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-parser\lib\read.js:
137:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\ind
ex.js:238:16)
          at done (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\index.js:227:
7)
          at IncomingMessage.onEnd (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-b
ody\index.js:287:7)
          at IncomingMessage.emit (node:events:507:28)
          at IncomingMessage.emit (node:domain:489:12)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21)

    [0m [90m 67 |[39m   [90m// 错误处理中间件[39m
     [90m 68 |[39m   app[33m.[39muse((error[33m:[39m [33mError[39m[33m,[39m req[33m:[39m [33mReque
st[39m[33m,[39m res[33m:[39m [33mResponse[39m[33m,[39m next[33m:[39m [33mNextFunction[39m) [33m=>
[39m {
    [31m[1m>[22m[39m[90m 69 |[39m     console[33m.[39merror([32m'Test app error:'[39m[33m,[39m erro
r)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 70 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 71 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 72 |[39m       error[33m:[39m error[33m.[39mmessage[0m

      at src/__tests__/testUtils.ts:69:13
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:71:5
)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:67:1
2)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:365:14)
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:376:14)
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:4
21:3)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:97:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:45:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:32:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/urlencod
ed.js:85:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at ../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
      at done (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:287:7)

    console.error
      Test app error: TypeError: router.post is not a function
          at chatRoutes (F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:223:10)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:45:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:32:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at urlencodedParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-p
arser\lib\types\urlencoded.js:94:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at jsonParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-parser\
lib\types\json.js:113:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at expressInit (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\mid
dleware\init.js:40:5)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at query (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\middlewar
e\query.js:45:5)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at router.handle (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\r
outer\index.js:175:3)
          at app.handle (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\appl
ication.js:181:10)
          at Server.app (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\expr
ess.js:39:9)
          at Server.emit (node:events:507:28)
          at Server.emit (node:domain:489:12)
          at parserOnIncoming (node:_http_server:1153:12)
          at HTTPParser.parserOnHeadersComplete (node:_http_common:117:17)

    [0m [90m 67 |[39m   [90m// 错误处理中间件[39m
     [90m 68 |[39m   app[33m.[39muse((error[33m:[39m [33mError[39m[33m,[39m req[33m:[39m [33mReque
st[39m[33m,[39m res[33m:[39m [33mResponse[39m[33m,[39m next[33m:[39m [33mNextFunction[39m) [33m=>
[39m {
    [31m[1m>[22m[39m[90m 69 |[39m     console[33m.[39merror([32m'Test app error:'[39m[33m,[39m erro
r)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 70 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 71 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 72 |[39m       error[33m:[39m error[33m.[39mmessage[0m

      at src/__tests__/testUtils.ts:69:13
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:71:5
)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:67:1
2)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:365:14)
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:376:14)
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:4
21:3)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:97:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:45:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:32:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/urlencod
ed.js:94:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at jsonParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at expressInit (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at query (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at router.handle (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:175:3)
      at app.handle (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/application.js:181:10)
      at Server.app (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/express.js:39:9)

    console.error
      Test app error: TypeError: router.post is not a function
          at chatRoutes (F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:223:10)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:45:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:32:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at urlencodedParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-p
arser\lib\types\urlencoded.js:94:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at jsonParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-parser\
lib\types\json.js:113:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at expressInit (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\mid
dleware\init.js:40:5)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at query (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\middlewar
e\query.js:45:5)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at router.handle (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\r
outer\index.js:175:3)
          at app.handle (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\appl
ication.js:181:10)
          at Server.app (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\expr
ess.js:39:9)
          at Server.emit (node:events:507:28)
          at Server.emit (node:domain:489:12)
          at parserOnIncoming (node:_http_server:1153:12)
          at HTTPParser.parserOnHeadersComplete (node:_http_common:117:17)

    [0m [90m 67 |[39m   [90m// 错误处理中间件[39m
     [90m 68 |[39m   app[33m.[39muse((error[33m:[39m [33mError[39m[33m,[39m req[33m:[39m [33mReque
st[39m[33m,[39m res[33m:[39m [33mResponse[39m[33m,[39m next[33m:[39m [33mNextFunction[39m) [33m=>
[39m {
    [31m[1m>[22m[39m[90m 69 |[39m     console[33m.[39merror([32m'Test app error:'[39m[33m,[39m erro
r)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 70 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 71 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 72 |[39m       error[33m:[39m error[33m.[39mmessage[0m

      at src/__tests__/testUtils.ts:69:13
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:71:5
)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:67:1
2)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:365:14)
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:376:14)
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:4
21:3)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:97:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:45:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:32:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/urlencod
ed.js:94:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at jsonParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at expressInit (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at query (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at router.handle (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:175:3)
      at app.handle (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/application.js:181:10)
      at Server.app (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/express.js:39:9)

    console.error
      Test app error: TypeError: router.post is not a function
          at chatRoutes (F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:223:10)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:45:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:32:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at urlencodedParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-p
arser\lib\types\urlencoded.js:85:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-parser\lib\read.js:
137:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\ind
ex.js:238:16)
          at done (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\index.js:227:
7)
          at IncomingMessage.onEnd (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-b
ody\index.js:287:7)
          at IncomingMessage.emit (node:events:507:28)
          at IncomingMessage.emit (node:domain:489:12)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21)

    [0m [90m 67 |[39m   [90m// 错误处理中间件[39m
     [90m 68 |[39m   app[33m.[39muse((error[33m:[39m [33mError[39m[33m,[39m req[33m:[39m [33mReque
st[39m[33m,[39m res[33m:[39m [33mResponse[39m[33m,[39m next[33m:[39m [33mNextFunction[39m) [33m=>
[39m {
    [31m[1m>[22m[39m[90m 69 |[39m     console[33m.[39merror([32m'Test app error:'[39m[33m,[39m erro
r)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 70 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 71 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 72 |[39m       error[33m:[39m error[33m.[39mmessage[0m

      at src/__tests__/testUtils.ts:69:13
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:71:5
)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:67:1
2)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:365:14)
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:376:14)
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:4
21:3)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:97:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:45:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:32:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/urlencod
ed.js:85:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at ../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
      at done (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:287:7)

    console.error
      Test app error: TypeError: router.post is not a function
          at chatRoutes (F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:223:10)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:45:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:32:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at urlencodedParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-p
arser\lib\types\urlencoded.js:94:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at jsonParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-parser\
lib\types\json.js:113:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at expressInit (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\mid
dleware\init.js:40:5)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at query (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\middlewar
e\query.js:45:5)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at router.handle (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\r
outer\index.js:175:3)
          at app.handle (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\appl
ication.js:181:10)
          at Server.app (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\expr
ess.js:39:9)
          at Server.emit (node:events:507:28)
          at Server.emit (node:domain:489:12)
          at parserOnIncoming (node:_http_server:1153:12)
          at HTTPParser.parserOnHeadersComplete (node:_http_common:117:17)

    [0m [90m 67 |[39m   [90m// 错误处理中间件[39m
     [90m 68 |[39m   app[33m.[39muse((error[33m:[39m [33mError[39m[33m,[39m req[33m:[39m [33mReque
st[39m[33m,[39m res[33m:[39m [33mResponse[39m[33m,[39m next[33m:[39m [33mNextFunction[39m) [33m=>
[39m {
    [31m[1m>[22m[39m[90m 69 |[39m     console[33m.[39merror([32m'Test app error:'[39m[33m,[39m erro
r)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 70 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 71 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 72 |[39m       error[33m:[39m error[33m.[39mmessage[0m

      at src/__tests__/testUtils.ts:69:13
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:71:5
)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:67:1
2)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:365:14)
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:376:14)
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:4
21:3)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:97:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:45:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:32:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/urlencod
ed.js:94:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at jsonParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at expressInit (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at query (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at router.handle (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:175:3)
      at app.handle (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/application.js:181:10)
      at Server.app (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/express.js:39:9)

    console.error
      Test app error: TypeError: router.post is not a function
          at chatRoutes (F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:223:10)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:45:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:32:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at urlencodedParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-p
arser\lib\types\urlencoded.js:85:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-parser\lib\read.js:
137:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\ind
ex.js:238:16)
          at done (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\index.js:227:
7)
          at IncomingMessage.onEnd (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-b
ody\index.js:287:7)
          at IncomingMessage.emit (node:events:507:28)
          at IncomingMessage.emit (node:domain:489:12)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21)

    [0m [90m 67 |[39m   [90m// 错误处理中间件[39m
     [90m 68 |[39m   app[33m.[39muse((error[33m:[39m [33mError[39m[33m,[39m req[33m:[39m [33mReque
st[39m[33m,[39m res[33m:[39m [33mResponse[39m[33m,[39m next[33m:[39m [33mNextFunction[39m) [33m=>
[39m {
    [31m[1m>[22m[39m[90m 69 |[39m     console[33m.[39merror([32m'Test app error:'[39m[33m,[39m erro
r)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 70 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 71 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 72 |[39m       error[33m:[39m error[33m.[39mmessage[0m

      at src/__tests__/testUtils.ts:69:13
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:71:5
)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:67:1
2)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:365:14)
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:376:14)
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:4
21:3)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:97:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:45:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:32:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/urlencod
ed.js:85:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at ../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
      at done (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:287:7)

    console.error
      Test app error: TypeError: router.post is not a function
          at chatRoutes (F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:223:10)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:45:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:32:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at urlencodedParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-p
arser\lib\types\urlencoded.js:85:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-parser\lib\read.js:
137:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\ind
ex.js:238:16)
          at done (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\index.js:227:
7)
          at IncomingMessage.onEnd (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-b
ody\index.js:287:7)
          at IncomingMessage.emit (node:events:507:28)
          at IncomingMessage.emit (node:domain:489:12)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21)

    [0m [90m 67 |[39m   [90m// 错误处理中间件[39m
     [90m 68 |[39m   app[33m.[39muse((error[33m:[39m [33mError[39m[33m,[39m req[33m:[39m [33mReque
st[39m[33m,[39m res[33m:[39m [33mResponse[39m[33m,[39m next[33m:[39m [33mNextFunction[39m) [33m=>
[39m {
    [31m[1m>[22m[39m[90m 69 |[39m     console[33m.[39merror([32m'Test app error:'[39m[33m,[39m erro
r)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 70 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 71 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 72 |[39m       error[33m:[39m error[33m.[39mmessage[0m

      at src/__tests__/testUtils.ts:69:13
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:71:5
)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:67:1
2)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:365:14)
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:376:14)
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:4
21:3)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:97:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:45:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:32:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/urlencod
ed.js:85:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at ../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
      at done (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:287:7)

    console.error
      Test app error: TypeError: router.post is not a function
          at chatRoutes (F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:223:10)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:45:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:32:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at urlencodedParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-p
arser\lib\types\urlencoded.js:85:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-parser\lib\read.js:
137:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\ind
ex.js:238:16)
          at done (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\index.js:227:
7)
          at IncomingMessage.onEnd (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-b
ody\index.js:287:7)
          at IncomingMessage.emit (node:events:507:28)
          at IncomingMessage.emit (node:domain:489:12)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21)

    [0m [90m 67 |[39m   [90m// 错误处理中间件[39m
     [90m 68 |[39m   app[33m.[39muse((error[33m:[39m [33mError[39m[33m,[39m req[33m:[39m [33mReque
st[39m[33m,[39m res[33m:[39m [33mResponse[39m[33m,[39m next[33m:[39m [33mNextFunction[39m) [33m=>
[39m {
    [31m[1m>[22m[39m[90m 69 |[39m     console[33m.[39merror([32m'Test app error:'[39m[33m,[39m erro
r)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 70 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 71 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 72 |[39m       error[33m:[39m error[33m.[39mmessage[0m

      at src/__tests__/testUtils.ts:69:13
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:71:5
)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:67:1
2)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:365:14)
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:376:14)
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:4
21:3)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:97:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:45:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:32:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/urlencod
ed.js:85:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at ../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
      at done (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:287:7)

    console.error
      Test app error: TypeError: router.post is not a function
          at chatRoutes (F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:223:10)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:45:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:32:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at urlencodedParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-p
arser\lib\types\urlencoded.js:85:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-parser\lib\read.js:
137:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\ind
ex.js:238:16)
          at done (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\index.js:227:
7)
          at IncomingMessage.onEnd (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-b
ody\index.js:287:7)
          at IncomingMessage.emit (node:events:507:28)
          at IncomingMessage.emit (node:domain:489:12)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21)

    [0m [90m 67 |[39m   [90m// 错误处理中间件[39m
     [90m 68 |[39m   app[33m.[39muse((error[33m:[39m [33mError[39m[33m,[39m req[33m:[39m [33mReque
st[39m[33m,[39m res[33m:[39m [33mResponse[39m[33m,[39m next[33m:[39m [33mNextFunction[39m) [33m=>
[39m {
    [31m[1m>[22m[39m[90m 69 |[39m     console[33m.[39merror([32m'Test app error:'[39m[33m,[39m erro
r)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 70 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 71 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 72 |[39m       error[33m:[39m error[33m.[39mmessage[0m

      at src/__tests__/testUtils.ts:69:13
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:71:5
)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:67:1
2)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:365:14)
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:376:14)
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:4
21:3)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:97:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:45:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:32:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/urlencod
ed.js:85:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at ../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
      at done (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:287:7)

    console.error
      Test app error: TypeError: router.post is not a function
          at chatRoutes (F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:223:10)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:45:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:32:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at urlencodedParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-p
arser\lib\types\urlencoded.js:85:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-parser\lib\read.js:
137:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\ind
ex.js:238:16)
          at done (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\index.js:227:
7)
          at IncomingMessage.onEnd (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-b
ody\index.js:287:7)
          at IncomingMessage.emit (node:events:507:28)
          at IncomingMessage.emit (node:domain:489:12)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21)

    [0m [90m 67 |[39m   [90m// 错误处理中间件[39m
     [90m 68 |[39m   app[33m.[39muse((error[33m:[39m [33mError[39m[33m,[39m req[33m:[39m [33mReque
st[39m[33m,[39m res[33m:[39m [33mResponse[39m[33m,[39m next[33m:[39m [33mNextFunction[39m) [33m=>
[39m {
    [31m[1m>[22m[39m[90m 69 |[39m     console[33m.[39merror([32m'Test app error:'[39m[33m,[39m erro
r)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 70 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 71 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 72 |[39m       error[33m:[39m error[33m.[39mmessage[0m

      at src/__tests__/testUtils.ts:69:13
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:71:5
)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:67:1
2)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:365:14)
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:376:14)
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:4
21:3)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:97:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:45:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:32:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/urlencod
ed.js:85:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at ../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
      at done (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:287:7)

    console.error
      Test app error: TypeError: router.post is not a function
          at chatRoutes (F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:223:10)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:45:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:32:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at urlencodedParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-p
arser\lib\types\urlencoded.js:85:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-parser\lib\read.js:
137:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\ind
ex.js:238:16)
          at done (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\index.js:227:
7)
          at IncomingMessage.onEnd (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-b
ody\index.js:287:7)
          at IncomingMessage.emit (node:events:507:28)
          at IncomingMessage.emit (node:domain:489:12)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21)

    [0m [90m 67 |[39m   [90m// 错误处理中间件[39m
     [90m 68 |[39m   app[33m.[39muse((error[33m:[39m [33mError[39m[33m,[39m req[33m:[39m [33mReque
st[39m[33m,[39m res[33m:[39m [33mResponse[39m[33m,[39m next[33m:[39m [33mNextFunction[39m) [33m=>
[39m {
    [31m[1m>[22m[39m[90m 69 |[39m     console[33m.[39merror([32m'Test app error:'[39m[33m,[39m erro
r)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 70 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 71 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 72 |[39m       error[33m:[39m error[33m.[39mmessage[0m

      at src/__tests__/testUtils.ts:69:13
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:71:5
)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:67:1
2)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:365:14)
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:376:14)
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:4
21:3)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:97:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:45:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:32:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/urlencod
ed.js:85:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at ../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
      at done (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:287:7)

    console.error
      Test app error: TypeError: router.post is not a function
          at chatRoutes (F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:223:10)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:45:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:32:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at urlencodedParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-p
arser\lib\types\urlencoded.js:85:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-parser\lib\read.js:
137:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\ind
ex.js:238:16)
          at done (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\index.js:227:
7)
          at IncomingMessage.onEnd (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-b
ody\index.js:287:7)
          at IncomingMessage.emit (node:events:507:28)
          at IncomingMessage.emit (node:domain:489:12)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21)

    [0m [90m 67 |[39m   [90m// 错误处理中间件[39m
     [90m 68 |[39m   app[33m.[39muse((error[33m:[39m [33mError[39m[33m,[39m req[33m:[39m [33mReque
st[39m[33m,[39m res[33m:[39m [33mResponse[39m[33m,[39m next[33m:[39m [33mNextFunction[39m) [33m=>
[39m {
    [31m[1m>[22m[39m[90m 69 |[39m     console[33m.[39merror([32m'Test app error:'[39m[33m,[39m erro
r)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 70 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 71 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 72 |[39m       error[33m:[39m error[33m.[39mmessage[0m

      at src/__tests__/testUtils.ts:69:13
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:71:5
)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:67:1
2)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:365:14)
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:376:14)
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:4
21:3)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:97:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:45:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:32:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/urlencod
ed.js:85:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at ../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
      at done (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:287:7)

    console.error
      Test app error: TypeError: router.post is not a function
          at chatRoutes (F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:223:10)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:45:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:32:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at urlencodedParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-p
arser\lib\types\urlencoded.js:85:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-parser\lib\read.js:
137:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\ind
ex.js:238:16)
          at done (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\index.js:227:
7)
          at IncomingMessage.onEnd (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-b
ody\index.js:287:7)
          at IncomingMessage.emit (node:events:507:28)
          at IncomingMessage.emit (node:domain:489:12)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21)

    [0m [90m 67 |[39m   [90m// 错误处理中间件[39m
     [90m 68 |[39m   app[33m.[39muse((error[33m:[39m [33mError[39m[33m,[39m req[33m:[39m [33mReque
st[39m[33m,[39m res[33m:[39m [33mResponse[39m[33m,[39m next[33m:[39m [33mNextFunction[39m) [33m=>
[39m {
    [31m[1m>[22m[39m[90m 69 |[39m     console[33m.[39merror([32m'Test app error:'[39m[33m,[39m erro
r)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 70 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 71 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 72 |[39m       error[33m:[39m error[33m.[39mmessage[0m

      at src/__tests__/testUtils.ts:69:13
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:71:5
)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:67:1
2)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:365:14)
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:376:14)
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:4
21:3)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:97:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:45:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:32:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/urlencod
ed.js:85:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at ../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
      at done (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:287:7)

    console.error
      Test app error: TypeError: router.post is not a function
          at chatRoutes (F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:223:10)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:45:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:32:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at urlencodedParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-p
arser\lib\types\urlencoded.js:85:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-parser\lib\read.js:
137:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\ind
ex.js:238:16)
          at done (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\index.js:227:
7)
          at IncomingMessage.onEnd (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-b
ody\index.js:287:7)
          at IncomingMessage.emit (node:events:507:28)
          at IncomingMessage.emit (node:domain:489:12)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21)

    [0m [90m 67 |[39m   [90m// 错误处理中间件[39m
     [90m 68 |[39m   app[33m.[39muse((error[33m:[39m [33mError[39m[33m,[39m req[33m:[39m [33mReque
st[39m[33m,[39m res[33m:[39m [33mResponse[39m[33m,[39m next[33m:[39m [33mNextFunction[39m) [33m=>
[39m {
    [31m[1m>[22m[39m[90m 69 |[39m     console[33m.[39merror([32m'Test app error:'[39m[33m,[39m erro
r)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 70 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 71 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 72 |[39m       error[33m:[39m error[33m.[39mmessage[0m

      at src/__tests__/testUtils.ts:69:13
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:71:5
)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:67:1
2)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:365:14)
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:376:14)
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:4
21:3)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:97:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:45:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:32:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/urlencod
ed.js:85:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at ../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
      at done (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:287:7)

    console.error
      Test app error: TypeError: router.post is not a function
          at chatRoutes (F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:223:10)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:45:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:32:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at urlencodedParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-p
arser\lib\types\urlencoded.js:85:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-parser\lib\read.js:
137:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\ind
ex.js:238:16)
          at done (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\index.js:227:
7)
          at IncomingMessage.onEnd (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-b
ody\index.js:287:7)
          at IncomingMessage.emit (node:events:507:28)
          at IncomingMessage.emit (node:domain:489:12)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21)

    [0m [90m 67 |[39m   [90m// 错误处理中间件[39m
     [90m 68 |[39m   app[33m.[39muse((error[33m:[39m [33mError[39m[33m,[39m req[33m:[39m [33mReque
st[39m[33m,[39m res[33m:[39m [33mResponse[39m[33m,[39m next[33m:[39m [33mNextFunction[39m) [33m=>
[39m {
    [31m[1m>[22m[39m[90m 69 |[39m     console[33m.[39merror([32m'Test app error:'[39m[33m,[39m erro
r)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 70 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 71 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 72 |[39m       error[33m:[39m error[33m.[39mmessage[0m

      at src/__tests__/testUtils.ts:69:13
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:71:5
)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:67:1
2)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:365:14)
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:376:14)
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:4
21:3)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:97:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:45:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:32:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/urlencod
ed.js:85:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at ../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
      at done (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:287:7)

    console.error
      Test app error: TypeError: router.post is not a function
          at chatRoutes (F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:223:10)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:45:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:32:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at urlencodedParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-p
arser\lib\types\urlencoded.js:85:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-parser\lib\read.js:
137:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\ind
ex.js:238:16)
          at done (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\index.js:227:
7)
          at IncomingMessage.onEnd (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-b
ody\index.js:287:7)
          at IncomingMessage.emit (node:events:507:28)
          at IncomingMessage.emit (node:domain:489:12)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21)

    [0m [90m 67 |[39m   [90m// 错误处理中间件[39m
     [90m 68 |[39m   app[33m.[39muse((error[33m:[39m [33mError[39m[33m,[39m req[33m:[39m [33mReque
st[39m[33m,[39m res[33m:[39m [33mResponse[39m[33m,[39m next[33m:[39m [33mNextFunction[39m) [33m=>
[39m {
    [31m[1m>[22m[39m[90m 69 |[39m     console[33m.[39merror([32m'Test app error:'[39m[33m,[39m erro
r)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 70 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 71 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 72 |[39m       error[33m:[39m error[33m.[39mmessage[0m

      at src/__tests__/testUtils.ts:69:13
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:71:5
)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:67:1
2)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:365:14)
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:376:14)
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:4
21:3)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:97:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:45:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:32:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/urlencod
ed.js:85:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at ../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
      at done (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:287:7)

    console.error
      Test app error: TypeError: router.post is not a function
          at chatRoutes (F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:223:10)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:45:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:32:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at urlencodedParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-p
arser\lib\types\urlencoded.js:85:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-parser\lib\read.js:
137:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\ind
ex.js:238:16)
          at done (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\index.js:227:
7)
          at IncomingMessage.onEnd (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-b
ody\index.js:287:7)
          at IncomingMessage.emit (node:events:507:28)
          at IncomingMessage.emit (node:domain:489:12)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21)

    [0m [90m 67 |[39m   [90m// 错误处理中间件[39m
     [90m 68 |[39m   app[33m.[39muse((error[33m:[39m [33mError[39m[33m,[39m req[33m:[39m [33mReque
st[39m[33m,[39m res[33m:[39m [33mResponse[39m[33m,[39m next[33m:[39m [33mNextFunction[39m) [33m=>
[39m {
    [31m[1m>[22m[39m[90m 69 |[39m     console[33m.[39merror([32m'Test app error:'[39m[33m,[39m erro
r)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 70 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 71 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 72 |[39m       error[33m:[39m error[33m.[39mmessage[0m

      at src/__tests__/testUtils.ts:69:13
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:71:5
)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:67:1
2)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:365:14)
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:376:14)
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:4
21:3)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:97:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:45:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:32:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/urlencod
ed.js:85:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at ../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
      at done (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:287:7)

    console.error
      Test app error: TypeError: router.post is not a function
          at chatRoutes (F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:223:10)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:45:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:32:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at urlencodedParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-p
arser\lib\types\urlencoded.js:85:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-parser\lib\read.js:
137:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\ind
ex.js:238:16)
          at done (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\index.js:227:
7)
          at IncomingMessage.onEnd (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-b
ody\index.js:287:7)
          at IncomingMessage.emit (node:events:507:28)
          at IncomingMessage.emit (node:domain:489:12)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21)

    [0m [90m 67 |[39m   [90m// 错误处理中间件[39m
     [90m 68 |[39m   app[33m.[39muse((error[33m:[39m [33mError[39m[33m,[39m req[33m:[39m [33mReque
st[39m[33m,[39m res[33m:[39m [33mResponse[39m[33m,[39m next[33m:[39m [33mNextFunction[39m) [33m=>
[39m {
    [31m[1m>[22m[39m[90m 69 |[39m     console[33m.[39merror([32m'Test app error:'[39m[33m,[39m erro
r)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 70 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 71 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 72 |[39m       error[33m:[39m error[33m.[39mmessage[0m

      at src/__tests__/testUtils.ts:69:13
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:71:5
)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:67:1
2)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:365:14)
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:376:14)
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:4
21:3)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:97:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:45:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:32:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/urlencod
ed.js:85:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at ../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
      at done (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:287:7)

    console.error
      Test app error: TypeError: router.post is not a function
          at chatRoutes (F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:223:10)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:45:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:32:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at urlencodedParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-p
arser\lib\types\urlencoded.js:85:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-parser\lib\read.js:
137:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\ind
ex.js:238:16)
          at done (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\index.js:227:
7)
          at IncomingMessage.onEnd (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-b
ody\index.js:287:7)
          at IncomingMessage.emit (node:events:507:28)
          at IncomingMessage.emit (node:domain:489:12)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21)

    [0m [90m 67 |[39m   [90m// 错误处理中间件[39m
     [90m 68 |[39m   app[33m.[39muse((error[33m:[39m [33mError[39m[33m,[39m req[33m:[39m [33mReque
st[39m[33m,[39m res[33m:[39m [33mResponse[39m[33m,[39m next[33m:[39m [33mNextFunction[39m) [33m=>
[39m {
    [31m[1m>[22m[39m[90m 69 |[39m     console[33m.[39merror([32m'Test app error:'[39m[33m,[39m erro
r)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 70 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 71 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 72 |[39m       error[33m:[39m error[33m.[39mmessage[0m

      at src/__tests__/testUtils.ts:69:13
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:71:5
)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:67:1
2)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:365:14)
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:376:14)
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:4
21:3)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:97:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:45:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:32:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/urlencod
ed.js:85:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at ../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
      at done (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:287:7)

    console.error
      Test app error: TypeError: router.post is not a function
          at chatRoutes (F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:223:10)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:45:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:32:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at urlencodedParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-p
arser\lib\types\urlencoded.js:85:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-parser\lib\read.js:
137:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\ind
ex.js:238:16)
          at done (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\index.js:227:
7)
          at IncomingMessage.onEnd (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-b
ody\index.js:287:7)
          at IncomingMessage.emit (node:events:507:28)
          at IncomingMessage.emit (node:domain:489:12)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21)

    [0m [90m 67 |[39m   [90m// 错误处理中间件[39m
     [90m 68 |[39m   app[33m.[39muse((error[33m:[39m [33mError[39m[33m,[39m req[33m:[39m [33mReque
st[39m[33m,[39m res[33m:[39m [33mResponse[39m[33m,[39m next[33m:[39m [33mNextFunction[39m) [33m=>
[39m {
    [31m[1m>[22m[39m[90m 69 |[39m     console[33m.[39merror([32m'Test app error:'[39m[33m,[39m erro
r)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 70 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 71 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 72 |[39m       error[33m:[39m error[33m.[39mmessage[0m

      at src/__tests__/testUtils.ts:69:13
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:71:5
)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:67:1
2)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:365:14)
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:376:14)
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:4
21:3)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:97:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:45:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:32:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/urlencod
ed.js:85:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at ../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
      at done (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:287:7)

    console.error
      Test app error: TypeError: router.post is not a function
          at chatRoutes (F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:223:10)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:45:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:32:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at urlencodedParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-p
arser\lib\types\urlencoded.js:94:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at jsonParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-parser\
lib\types\json.js:113:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at expressInit (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\mid
dleware\init.js:40:5)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at query (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\middlewar
e\query.js:45:5)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at router.handle (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\r
outer\index.js:175:3)
          at app.handle (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\appl
ication.js:181:10)
          at Server.app (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\expr
ess.js:39:9)
          at Server.emit (node:events:507:28)
          at Server.emit (node:domain:489:12)
          at parserOnIncoming (node:_http_server:1153:12)
          at HTTPParser.parserOnHeadersComplete (node:_http_common:117:17)

    [0m [90m 67 |[39m   [90m// 错误处理中间件[39m
     [90m 68 |[39m   app[33m.[39muse((error[33m:[39m [33mError[39m[33m,[39m req[33m:[39m [33mReque
st[39m[33m,[39m res[33m:[39m [33mResponse[39m[33m,[39m next[33m:[39m [33mNextFunction[39m) [33m=>
[39m {
    [31m[1m>[22m[39m[90m 69 |[39m     console[33m.[39merror([32m'Test app error:'[39m[33m,[39m erro
r)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 70 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 71 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 72 |[39m       error[33m:[39m error[33m.[39mmessage[0m

      at src/__tests__/testUtils.ts:69:13
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:71:5
)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:67:1
2)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:365:14)
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:376:14)
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:4
21:3)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:97:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:45:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:32:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/urlencod
ed.js:94:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at jsonParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/json.js:113:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at expressInit (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at query (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at router.handle (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:175:3)
      at app.handle (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/application.js:181:10)
      at Server.app (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/express.js:39:9)

    console.error
      Test app error: TypeError: router.post is not a function
          at chatRoutes (F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:223:10)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:45:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:32:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-parser\lib\read.js:
137:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\ind
ex.js:238:16)
          at done (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\index.js:227:
7)
          at IncomingMessage.onEnd (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-b
ody\index.js:287:7)
          at IncomingMessage.emit (node:events:507:28)
          at IncomingMessage.emit (node:domain:489:12)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21)

    [0m [90m 67 |[39m   [90m// 错误处理中间件[39m
     [90m 68 |[39m   app[33m.[39muse((error[33m:[39m [33mError[39m[33m,[39m req[33m:[39m [33mReque
st[39m[33m,[39m res[33m:[39m [33mResponse[39m[33m,[39m next[33m:[39m [33mNextFunction[39m) [33m=>
[39m {
    [31m[1m>[22m[39m[90m 69 |[39m     console[33m.[39merror([32m'Test app error:'[39m[33m,[39m erro
r)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 70 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 71 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 72 |[39m       error[33m:[39m error[33m.[39mmessage[0m

      at src/__tests__/testUtils.ts:69:13
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:71:5
)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:67:1
2)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:365:14)
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:376:14)
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:4
21:3)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:97:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:45:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:32:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at ../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
      at done (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:287:7)

    console.error
      Test app error: TypeError: router.post is not a function
          at chatRoutes (F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:223:10)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:45:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\backend\src\__tests__\testUtils.ts:32:5
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at urlencodedParser (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-p
arser\lib\types\urlencoded.js:85:7)
          at Layer.handle [as handle_request] (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_mo
dules\express\lib\router\layer.js:95:5)
          at trim_prefix (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\rou
ter\index.js:328:13)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\index.js:
286:9
          at router.process_params (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\expre
ss\lib\router\index.js:346:12)
          at next (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\express@4.21.2\node_modules\express\lib\router\ind
ex.js:280:10)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\body-parser@1.20.3\node_modules\body-parser\lib\read.js:
137:5
          at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
          at invokeCallback (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\ind
ex.js:238:16)
          at done (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-body\index.js:227:
7)
          at IncomingMessage.onEnd (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\raw-body@2.5.2\node_modules\raw-b
ody\index.js:287:7)
          at IncomingMessage.emit (node:events:507:28)
          at IncomingMessage.emit (node:domain:489:12)
          at endReadableNT (node:internal/streams/readable:1701:12)
          at processTicksAndRejections (node:internal/process/task_queues:90:21)

    [0m [90m 67 |[39m   [90m// 错误处理中间件[39m
     [90m 68 |[39m   app[33m.[39muse((error[33m:[39m [33mError[39m[33m,[39m req[33m:[39m [33mReque
st[39m[33m,[39m res[33m:[39m [33mResponse[39m[33m,[39m next[33m:[39m [33mNextFunction[39m) [33m=>
[39m {
    [31m[1m>[22m[39m[90m 69 |[39m     console[33m.[39merror([32m'Test app error:'[39m[33m,[39m erro
r)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 70 |[39m     res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 71 |[39m       success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 72 |[39m       error[33m:[39m error[33m.[39mmessage[0m

      at src/__tests__/testUtils.ts:69:13
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:71:5
)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle_error (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:67:1
2)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:326:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:365:14)
      at param (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:376:14)
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:4
21:3)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:97:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:45:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at src/__tests__/testUtils.ts:32:5
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at urlencodedParser (../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/urlencod
ed.js:85:7)
      at Layer.handle [as handle_request] (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router
/layer.js:95:5)
      at trim_prefix (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:328:13)
      at ../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:286:9
      at router.process_params (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:3
46:12)
      at next (../node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/index.js:280:10)
      at ../node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
      at invokeCallback (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
      at done (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (../node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:287:7)

  ● ChatController Integration Tests › ChatSessionController › GET /api/chat/sessions › should return chat sess
ions list

    expected 200 "OK", got 500 "Internal Server Error"

    [0m [90m 38 |[39m           [33m.[39m[36mget[39m([32m'/api/chat/sessions'[39m)
     [90m 39 |[39m           [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${aut
hToken}`[39m)
    [31m[1m>[22m[39m[90m 40 |[39m           [33m.[39mexpect([35m200[39m)[33m;[39m
     [90m    |[39m            [31m[1m^[22m[39m
     [90m 41 |[39m
     [90m 42 |[39m         expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'success'[39m[33m,
[39m [36mtrue[39m)[33m;[39m
     [90m 43 |[39m         expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'data'[39m)[33m;[
39m[0m

      at Object.<anonymous> (src/__tests__/integration/chatController.integration.test.ts:40:12)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● ChatController Integration Tests › ChatSessionController › GET /api/chat/sessions › should validate agentId
 parameter

    expected 400 "Bad Request", got 500 "Internal Server Error"

    [0m [90m 50 |[39m           [33m.[39mquery({ agentId[33m:[39m [32m'invalid-uuid'[39m })
     [90m 51 |[39m           [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${aut
hToken}`[39m)
    [31m[1m>[22m[39m[90m 52 |[39m           [33m.[39mexpect([35m400[39m)[33m;[39m
     [90m    |[39m            [31m[1m^[22m[39m
     [90m 53 |[39m
     [90m 54 |[39m         expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'success'[39m[33m,
[39m [36mfalse[39m)[33m;[39m
     [90m 55 |[39m         expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'error'[39m)[33m;
[39m[0m

      at Object.<anonymous> (src/__tests__/integration/chatController.integration.test.ts:52:12)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● ChatController Integration Tests › ChatSessionController › GET /api/chat/sessions/:sessionId › should retur
n specific chat session

    expected 201 "Created", got 500 "Internal Server Error"

    [0m [90m 67 |[39m             title[33m:[39m [32m'Test Session'[39m
     [90m 68 |[39m           })
    [31m[1m>[22m[39m[90m 69 |[39m           [33m.[39mexpect([35m201[39m)[33m;[39m
     [90m    |[39m            [31m[1m^[22m[39m
     [90m 70 |[39m
     [90m 71 |[39m         [36mconst[39m sessionId [33m=[39m createResponse[33m.[39mbody[33m.[39mdata
[33m.[39mid[33m;[39m
     [90m 72 |[39m[0m

      at Object.<anonymous> (src/__tests__/integration/chatController.integration.test.ts:69:12)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● ChatController Integration Tests › ChatSessionController › GET /api/chat/sessions/:sessionId › should retur
n 404 for non-existent session

    expected 404 "Not Found", got 500 "Internal Server Error"

    [0m [90m 87 |[39m           [33m.[39m[36mget[39m([32m'/api/chat/sessions/00000000-0000-0000-0000-00
0000000000'[39m)
     [90m 88 |[39m           [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${aut
hToken}`[39m)
    [31m[1m>[22m[39m[90m 89 |[39m           [33m.[39mexpect([35m404[39m)[33m;[39m
     [90m    |[39m            [31m[1m^[22m[39m
     [90m 90 |[39m
     [90m 91 |[39m         expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'success'[39m[33m,
[39m [36mfalse[39m)[33m;[39m
     [90m 92 |[39m       })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/chatController.integration.test.ts:89:12)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● ChatController Integration Tests › ChatSessionController › DELETE /api/chat/sessions/:sessionId › should de
lete chat session

    expected 201 "Created", got 500 "Internal Server Error"

    [0m [90m 103 |[39m             title[33m:[39m [32m'Test Session to Delete'[39m
     [90m 104 |[39m           })
    [31m[1m>[22m[39m[90m 105 |[39m           [33m.[39mexpect([35m201[39m)[33m;[39m
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 106 |[39m
     [90m 107 |[39m         [36mconst[39m sessionId [33m=[39m createResponse[33m.[39mbody[33m.[39mdat
a[33m.[39mid[33m;[39m
     [90m 108 |[39m[0m

      at Object.<anonymous> (src/__tests__/integration/chatController.integration.test.ts:105:12)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● ChatController Integration Tests › ChatMessageController › POST /api/chat/completions › should handle strea
ming chat completion

    expected 201 "Created", got 500 "Internal Server Error"

    [0m [90m 136 |[39m           title[33m:[39m [32m'Test Message Session'[39m
     [90m 137 |[39m         })
    [31m[1m>[22m[39m[90m 138 |[39m         [33m.[39mexpect([35m201[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 139 |[39m
     [90m 140 |[39m       sessionId [33m=[39m response[33m.[39mbody[33m.[39mdata[33m.[39mid[33m;[39
m
     [90m 141 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/chatController.integration.test.ts:138:10)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● ChatController Integration Tests › ChatMessageController › POST /api/chat/completions › should handle non-s
treaming chat completion

    expected 201 "Created", got 500 "Internal Server Error"

    [0m [90m 136 |[39m           title[33m:[39m [32m'Test Message Session'[39m
     [90m 137 |[39m         })
    [31m[1m>[22m[39m[90m 138 |[39m         [33m.[39mexpect([35m201[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 139 |[39m
     [90m 140 |[39m       sessionId [33m=[39m response[33m.[39mbody[33m.[39mdata[33m.[39mid[33m;[39
m
     [90m 141 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/chatController.integration.test.ts:138:10)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● ChatController Integration Tests › ChatMessageController › POST /api/chat/completions › should validate req
uired fields

    expected 201 "Created", got 500 "Internal Server Error"

    [0m [90m 136 |[39m           title[33m:[39m [32m'Test Message Session'[39m
     [90m 137 |[39m         })
    [31m[1m>[22m[39m[90m 138 |[39m         [33m.[39mexpect([35m201[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 139 |[39m
     [90m 140 |[39m       sessionId [33m=[39m response[33m.[39mbody[33m.[39mdata[33m.[39mid[33m;[39
m
     [90m 141 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/chatController.integration.test.ts:138:10)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● ChatController Integration Tests › ChatMessageController › POST /api/chat/feedback › should accept message 
feedback

    expected 201 "Created", got 500 "Internal Server Error"

    [0m [90m 136 |[39m           title[33m:[39m [32m'Test Message Session'[39m
     [90m 137 |[39m         })
    [31m[1m>[22m[39m[90m 138 |[39m         [33m.[39mexpect([35m201[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 139 |[39m
     [90m 140 |[39m       sessionId [33m=[39m response[33m.[39mbody[33m.[39mdata[33m.[39mid[33m;[39
m
     [90m 141 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/chatController.integration.test.ts:138:10)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● ChatController Integration Tests › ChatMessageController › POST /api/chat/feedback › should validate feedba
ck data

    expected 201 "Created", got 500 "Internal Server Error"

    [0m [90m 136 |[39m           title[33m:[39m [32m'Test Message Session'[39m
     [90m 137 |[39m         })
    [31m[1m>[22m[39m[90m 138 |[39m         [33m.[39mexpect([35m201[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 139 |[39m
     [90m 140 |[39m       sessionId [33m=[39m response[33m.[39mbody[33m.[39mdata[33m.[39mid[33m;[39
m
     [90m 141 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/chatController.integration.test.ts:138:10)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● ChatController Integration Tests › ChatInitController › POST /api/chat/init › should initialize new chat se
ssion

    expected 201 "Created", got 500 "Internal Server Error"

    [0m [90m 241 |[39m             title[33m:[39m [32m'New Test Session'[39m
     [90m 242 |[39m           })
    [31m[1m>[22m[39m[90m 243 |[39m           [33m.[39mexpect([35m201[39m)[33m;[39m
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 244 |[39m
     [90m 245 |[39m         expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'success'[39m[33m
,[39m [36mtrue[39m)[33m;[39m
     [90m 246 |[39m         expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'id'
[39m)[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/chatController.integration.test.ts:243:12)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● ChatController Integration Tests › ChatInitController › POST /api/chat/init › should use default title when
 not provided

    expected 201 "Created", got 500 "Internal Server Error"

    [0m [90m 258 |[39m             agentId[33m:[39m [32m'test-agent-id'[39m
     [90m 259 |[39m           })
    [31m[1m>[22m[39m[90m 260 |[39m           [33m.[39mexpect([35m201[39m)[33m;[39m
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 261 |[39m
     [90m 262 |[39m         expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'tit
le'[39m)[33m;[39m
     [90m 263 |[39m         expect(response[33m.[39mbody[33m.[39mdata[33m.[39mtitle)[33m.[39mtoBeTrut
hy()[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/chatController.integration.test.ts:260:12)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● ChatController Integration Tests › ChatInitController › GET /api/chat/status/:sessionId › should return ses
sion status

    expected 201 "Created", got 500 "Internal Server Error"

    [0m [90m 275 |[39m             title[33m:[39m [32m'Status Test Session'[39m
     [90m 276 |[39m           })
    [31m[1m>[22m[39m[90m 277 |[39m           [33m.[39mexpect([35m201[39m)[33m;[39m
     [90m     |[39m            [31m[1m^[22m[39m
     [90m 278 |[39m
     [90m 279 |[39m         [36mconst[39m sessionId [33m=[39m createResponse[33m.[39mbody[33m.[39mdat
a[33m.[39mid[33m;[39m
     [90m 280 |[39m[0m

      at Object.<anonymous> (src/__tests__/integration/chatController.integration.test.ts:277:12)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● ChatController Integration Tests › ChatAttachmentController › POST /api/chat/upload › should handle file up
load

    expected 201 "Created", got 500 "Internal Server Error"

    [0m [90m 305 |[39m           title[33m:[39m [32m'Attachment Test Session'[39m
     [90m 306 |[39m         })
    [31m[1m>[22m[39m[90m 307 |[39m         [33m.[39mexpect([35m201[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 308 |[39m
     [90m 309 |[39m       sessionId [33m=[39m response[33m.[39mbody[33m.[39mdata[33m.[39mid[33m;[39
m
     [90m 310 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/chatController.integration.test.ts:307:10)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● ChatController Integration Tests › ChatAttachmentController › POST /api/chat/upload › should validate file 
size

    expected 201 "Created", got 500 "Internal Server Error"

    [0m [90m 305 |[39m           title[33m:[39m [32m'Attachment Test Session'[39m
     [90m 306 |[39m         })
    [31m[1m>[22m[39m[90m 307 |[39m         [33m.[39mexpect([35m201[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 308 |[39m
     [90m 309 |[39m       sessionId [33m=[39m response[33m.[39mbody[33m.[39mdata[33m.[39mid[33m;[39
m
     [90m 310 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/chatController.integration.test.ts:307:10)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● ChatController Integration Tests › ChatAttachmentController › POST /api/chat/upload › should validate file 
type

    expected 201 "Created", got 500 "Internal Server Error"

    [0m [90m 305 |[39m           title[33m:[39m [32m'Attachment Test Session'[39m
     [90m 306 |[39m         })
    [31m[1m>[22m[39m[90m 307 |[39m         [33m.[39mexpect([35m201[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 308 |[39m
     [90m 309 |[39m       sessionId [33m=[39m response[33m.[39mbody[33m.[39mdata[33m.[39mid[33m;[39
m
     [90m 310 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/chatController.integration.test.ts:307:10)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● ChatController Integration Tests › ChatAttachmentController › GET /api/chat/attachments/:sessionId › should
 return session attachments

    expected 201 "Created", got 500 "Internal Server Error"

    [0m [90m 305 |[39m           title[33m:[39m [32m'Attachment Test Session'[39m
     [90m 306 |[39m         })
    [31m[1m>[22m[39m[90m 307 |[39m         [33m.[39mexpect([35m201[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 308 |[39m
     [90m 309 |[39m       sessionId [33m=[39m response[33m.[39mbody[33m.[39mdata[33m.[39mid[33m;[39
m
     [90m 310 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/chatController.integration.test.ts:307:10)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● ChatController Integration Tests › ChatAttachmentController › DELETE /api/chat/attachments/:attachmentId › 
should delete attachment

    expected 201 "Created", got 500 "Internal Server Error"

    [0m [90m 305 |[39m           title[33m:[39m [32m'Attachment Test Session'[39m
     [90m 306 |[39m         })
    [31m[1m>[22m[39m[90m 307 |[39m         [33m.[39mexpect([35m201[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 308 |[39m
     [90m 309 |[39m       sessionId [33m=[39m response[33m.[39mbody[33m.[39mdata[33m.[39mid[33m;[39
m
     [90m 310 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/chatController.integration.test.ts:307:10)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● ChatController Integration Tests › Cross-Controller Integration › should handle complete chat workflow

    expected 201 "Created", got 500 "Internal Server Error"

    [0m [90m 421 |[39m           title[33m:[39m [32m'Complete Workflow Test'[39m
     [90m 422 |[39m         })
    [31m[1m>[22m[39m[90m 423 |[39m         [33m.[39mexpect([35m201[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 424 |[39m
     [90m 425 |[39m       [36mconst[39m sessionId [33m=[39m initResponse[33m.[39mbody[33m.[39mdata[3
3m.[39mid[33m;[39m
     [90m 426 |[39m[0m

      at Object.<anonymous> (src/__tests__/integration/chatController.integration.test.ts:423:10)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● ChatController Integration Tests › Error Handling › should handle authentication errors

    expected 401 "Unauthorized", got 500 "Internal Server Error"

    [0m [90m 513 |[39m         [33m.[39m[36mget[39m([32m'/api/chat/sessions'[39m)
     [90m 514 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m'Bearer invali
d-token'[39m)
    [31m[1m>[22m[39m[90m 515 |[39m         [33m.[39mexpect([35m401[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 516 |[39m
     [90m 517 |[39m       expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'success'[39m[33m,
[39m [36mfalse[39m)[33m;[39m
     [90m 518 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/chatController.integration.test.ts:515:10)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● ChatController Integration Tests › Error Handling › should handle malformed requests

    expected 400 "Bad Request", got 500 "Internal Server Error"

    [0m [90m 523 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${
authToken}`[39m)
     [90m 524 |[39m         [33m.[39msend([32m'invalid-json'[39m)
    [31m[1m>[22m[39m[90m 525 |[39m         [33m.[39mexpect([35m400[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 526 |[39m
     [90m 527 |[39m       expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'success'[39m[33m,
[39m [36mfalse[39m)[33m;[39m
     [90m 528 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/chatController.integration.test.ts:525:10)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● ChatController Integration Tests › Error Handling › should handle service unavailability

    expected 404 "Not Found", got 500 "Internal Server Error"

    [0m [90m 538 |[39m           stream[33m:[39m [36mfalse[39m
     [90m 539 |[39m         })
    [31m[1m>[22m[39m[90m 540 |[39m         [33m.[39mexpect([35m404[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 541 |[39m
     [90m 542 |[39m       expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'success'[39m[33m,
[39m [36mfalse[39m)[33m;[39m
     [90m 543 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/integration/chatController.integration.test.ts:540:10)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

FAIL src/__tests__/chat.test.ts
  ● Console

    console.warn
      [WARN] Redis server does not require a password, but a password was supplied.

      at ../node_modules/.pnpm/ioredis@5.8.1/node_modules/ioredis/built/redis/event_handler.js:24:33
      at tryCatcher (../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/u
tils.js:12:23)
      at ../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/index.js:33:5
1

    console.warn
      [WARN] Redis server does not require a password, but a password was supplied.

      at ../node_modules/.pnpm/ioredis@5.8.1/node_modules/ioredis/built/redis/event_handler.js:24:33
      at tryCatcher (../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/u
tils.js:12:23)
      at ../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/index.js:33:5
1

    console.warn
      [WARN] Redis server does not require a password, but a password was supplied.

      at ../node_modules/.pnpm/ioredis@5.8.1/node_modules/ioredis/built/redis/event_handler.js:24:33
      at tryCatcher (../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/u
tils.js:12:23)
      at ../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/index.js:33:5
1

    console.warn
      Failed to authenticate test user: {
        code: 'INVALID_CREDENTIALS',
        message: '用户名或密码错误',
        category: 'authentication',
        severity: 'medium',
        timestamp: '2025-10-16T15:07:04.183Z'
      }

    [0m [90m 63 |[39m       } [36melse[39m {
     [90m 64 |[39m         [90m// 登录失败，测试无法继续[39m
    [31m[1m>[22m[39m[90m 65 |[39m         console[33m.[39mwarn([32m'Failed to authenticate test user:'
[39m[33m,[39m loginResponse[33m.[39mbody)[33m;[39m
     [90m    |[39m                 [31m[1m^[22m[39m
     [90m 66 |[39m       }
     [90m 67 |[39m     }
     [90m 68 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/chat.test.ts:65:17)

  ● T020: 聊天服务测试 › 1️⃣ 非流式聊天请求 › 应该成功发送非流式聊天消息

    expect(received).toBeLessThan(expected)

    Expected: < 400
    Received:   400

    [0m [90m 91 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m500[3
9m)[33m;[39m
     [90m 92 |[39m       } [36melse[39m {
    [31m[1m>[22m[39m[90m 93 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m4
00[39m)[33m;[39m
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 94 |[39m         expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'code'[39m)[33m;[
39m
     [90m 95 |[39m         expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'data'[39m)[33m;[
39m
     [90m 96 |[39m         [0m

      at Object.<anonymous> (src/__tests__/chat.test.ts:93:33)

  ● T020: 聊天服务测试 › 2️⃣ 流式聊天（SSE） › 应该支持流式聊天响应

    expect(received).toContain(expected) // indexOf

    Expected value: 400
    Received array: [401, 403, 404, 500]

    [0m [90m 185 |[39m       } [36melse[39m {
     [90m 186 |[39m         [90m// 如果不支持或需要认证[39m
    [31m[1m>[22m[39m[90m 187 |[39m         expect([[35m401[39m[33m,[39m [35m403[39m[33m,[39m [35
m404[39m[33m,[39m [35m500[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                                      [31m[1m^[22m[39m
     [90m 188 |[39m       }
     [90m 189 |[39m     }[33m,[39m [35m35000[39m)[33m;[39m
     [90m 190 |[39m[0m

      at Object.<anonymous> (src/__tests__/chat.test.ts:187:38)

  ● T020: 聊天服务测试 › 3️⃣ 会话管理 › 应该成功创建新会话

    expect(received).toBeLessThan(expected)

    Expected: < 500
    Received:   500

    [0m [90m 241 |[39m       } [36melse[39m {
     [90m 242 |[39m         [90m// 其他情况[39m
    [31m[1m>[22m[39m[90m 243 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m
500[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 244 |[39m       }
     [90m 245 |[39m     })[33m;[39m
     [90m 246 |[39m[0m

      at Object.<anonymous> (src/__tests__/chat.test.ts:243:33)

  ● T020: 聊天服务测试 › 3️⃣ 会话管理 › 应该获取用户的会话列表

    expect(received).toContain(expected) // indexOf

    Expected value: 500
    Received array: [401, 403, 404]

    [0m [90m 254 |[39m         expect([33mArray[39m[33m.[39misArray(response[33m.[39mbody[33m.[39mda
ta) [33m||[39m [33mArray[39m[33m.[39misArray(response[33m.[39mbody[33m.[39mdata[33m.[39msessions))
[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 255 |[39m       } [36melse[39m {
    [31m[1m>[22m[39m[90m 256 |[39m         expect([[35m401[39m[33m,[39m [35m403[39m[33m,[39m [35
m404[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 257 |[39m       }
     [90m 258 |[39m     })[33m;[39m
     [90m 259 |[39m[0m

      at Object.<anonymous> (src/__tests__/chat.test.ts:256:33)

  ● T020: 聊天服务测试 › 3️⃣ 会话管理 › 应该支持会话搜索

    expect(received).toBeLessThan(expected)

    Expected: < 400
    Received:   500

    [0m [90m 306 |[39m       [90m// 如果端点存在[39m
     [90m 307 |[39m       [36mif[39m (response[33m.[39mstatus [33m!==[39m [35m404[39m) {
    [31m[1m>[22m[39m[90m 308 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m
400[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 309 |[39m         expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'data'[39m)[33m;
[39m
     [90m 310 |[39m       }
     [90m 311 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/chat.test.ts:308:33)

  ● T020: 聊天服务测试 › 5️⃣ 并发聊天处理 › 应该能够处理并发聊天请求

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    [0m [90m 403 |[39m       )[33m;[39m
     [90m 404 |[39m
    [31m[1m>[22m[39m[90m 405 |[39m       expect(validStatuses[33m.[39mlength)[33m.[39mtoBeGreaterThan
([35m0[39m)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 406 |[39m     }[33m,[39m [35m35000[39m)[33m;[39m
     [90m 407 |[39m
     [90m 408 |[39m     it([32m'应该正确隔离不同会话的消息'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/__tests__/chat.test.ts:405:36)

  ● T020: 聊天服务测试 › 6️⃣ 错误处理和边界情况 › 应该正确处理无效的会话ID

    expect(received).toContain(expected) // indexOf

    Expected value: 401
    Received array: [404, 400]

    [0m [90m 485 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${
authToken}`[39m)[33m;[39m
     [90m 486 |[39m
    [31m[1m>[22m[39m[90m 487 |[39m       expect([[35m404[39m[33m,[39m [35m400[39m])[33m.[39mtoCon
tain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 488 |[39m     })[33m;[39m
     [90m 489 |[39m
     [90m 490 |[39m     it([32m'应该正确处理缺少必填参数'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/__tests__/chat.test.ts:487:26)

FAIL src/__tests__/middleware/cacheMiddleware.test.ts
  ● Test suite failed to run

    [96msrc/__tests__/middleware/cacheMiddleware.test.ts[0m:[93m86[0m:[93m7[0m - [91merror[0m[90m TS23
22: [0mType 'Mock<void, [], Response<any, Record<string, any>>>' is not assignable to type '{ (cb?: (() => voi
d) | undefined): Response<any, Record<string, any>>; (chunk: any, cb?: (() => void) | undefined): Response<any,
 Record<string, any>>; (chunk: any, encoding: BufferEncoding, cb?: (() => void) | undefined): Response<...>; }'
.
      Type 'void' is not assignable to type 'Response<any, Record<string, any>>'.

    [7m86[0m       mockResponse.end = jest.fn(function(this: Response) {
    [7m  [0m [91m      ~~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/middleware/cacheMiddleware.test.ts[0m:[93m215[0m:[93m25[0m - [91merror[0m[90m TS
2339: [0mProperty 'mockReturnValue' does not exist on type '(field: string) => string | undefined'.

    [7m215[0m       mockResponse.get!.mockReturnValue('application/json');
    [7m   [0m [91m                        ~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/middleware/cacheMiddleware.test.ts[0m:[93m260[0m:[93m25[0m - [91merror[0m[90m TS
2339: [0mProperty 'mockImplementation' does not exist on type '(field: string) => string | undefined'.

    [7m260[0m       mockResponse.get!.mockImplementation((header) => {
    [7m   [0m [91m                        ~~~~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/middleware/cacheMiddleware.test.ts[0m:[93m260[0m:[93m45[0m - [91merror[0m[90m TS
7006: [0mParameter 'header' implicitly has an 'any' type.

    [7m260[0m       mockResponse.get!.mockImplementation((header) => {
    [7m   [0m [91m                                            ~~~~~~[0m
    [96msrc/__tests__/middleware/cacheMiddleware.test.ts[0m:[93m291[0m:[93m25[0m - [91merror[0m[90m TS
2339: [0mProperty 'mockImplementation' does not exist on type '(field: string) => string | undefined'.

    [7m291[0m       mockResponse.get!.mockImplementation((header) => {
    [7m   [0m [91m                        ~~~~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/middleware/cacheMiddleware.test.ts[0m:[93m291[0m:[93m45[0m - [91merror[0m[90m TS
7006: [0mParameter 'header' implicitly has an 'any' type.

    [7m291[0m       mockResponse.get!.mockImplementation((header) => {
    [7m   [0m [91m                                            ~~~~~~[0m
    [96msrc/__tests__/middleware/cacheMiddleware.test.ts[0m:[93m323[0m:[93m25[0m - [91merror[0m[90m TS
2339: [0mProperty 'mockReturnValue' does not exist on type '(field: string) => string | undefined'.

    [7m323[0m       mockResponse.get!.mockReturnValue('application/json');
    [7m   [0m [91m                        ~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/middleware/cacheMiddleware.test.ts[0m:[93m352[0m:[93m25[0m - [91merror[0m[90m TS
2339: [0mProperty 'mockReturnValue' does not exist on type '(field: string) => string | undefined'.

    [7m352[0m       mockResponse.get!.mockReturnValue('application/json');
    [7m   [0m [91m                        ~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/middleware/cacheMiddleware.test.ts[0m:[93m379[0m:[93m25[0m - [91merror[0m[90m TS
2339: [0mProperty 'mockReturnValue' does not exist on type '(field: string) => string | undefined'.

    [7m379[0m       mockResponse.get!.mockReturnValue('application/json');
    [7m   [0m [91m                        ~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/middleware/cacheMiddleware.test.ts[0m:[93m470[0m:[93m49[0m - [91merror[0m[90m TS
2345: [0mArgument of type '{ memoryItems: number; memorySize: number; redisConnected: true; connected: true; h
its: number; misses: number; hitRate: number; sets: number; dels: number; errors: number; }' is not assignable 
to parameter of type 'RedisCacheStats'.
      Type '{ memoryItems: number; memorySize: number; redisConnected: true; connected: true; hits: number; mis
ses: number; hitRate: number; sets: number; dels: number; errors: number; }' is missing the following propertie
s from type 'RedisCacheStats': compressionHits, locks, prewarmedHits, protectionHits, and 3 more.

    [7m470[0m       mockCacheManager.getStats.mockReturnValue({
    [7m   [0m [91m                                                ~[0m
    [7m471[0m         memoryItems: 100,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~~~~~~~~[0m
    [7m...[0m 
    [7m480[0m         errors: 0,
    [7m   [0m [91m~~~~~~~~~~~~~~~~~~[0m
    [7m481[0m       });
    [7m   [0m [91m~~~~~~~[0m
    [96msrc/__tests__/middleware/cacheMiddleware.test.ts[0m:[93m508[0m:[93m25[0m - [91merror[0m[90m TS
2339: [0mProperty 'mockReturnValue' does not exist on type '(field: string) => string | undefined'.

    [7m508[0m       mockResponse.get!.mockReturnValue('application/json');
    [7m   [0m [91m                        ~~~~~~~~~~~~~~~[0m

PASS src/__tests__/services/ChatProxyService.test.ts
FAIL src/__tests__/integration/databaseMigration.integration.test.ts
  ● Database Migration Integration Tests › Schema Initialization › should create all required tables on initial
ization

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39m [36mawait[39m [36mthis[39m
[33m.[39mtestPool[33m.[39mconnect()[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUtils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.integration.test.ts:11:5)

  ● Database Migration Integration Tests › Schema Initialization › should create all required indexes

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39m [36mawait[39m [36mthis[39m
[33m.[39mtestPool[33m.[39mconnect()[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUtils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.integration.test.ts:11:5)

  ● Database Migration Integration Tests › Schema Initialization › should have correct table schemas

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39m [36mawait[39m [36mthis[39m
[33m.[39mtestPool[33m.[39mconnect()[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUtils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.integration.test.ts:11:5)

  ● Database Migration Integration Tests › Data Types and Constraints › should enforce UUID primary keys

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39m [36mawait[39m [36mthis[39m
[33m.[39mtestPool[33m.[39mconnect()[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUtils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.integration.test.ts:11:5)

  ● Database Migration Integration Tests › Data Types and Constraints › should enforce foreign key constraints

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39m [36mawait[39m [36mthis[39m
[33m.[39mtestPool[33m.[39mconnect()[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUtils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.integration.test.ts:11:5)

  ● Database Migration Integration Tests › Data Types and Constraints › should handle JSONB data type correctly

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39m [36mawait[39m [36mthis[39m
[33m.[39mtestPool[33m.[39mconnect()[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUtils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.integration.test.ts:11:5)

  ● Database Migration Integration Tests › Data Types and Constraints › should handle timestamp columns correct
ly

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39m [36mawait[39m [36mthis[39m
[33m.[39mtestPool[33m.[39mconnect()[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUtils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.integration.test.ts:11:5)

  ● Database Migration Integration Tests › Performance and Indexing › should use indexes for email lookups

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39m [36mawait[39m [36mthis[39m
[33m.[39mtestPool[33m.[39mconnect()[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUtils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.integration.test.ts:11:5)

  ● Database Migration Integration Tests › Performance and Indexing › should handle large datasets efficiently

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39m [36mawait[39m [36mthis[39m
[33m.[39mtestPool[33m.[39mconnect()[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUtils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.integration.test.ts:11:5)

  ● Database Migration Integration Tests › Data Integrity and Validation › should maintain referential integrit
y on cascade deletes

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39m [36mawait[39m [36mthis[39m
[33m.[39mtestPool[33m.[39mconnect()[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUtils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.integration.test.ts:11:5)

  ● Database Migration Integration Tests › Data Integrity and Validation › should prevent circular references

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39m [36mawait[39m [36mthis[39m
[33m.[39mtestPool[33m.[39mconnect()[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUtils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.integration.test.ts:11:5)

  ● Database Migration Integration Tests › Schema Evolution › should handle adding new columns gracefully

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39m [36mawait[39m [36mthis[39m
[33m.[39mtestPool[33m.[39mconnect()[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUtils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.integration.test.ts:11:5)

  ● Database Migration Integration Tests › Schema Evolution › should maintain backward compatibility

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39m [36mawait[39m [36mthis[39m
[33m.[39mtestPool[33m.[39mconnect()[33m;[39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUtils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.integration.test.ts:11:5)


  ● Test suite failed to run

    TypeError: Cannot read properties of null (reading 'totalCount')

    [0m [90m 202 |[39m   logger[33m.[39minfo([32m`[initDB] 连接到目标数据库 "${pg.database}"...`[39m)[33m;[39m
     [90m 203 |[39m   pool [33m=[39m [36mnew[39m [33mPool[39m({
    [31m[1m>[22m[39m[90m 204 |[39m     host[33m:[39m pg[33m.[39mhost[33m,[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 205 |[39m     port[33m:[39m pg[33m.[39mport [33m?[39m[33m?[39m [35m5432[39m[33m,[39m
     [90m 206 |[39m     user[33m:[39m pg[33m.[39muser[33m,[39m
     [90m 207 |[39m     password[33m:[39m pg[33m.[39mpassword[33m,[39m[0m

      at BoundPool.<anonymous> (src/utils/db.ts:204:25)
      at Connection.<anonymous> (../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:1
74:15)
      at Socket.<anonymous> (../node_modules/.pnpm/pg@8.16.3/node_modules/pg/lib/connection.js:62:12)

  ● Test suite failed to run

    read ECONNRESET

    [0m [90m 200 |[39m   [36masync[39m cleanupTestData()[33m:[39m [33mPromise[39m[33m<[39m[36mvoid
[39m[33m>[39m {
     [90m 201 |[39m     [36mconst[39m pool [33m=[39m [36mthis[39m[33m.[39mgetTestPool()[33m;[39m
    [31m[1m>[22m[39m[90m 202 |[39m     [36mconst[39m client [33m=[39m [36mawait[39m pool[33m.[39m
connect()[33m;[39m
     [90m     |[39m                    [31m[1m^[22m[39m
     [90m 203 |[39m
     [90m 204 |[39m     [36mtry[39m {
     [90m 205 |[39m       [90m// 按依赖关系顺序清理数据[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:45:11
      at async DatabaseTestEnvironment.cleanupTestData (src/__tests__/utils/dbTestUtils.ts:202:20)
      at async DatabaseTestEnvironment.close (src/__tests__/utils/dbTestUtils.ts:254:7)
      at async Object.afterAll (src/__tests__/utils/dbTestUtils.ts:445:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.integration.test.ts:19:5)

PASS src/__tests__/services/TokenService.test.ts
PASS src/__tests__/services/AuditService.test.ts
PASS src/__tests__/integration/realPerformance.test.ts
FAIL src/__tests__/auth.test.ts
  ● Console

    console.warn
      [WARN] Redis server does not require a password, but a password was supplied.

      at ../node_modules/.pnpm/ioredis@5.8.1/node_modules/ioredis/built/redis/event_handler.js:24:33
      at tryCatcher (../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/u
tils.js:12:23)
      at ../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/index.js:33:5
1

    console.warn
      [WARN] Redis server does not require a password, but a password was supplied.

      at ../node_modules/.pnpm/ioredis@5.8.1/node_modules/ioredis/built/redis/event_handler.js:24:33
      at tryCatcher (../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/u
tils.js:12:23)
      at ../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/index.js:33:5
1

  ● T018: 认证系统单元测试 › 1️⃣ 用户注册 › 应该成功注册新用户

    expected 200 "OK", got 404 "Not Found"

    [0m [90m 70 |[39m           role[33m:[39m testUser[33m.[39mrole[33m,[39m
     [90m 71 |[39m         })
    [31m[1m>[22m[39m[90m 72 |[39m         [33m.[39mexpect([35m200[39m)[33m;[39m
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 73 |[39m
     [90m 74 |[39m       expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'code'[39m[33m,[39m
 [32m'SUCCESS'[39m)[33m;[39m
     [90m 75 |[39m       expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'token'
[39m)[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/auth.test.ts:72:10)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● T018: 认证系统单元测试 › 1️⃣ 用户注册 › 应该拒绝重复用户名注册

    expected 400 "Bad Request", got 404 "Not Found"

    [0m [90m 90 |[39m           role[33m:[39m testUser[33m.[39mrole[33m,[39m
     [90m 91 |[39m         })
    [31m[1m>[22m[39m[90m 92 |[39m         [33m.[39mexpect([35m400[39m)[33m;[39m
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 93 |[39m
     [90m 94 |[39m       expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'code'[39m)[33m;[39
m
     [90m 95 |[39m       expect(response[33m.[39mbody[33m.[39mcode)[33m.[39mtoMatch([35m/USERNAME_EXIS
TS|VALIDATION_ERROR/[39m)[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/auth.test.ts:92:10)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● T018: 认证系统单元测试 › 1️⃣ 用户注册 › 应该拒绝弱密码

    expect(received).toHaveProperty(path)

    Expected path: "code"
    Received path: []

    Received value: {}

    [0m [90m 106 |[39m
     [90m 107 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBeGreaterThanOrEqual([35m400[39m)[
33m;[39m
    [31m[1m>[22m[39m[90m 108 |[39m       expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'c
ode'[39m)[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 109 |[39m     })[33m;[39m
     [90m 110 |[39m   })[33m;[39m
     [90m 111 |[39m[0m

      at Object.<anonymous> (src/__tests__/auth.test.ts:108:29)

  ● T018: 认证系统单元测试 › 2️⃣ 用户登录 › 应该成功登录有效用户

    expected 200 "OK", got 401 "Unauthorized"

    [0m [90m 118 |[39m           password[33m:[39m testUser[33m.[39mpassword[33m,[39m
     [90m 119 |[39m         })
    [31m[1m>[22m[39m[90m 120 |[39m         [33m.[39mexpect([35m200[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 121 |[39m
     [90m 122 |[39m       expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'code'[39m[33m,[39
m [32m'SUCCESS'[39m)[33m;[39m
     [90m 123 |[39m       expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'token
'[39m)[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/auth.test.ts:120:10)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● T018: 认证系统单元测试 › 3️⃣ Token验证 › 应该成功验证有效Token

    expected 200 "OK", got 500 "Internal Server Error"

    [0m [90m 173 |[39m         [33m.[39m[36mget[39m([32m'/api/protected'[39m)
     [90m 174 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${auth
Token}`[39m)
    [31m[1m>[22m[39m[90m 175 |[39m         [33m.[39mexpect([35m200[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 176 |[39m
     [90m 177 |[39m       expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'code'[39m[33m,[39
m [32m'SUCCESS'[39m)[33m;[39m
     [90m 178 |[39m       expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'userI
d'[39m)[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/auth.test.ts:175:10)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● T018: 认证系统单元测试 › 3️⃣ Token验证 › 应该拒绝无效Token

    expected 401 "Unauthorized", got 500 "Internal Server Error"

    [0m [90m 183 |[39m         [33m.[39m[36mget[39m([32m'/api/protected'[39m)
     [90m 184 |[39m         [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m'Bearer invali
d_token_12345'[39m)
    [31m[1m>[22m[39m[90m 185 |[39m         [33m.[39mexpect([35m401[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 186 |[39m
     [90m 187 |[39m       expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'code'[39m)[33m;[3
9m
     [90m 188 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/auth.test.ts:185:10)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● T018: 认证系统单元测试 › 6️⃣ 用户登出 › 应该成功登出用户

    expect(received).toBeLessThan(expected)

    Expected: < 400
    Received:   500

    [0m [90m 319 |[39m       [90m// 如果端点存在[39m
     [90m 320 |[39m       [36mif[39m (response[33m.[39mstatus [33m!==[39m [35m404[39m) {
    [31m[1m>[22m[39m[90m 321 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m
400[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 322 |[39m         expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'code'[39m[33m,[
39m [32m'SUCCESS'[39m)[33m;[39m
     [90m 323 |[39m       } [36melse[39m {
     [90m 324 |[39m         [90m// Logout功能可能未实现，跳过[39m[0m

      at Object.<anonymous> (src/__tests__/auth.test.ts:321:33)

  ● T018: 认证系统单元测试 › 6️⃣ 用户登出 › 登出后Token应该失效

    expected 200 "OK", got 429 "Too Many Requests"

    [0m [90m 335 |[39m           password[33m:[39m testUser[33m.[39mpassword[33m,[39m
     [90m 336 |[39m         })
    [31m[1m>[22m[39m[90m 337 |[39m         [33m.[39mexpect([35m200[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 338 |[39m
     [90m 339 |[39m       [36mconst[39m newToken [33m=[39m loginResponse[33m.[39mbody[33m.[39mdata[3
3m.[39mtoken[33m;[39m
     [90m 340 |[39m[0m

      at Object.<anonymous> (src/__tests__/auth.test.ts:337:10)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● T018: 认证系统单元测试 › 7️⃣ 账户安全 › 应该支持账户锁定机制（多次失败登录）

    expect(received).toContain(expected) // indexOf

    Expected value: 429
    Received array: [401, 423]

    [0m [90m 388 |[39m
     [90m 389 |[39m       [90m// 根据实现，可能返回423(Locked)或401[39m
    [31m[1m>[22m[39m[90m 390 |[39m       expect([[35m401[39m[33m,[39m [35m423[39m])[33m.[39mtoCon
tain(response[33m.[39mstatus)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 391 |[39m     })[33m;[39m
     [90m 392 |[39m
     [90m 393 |[39m     it([32m'应该记录最后登录时间和IP'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/__tests__/auth.test.ts:390:26)

  ● T018: 认证系统单元测试 › 7️⃣ 账户安全 › 应该记录最后登录时间和IP

    expected 200 "OK", got 429 "Too Many Requests"

    [0m [90m 398 |[39m           password[33m:[39m testUser[33m.[39mpassword[33m,[39m
     [90m 399 |[39m         })
    [31m[1m>[22m[39m[90m 400 |[39m         [33m.[39mexpect([35m200[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 401 |[39m
     [90m 402 |[39m       [90m// 检查用户信息是否包含登录元数据[39m
     [90m 403 |[39m       [36mconst[39m user [33m=[39m response[33m.[39mbody[33m.[39mdata[33m.[39mu
ser[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/auth.test.ts:400:10)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

FAIL src/__tests__/agents.test.ts
  ● Console

    console.warn
      [WARN] Redis server does not require a password, but a password was supplied.

      at ../node_modules/.pnpm/ioredis@5.8.1/node_modules/ioredis/built/redis/event_handler.js:24:33
      at tryCatcher (../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/u
tils.js:12:23)
      at ../node_modules/.pnpm/standard-as-callback@2.1.0/node_modules/standard-as-callback/built/index.js:33:5
1

  ● T019: 智能体管理测试 › 1️⃣ 获取智能体列表 › 应该成功获取智能体列表

    TypeError: Cannot read properties of null (reading 'totalCount')

    [0m [90m 202 |[39m   logger[33m.[39minfo([32m`[initDB] 连接到目标数据库 "${pg.database}"...`[39m)[33m;[39m
     [90m 203 |[39m   pool [33m=[39m [36mnew[39m [33mPool[39m({
    [31m[1m>[22m[39m[90m 204 |[39m     host[33m:[39m pg[33m.[39mhost[33m,[39m
     [90m     |[39m                         [31m[1m^[22m[39m
     [90m 205 |[39m     port[33m:[39m pg[33m.[39mport [33m?[39m[33m?[39m [35m5432[39m[33m,[39m
     [90m 206 |[39m     user[33m:[39m pg[33m.[39muser[33m,[39m
     [90m 207 |[39m     password[33m:[39m pg[33m.[39mpassword[33m,[39m[0m

      at BoundPool.<anonymous> (src/utils/db.ts:204:25)
      at Connection.<anonymous> (../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/index.js:1
74:15)
      at Socket.<anonymous> (../node_modules/.pnpm/pg@8.16.3/node_modules/pg/lib/connection.js:62:12)

  ● T019: 智能体管理测试 › 1️⃣ 获取智能体列表 › 智能体列表项应该包含必要字段

    expect(received).toHaveProperty(path)

    Expected path: "avatar"
    Received path: []

    Received value: {"capabilities": ["cad-parsing", "cad-modification", "function-calling", "dxf-format"], "de
scription": "基于阿里云通义千问的 CAD 图纸自然语言修改和解读助手，支持 DXF 文件的查看、理解和智能修改", "id": "cad-editor-agent", "model": "qwen-max",
 "name": "CAD 编辑智能体", "provider": "dashscope", "status": "active"}

    [0m [90m 54 |[39m       expect(agent)[33m.[39mtoHaveProperty([32m'provider'[39m)[33m;[39m
     [90m 55 |[39m       expect(agent)[33m.[39mtoHaveProperty([32m'description'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 56 |[39m       expect(agent)[33m.[39mtoHaveProperty([32m'avatar'[39m)[33m;
[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 57 |[39m     })[33m;[39m
     [90m 58 |[39m
     [90m 59 |[39m     it([32m'应该支持分页参数'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/__tests__/agents.test.ts:56:21)

  ● T019: 智能体管理测试 › 1️⃣ 获取智能体列表 › 应该支持按提供商筛选

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 81 |[39m           agent[33m.[39mprovider [33m===[39m [32m'fastgpt'[39m [33m||[39m agen
t[33m.[39mprovider [33m===[39m [32m'FastGPT'[39m
     [90m 82 |[39m         )[33m;[39m
    [31m[1m>[22m[39m[90m 83 |[39m         expect(allFastGPT)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m    |[39m                            [31m[1m^[22m[39m
     [90m 84 |[39m       }
     [90m 85 |[39m     })[33m;[39m
     [90m 86 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/agents.test.ts:83:28)

  ● T019: 智能体管理测试 › 2️⃣ 获取智能体详情 › 智能体详情应该包含完整信息

    expect(received).toHaveProperty(path)

    Expected path: "avatar"
    Received path: []

    Received value: {"appId": null, "capabilities": ["cad-parsing", "cad-modification", "function-calling", "dx
f-format"], "createdAt": "2025-10-04T00:00:00Z", "description": "基于阿里云通义千问的 CAD 图纸自然语言修改和解读助手，支持 DXF 文件的查看、理解和智
能修改", "endpoint": "https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions", "features": {"streaming
Config": {"enabled": true, "endpoint": "same", "flowNodeStatus": false, "statusEvents": false}, "supportsChatId
": false, "supportsDetail": false, "supportsFiles": true, "supportsImages": false, "supportsStream": true}, "id
": "cad-editor-agent", "maxTokens": 8000, "model": "qwen-max", "name": "CAD 编辑智能体", "provider": "dashscope", "r
ateLimit": {"requestsPerMinute": 60, "tokensPerMinute": 100000}, "status": "active", "systemPrompt": "你是一个专业的 C
AD 图纸助手，能够理解和修改 DXF 格式的 CAD 文件。你可以帮助用户查看图纸信息、添加或修改几何实体、查询图层和实体属性等。当用户提出修改要求时，你会调用相应的工具函数来执行操作。", "temperature":
 0.7, "updatedAt": "2025-10-04T00:00:00Z"}

    [0m [90m 107 |[39m       expect(agent)[33m.[39mtoHaveProperty([32m'provider'[39m)[33m;[39m
     [90m 108 |[39m       expect(agent)[33m.[39mtoHaveProperty([32m'description'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 109 |[39m       expect(agent)[33m.[39mtoHaveProperty([32m'avatar'[39m)[33m;
[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 110 |[39m       expect(agent)[33m.[39mtoHaveProperty([32m'config'[39m)[33m;[39m
     [90m 111 |[39m       expect(agent)[33m.[39mtoHaveProperty([32m'features'[39m)[33m;[39m
     [90m 112 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/agents.test.ts:109:21)

  ● T019: 智能体管理测试 › 3️⃣ 检查智能体状态 › 应该成功检查智能体在线状态

    expect(received).toHaveProperty(path)

    Expected path: "available"
    Received path: []

    Received value: {"agentId": "cad-editor-agent", "lastChecked": "2025-10-16T15:07:15.826Z", "responseTime": 
0, "status": "active"}

    [0m [90m 139 |[39m       expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'data'[39m)[33m
;[39m
     [90m 140 |[39m       expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'statu
s'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 141 |[39m       expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveP
roperty([32m'available'[39m)[33m;[39m
     [90m     |[39m                                  [31m[1m^[22m[39m
     [90m 142 |[39m     })[33m;[39m
     [90m 143 |[39m
     [90m 144 |[39m     it([32m'智能体状态应该包含健康信息'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/__tests__/agents.test.ts:141:34)

  ● T019: 智能体管理测试 › 3️⃣ 检查智能体状态 › 智能体状态应该包含健康信息

    expect(received).toHaveProperty(path)

    Expected path: "available"
    Received path: []

    Received value: {"agentId": "cad-editor-agent", "lastChecked": "2025-10-16T15:07:15.834Z", "responseTime": 
0, "status": "active"}

    [0m [90m 149 |[39m       [36mconst[39m status [33m=[39m response[33m.[39mbody[33m.[39mdata[33m;
[39m
     [90m 150 |[39m       expect(status)[33m.[39mtoHaveProperty([32m'status'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 151 |[39m       expect(status)[33m.[39mtoHaveProperty([32m'available'[39m)[
33m;[39m
     [90m     |[39m                      [31m[1m^[22m[39m
     [90m 152 |[39m       
     [90m 153 |[39m       [90m// 状态应该是预期值之一[39m
     [90m 154 |[39m       expect([[32m'online'[39m[33m,[39m [32m'offline'[39m[33m,[39m [32m'degraded
'[39m[33m,[39m [32m'healthy'[39m[33m,[39m [32m'unhealthy'[39m])[33m.[39mtoContain(status[33m.[39ms
tatus[33m.[39mtoLowerCase())[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/agents.test.ts:151:22)

  ● T019: 智能体管理测试 › 3️⃣ 检查智能体状态 › 应该正确处理不存在智能体的状态查询

    expected 404 "Not Found", got 200 "OK"

    [0m [90m 159 |[39m       [36mconst[39m response [33m=[39m [36mawait[39m request(app)
     [90m 160 |[39m         [33m.[39m[36mget[39m([32m'/api/agents/nonexistent_agent/status'[39m)
    [31m[1m>[22m[39m[90m 161 |[39m         [33m.[39mexpect([35m404[39m)[33m;[39m
     [90m     |[39m          [31m[1m^[22m[39m
     [90m 162 |[39m
     [90m 163 |[39m       expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'code'[39m)[33m;[3
9m
     [90m 164 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/agents.test.ts:161:10)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)

  ● T019: 智能体管理测试 › 3️⃣ 检查智能体状态 › 应该包含响应时间信息

    expect(received).toBe(expected) // Object.is equality

    Expected: "number"
    Received: "undefined"

    [0m [90m 174 |[39m       [36mif[39m (status[33m.[39mlatency [33m!==[39m undefined [33m||[39m sta
tus[33m.[39mresponseTime [33m!==[39m undefined [33m||[39m status[33m.[39mping [33m!==[39m undefined) 
{
     [90m 175 |[39m         [36mconst[39m metric [33m=[39m status[33m.[39mlatency [33m||[39m status[
33m.[39mresponseTime [33m||[39m status[33m.[39mping[33m;[39m
    [31m[1m>[22m[39m[90m 176 |[39m         expect([36mtypeof[39m metric)[33m.[39mtoBe([32m'number'[
39m)[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 177 |[39m         expect(metric)[33m.[39mtoBeGreaterThanOrEqual([35m0[39m)[33m;[39m
     [90m 178 |[39m       }
     [90m 179 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/agents.test.ts:176:31)

  ● T019: 智能体管理测试 › 4️⃣ 配置重载功能 › 应该成功触发配置重载

    expect(received).toBeLessThan(expected)

    Expected: < 400
    Received:   500

    [0m [90m 189 |[39m         expect([[35m401[39m[33m,[39m [35m403[39m])[33m.[39mtoContain(response
[33m.[39mstatus)[33m;[39m
     [90m 190 |[39m       } [36melse[39m {
    [31m[1m>[22m[39m[90m 191 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m
400[39m)[33m;[39m
     [90m     |[39m                                 [31m[1m^[22m[39m
     [90m 192 |[39m         expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'code'[39m)[33m;
[39m
     [90m 193 |[39m       }
     [90m 194 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/agents.test.ts:191:33)

  ● T019: 智能体管理测试 › 5️⃣ 智能体验证功能 › 应该支持验证智能体配置

    expect(received).toHaveProperty(path)

    Expected path: "valid"
    Received path: []

    Received value: {"agentId": "cad-editor-agent", "exists": true, "isActive": true, "isValid": false}

    [0m [90m 221 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBeLessThan([35m400[39m)[33m;
[39m
     [90m 222 |[39m         expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'data'[39m)[33m;
[39m
    [31m[1m>[22m[39m[90m 223 |[39m         expect(response[33m.[39mbody[33m.[39mdata)[33m.[39mtoHav
eProperty([32m'valid'[39m)[33m;[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 224 |[39m       } [36melse[39m {
     [90m 225 |[39m         [90m// 端点不存在也是可以的[39m
     [90m 226 |[39m         expect(response[33m.[39mstatus)[33m.[39mtoBe([35m404[39m)[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/agents.test.ts:223:36)

  ● T019: 智能体管理测试 › 5️⃣ 智能体验证功能 › 验证结果应该包含详细信息

    expect(received).toHaveProperty(path)

    Expected path: "valid"
    Received path: []

    Received value: {"agentId": "cad-editor-agent", "exists": true, "isActive": true, "isValid": false}

    [0m [90m 235 |[39m       [36mif[39m (response[33m.[39mstatus [33m===[39m [35m200[39m) {
     [90m 236 |[39m         [36mconst[39m validation [33m=[39m response[33m.[39mbody[33m.[39mdata[33
m;[39m
    [31m[1m>[22m[39m[90m 237 |[39m         expect(validation)[33m.[39mtoHaveProperty([32m'valid'[39m)
[33m;[39m
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 238 |[39m         expect([36mtypeof[39m validation[33m.[39mvalid)[33m.[39mtoBe([32m'boolean'
[39m)[33m;[39m
     [90m 239 |[39m         
     [90m 240 |[39m         [90m// 可能包含错误或警告信息[39m[0m

      at Object.<anonymous> (src/__tests__/agents.test.ts:237:28)

  ● T019: 智能体管理测试 › 6️⃣ 智能体能力查询 › 智能体配置应该包含必要的认证信息标志

    expect(received).toBeTruthy()

    Received: undefined

    [0m [90m 279 |[39m       
     [90m 280 |[39m       [90m// 配置应该存在[39m
    [31m[1m>[22m[39m[90m 281 |[39m       expect(agent[33m.[39mconfig)[33m.[39mtoBeTruthy()[33m;[39m
     [90m     |[39m                            [31m[1m^[22m[39m
     [90m 282 |[39m       
     [90m 283 |[39m       [90m// 敏感信息不应该暴露完整内容[39m
     [90m 284 |[39m       [36mconst[39m config [33m=[39m agent[33m.[39mconfig[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/agents.test.ts:281:28)

PASS src/__tests__/services/AgentConfigService.border.test.ts
PASS src/__tests__/utils/dbTestUtils.ts
PASS src/__tests__/mocks/QueueManager.ts
FAIL src/__tests__/integration/sessionPersistence.test.ts
  ● Session Persistence Verification › Database Storage › should verify chat_sessions table exists

    DB_NOT_INITIALIZED

    [0m [90m 108 |[39m [36mexport[39m [36mfunction[39m getPool()[33m:[39m [33mPool[39m {
     [90m 109 |[39m   [36mif[39m ([33m![39mpool) {
    [31m[1m>[22m[39m[90m 110 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'DB_NOT_INITIAL
IZED'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 111 |[39m   }
     [90m 112 |[39m   [36mreturn[39m pool[33m;[39m
     [90m 113 |[39m }[0m

      at getPool (src/utils/db.ts:110:11)
      at Object.<anonymous> (src/__tests__/integration/sessionPersistence.test.ts:20:27)

  ● Session Persistence Verification › Database Storage › should verify chat_messages table exists

    DB_NOT_INITIALIZED

    [0m [90m 108 |[39m [36mexport[39m [36mfunction[39m getPool()[33m:[39m [33mPool[39m {
     [90m 109 |[39m   [36mif[39m ([33m![39mpool) {
    [31m[1m>[22m[39m[90m 110 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'DB_NOT_INITIAL
IZED'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 111 |[39m   }
     [90m 112 |[39m   [36mreturn[39m pool[33m;[39m
     [90m 113 |[39m }[0m

      at getPool (src/utils/db.ts:110:11)
      at Object.<anonymous> (src/__tests__/integration/sessionPersistence.test.ts:34:27)

  ● Session Persistence Verification › Database Storage › should verify required columns in chat_sessions

    DB_NOT_INITIALIZED

    [0m [90m 108 |[39m [36mexport[39m [36mfunction[39m getPool()[33m:[39m [33mPool[39m {
     [90m 109 |[39m   [36mif[39m ([33m![39mpool) {
    [31m[1m>[22m[39m[90m 110 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'DB_NOT_INITIAL
IZED'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 111 |[39m   }
     [90m 112 |[39m   [36mreturn[39m pool[33m;[39m
     [90m 113 |[39m }[0m

      at getPool (src/utils/db.ts:110:11)
      at Object.<anonymous> (src/__tests__/integration/sessionPersistence.test.ts:48:27)

  ● Session Persistence Verification › Database Storage › should verify required columns in chat_messages

    DB_NOT_INITIALIZED

    [0m [90m 108 |[39m [36mexport[39m [36mfunction[39m getPool()[33m:[39m [33mPool[39m {
     [90m 109 |[39m   [36mif[39m ([33m![39mpool) {
    [31m[1m>[22m[39m[90m 110 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'DB_NOT_INITIAL
IZED'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 111 |[39m   }
     [90m 112 |[39m   [36mreturn[39m pool[33m;[39m
     [90m 113 |[39m }[0m

      at getPool (src/utils/db.ts:110:11)
      at Object.<anonymous> (src/__tests__/integration/sessionPersistence.test.ts:69:27)

  ● Session Persistence Verification › Data Persistence Flow › should persist session data to database

    DB_NOT_INITIALIZED

    [0m [90m 108 |[39m [36mexport[39m [36mfunction[39m getPool()[33m:[39m [33mPool[39m {
     [90m 109 |[39m   [36mif[39m ([33m![39mpool) {
    [31m[1m>[22m[39m[90m 110 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'DB_NOT_INITIAL
IZED'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 111 |[39m   }
     [90m 112 |[39m   [36mreturn[39m pool[33m;[39m
     [90m 113 |[39m }[0m

      at getPool (src/utils/db.ts:110:11)
      at Object.<anonymous> (src/__tests__/integration/sessionPersistence.test.ts:91:27)

  ● Session Persistence Verification › Data Persistence Flow › should persist messages data to database

    DB_NOT_INITIALIZED

    [0m [90m 108 |[39m [36mexport[39m [36mfunction[39m getPool()[33m:[39m [33mPool[39m {
     [90m 109 |[39m   [36mif[39m ([33m![39mpool) {
    [31m[1m>[22m[39m[90m 110 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'DB_NOT_INITIAL
IZED'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 111 |[39m   }
     [90m 112 |[39m   [36mreturn[39m pool[33m;[39m
     [90m 113 |[39m }[0m

      at getPool (src/utils/db.ts:110:11)
      at Object.<anonymous> (src/__tests__/integration/sessionPersistence.test.ts:124:27)

  ● Session Persistence Verification › Data Consistency › should maintain referential integrity between session
s and messages

    DB_NOT_INITIALIZED

    [0m [90m 108 |[39m [36mexport[39m [36mfunction[39m getPool()[33m:[39m [33mPool[39m {
     [90m 109 |[39m   [36mif[39m ([33m![39mpool) {
    [31m[1m>[22m[39m[90m 110 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'DB_NOT_INITIAL
IZED'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 111 |[39m   }
     [90m 112 |[39m   [36mreturn[39m pool[33m;[39m
     [90m 113 |[39m }[0m

      at getPool (src/utils/db.ts:110:11)
      at Object.<anonymous> (src/__tests__/integration/sessionPersistence.test.ts:170:27)

  ● Session Persistence Verification › Data Consistency › should handle concurrent session updates correctly

    DB_NOT_INITIALIZED

    [0m [90m 108 |[39m [36mexport[39m [36mfunction[39m getPool()[33m:[39m [33mPool[39m {
     [90m 109 |[39m   [36mif[39m ([33m![39mpool) {
    [31m[1m>[22m[39m[90m 110 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'DB_NOT_INITIAL
IZED'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 111 |[39m   }
     [90m 112 |[39m   [36mreturn[39m pool[33m;[39m
     [90m 113 |[39m }[0m

      at getPool (src/utils/db.ts:110:11)
      at Object.<anonymous> (src/__tests__/integration/sessionPersistence.test.ts:197:27)

  ● Session Persistence Verification › Performance Verification › should retrieve session data efficiently

    DB_NOT_INITIALIZED

    [0m [90m 108 |[39m [36mexport[39m [36mfunction[39m getPool()[33m:[39m [33mPool[39m {
     [90m 109 |[39m   [36mif[39m ([33m![39mpool) {
    [31m[1m>[22m[39m[90m 110 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'DB_NOT_INITIAL
IZED'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 111 |[39m   }
     [90m 112 |[39m   [36mreturn[39m pool[33m;[39m
     [90m 113 |[39m }[0m

      at getPool (src/utils/db.ts:110:11)
      at Object.<anonymous> (src/__tests__/integration/sessionPersistence.test.ts:233:27)

  ● Session Persistence Verification › Performance Verification › should support efficient message pagination

    DB_NOT_INITIALIZED

    [0m [90m 108 |[39m [36mexport[39m [36mfunction[39m getPool()[33m:[39m [33mPool[39m {
     [90m 109 |[39m   [36mif[39m ([33m![39mpool) {
    [31m[1m>[22m[39m[90m 110 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'DB_NOT_INITIAL
IZED'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 111 |[39m   }
     [90m 112 |[39m   [36mreturn[39m pool[33m;[39m
     [90m 113 |[39m }[0m

      at getPool (src/utils/db.ts:110:11)
      at Object.<anonymous> (src/__tests__/integration/sessionPersistence.test.ts:250:27)

  ● Session Persistence Verification › Data Integrity › should enforce NOT NULL constraints on required fields

    DB_NOT_INITIALIZED

    [0m [90m 108 |[39m [36mexport[39m [36mfunction[39m getPool()[33m:[39m [33mPool[39m {
     [90m 109 |[39m   [36mif[39m ([33m![39mpool) {
    [31m[1m>[22m[39m[90m 110 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'DB_NOT_INITIAL
IZED'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 111 |[39m   }
     [90m 112 |[39m   [36mreturn[39m pool[33m;[39m
     [90m 113 |[39m }[0m

      at getPool (src/utils/db.ts:110:11)
      at Object.<anonymous> (src/__tests__/integration/sessionPersistence.test.ts:298:27)

  ● Session Persistence Verification › Data Integrity › should maintain created_at and updated_at timestamps

    DB_NOT_INITIALIZED

    [0m [90m 108 |[39m [36mexport[39m [36mfunction[39m getPool()[33m:[39m [33mPool[39m {
     [90m 109 |[39m   [36mif[39m ([33m![39mpool) {
    [31m[1m>[22m[39m[90m 110 |[39m     [36mthrow[39m [36mnew[39m [33mError[39m([32m'DB_NOT_INITIAL
IZED'[39m)[33m;[39m
     [90m     |[39m           [31m[1m^[22m[39m
     [90m 111 |[39m   }
     [90m 112 |[39m   [36mreturn[39m pool[33m;[39m
     [90m 113 |[39m }[0m

      at getPool (src/utils/db.ts:110:11)
      at Object.<anonymous> (src/__tests__/integration/sessionPersistence.test.ts:310:27)

PASS src/__tests__/middleware/errorHandler.enhanced.test.ts
FAIL src/__tests__/frontend/reasoning.test.ts
  ● Test suite failed to run

    [96msrc/__tests__/frontend/reasoning.test.ts[0m:[93m7[0m:[93m3[0m - [91merror[0m[90m TS2614: [0mM
odule '"../../../../frontend/src/lib/reasoning"' has no exported member 'reasoningAgent'. Did you mean to use '
import reasoningAgent from "../../../../frontend/src/lib/reasoning"' instead?

    [7m7[0m   reasoningAgent,
    [7m [0m [91m  ~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/reasoning.test.ts[0m:[93m8[0m:[93m3[0m - [91merror[0m[90m TS2614: [0mM
odule '"../../../../frontend/src/lib/reasoning"' has no exported member 'analyzeRequest'. Did you mean to use '
import analyzeRequest from "../../../../frontend/src/lib/reasoning"' instead?

    [7m8[0m   analyzeRequest,
    [7m [0m [91m  ~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/reasoning.test.ts[0m:[93m9[0m:[93m3[0m - [91merror[0m[90m TS2614: [0mM
odule '"../../../../frontend/src/lib/reasoning"' has no exported member 'formatResponse'. Did you mean to use '
import formatResponse from "../../../../frontend/src/lib/reasoning"' instead?

    [7m9[0m   formatResponse,
    [7m [0m [91m  ~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/reasoning.test.ts[0m:[93m10[0m:[93m3[0m - [91merror[0m[90m TS2614: [0m
Module '"../../../../frontend/src/lib/reasoning"' has no exported member 'validatePayload'. Did you mean to use
 'import validatePayload from "../../../../frontend/src/lib/reasoning"' instead?

    [7m10[0m   validatePayload,
    [7m  [0m [91m  ~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/reasoning.test.ts[0m:[93m11[0m:[93m3[0m - [91merror[0m[90m TS2614: [0m
Module '"../../../../frontend/src/lib/reasoning"' has no exported member 'parseStreamChunk'. Did you mean to us
e 'import parseStreamChunk from "../../../../frontend/src/lib/reasoning"' instead?

    [7m11[0m   parseStreamChunk,
    [7m  [0m [91m  ~~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/reasoning.test.ts[0m:[93m12[0m:[93m3[0m - [91merror[0m[90m TS2614: [0m
Module '"../../../../frontend/src/lib/reasoning"' has no exported member 'detectStreamEnd'. Did you mean to use
 'import detectStreamEnd from "../../../../frontend/src/lib/reasoning"' instead?

    [7m12[0m   detectStreamEnd
    [7m  [0m [91m  ~~~~~~~~~~~~~~~[0m
    [96msrc/__tests__/frontend/reasoning.test.ts[0m:[93m417[0m:[93m24[0m - [91merror[0m[90m TS7006: [
0mParameter 'result' implicitly has an 'any' type.

    [7m417[0m       results.forEach((result, index) => {
    [7m   [0m [91m                       ~~~~~~[0m
    [96msrc/__tests__/frontend/reasoning.test.ts[0m:[93m417[0m:[93m32[0m - [91merror[0m[90m TS7006: [
0mParameter 'index' implicitly has an 'any' type.

    [7m417[0m       results.forEach((result, index) => {
    [7m   [0m [91m                               ~~~~~[0m

PASS src/__tests__/services/PasswordService.test.ts
PASS src/__tests__/integration/jwtAuthOptimized.integration.test.ts
PASS src/test/session-service.test.ts
PASS src/__tests__/services/ChatProxyService.border.test.ts
PASS src/test/visualization-simple.test.ts
  ● Console

    console.error
      Error getting queue stats: Error: Test error
          at VisualizationDataService.<anonymous> (F:\ss\aa\sssss\llmchat\backend\src\test\visualization-simple
.test.ts:288:15)
          at F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-mock@29.7.0\node_modules\jest-mock\build\index.js:3
97:39
          at VisualizationDataService.<anonymous> (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-mock@29.7.0\n
ode_modules\jest-mock\build\index.js:404:13)
          at VisualizationDataService.mockConstructor (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-mock@29.7
.0\node_modules\jest-mock\build\index.js:148:19)
          at VisualizationController.getQueueStats (F:\ss\aa\sssss\llmchat\backend\src\controllers\Visualizatio
nController.ts:186:34)
          at Object.<anonymous> (F:\ss\aa\sssss\llmchat\backend\src\test\visualization-simple.test.ts:304:24)
          at Promise.then.completed (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\
jest-circus\build\utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-
circus\build\utils.js:231:10)
          at _callCircusTest (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-ci
rcus\build\run.js:316:40)
          at runNextTicks (node:internal/process/task_queues:65:5)
          at processImmediate (node:internal/timers:473:9)
          at async _runTest (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-cir
cus\build\run.js:252:3)
          at async _runTestsForDescribeBlock (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node
_modules\jest-circus\build\run.js:126:9)
          at async _runTestsForDescribeBlock (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node
_modules\jest-circus\build\run.js:121:9)
          at async _runTestsForDescribeBlock (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node
_modules\jest-circus\build\run.js:121:9)
          at async run (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-circus\b
uild\run.js:71:3)
          at async runAndTransformResultsToJestFormat (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29
.7.0\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
          at async jestAdapter (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-circus@29.7.0\node_modules\jest-
circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
          at async runTestInternal (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-runner@29.7.0\node_modules\j
est-runner\build\runTest.js:367:16)
          at async runTest (F:\ss\aa\sssss\llmchat\node_modules\.pnpm\jest-runner@29.7.0\node_modules\jest-runn
er\build\runTest.js:444:34)

    [0m [90m 195 |[39m       })[33m;[39m
     [90m 196 |[39m     } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 197 |[39m       console[33m.[39merror([32m'Error getting queue stats:'[39m[
33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 198 |[39m       res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 199 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 200 |[39m         error[33m:[39m [32m'Failed to get queue stats'[39m[33m,[39m[0m

      at VisualizationController.getQueueStats (src/controllers/VisualizationController.ts:197:15)
      at Object.<anonymous> (src/test/visualization-simple.test.ts:304:24)

FAIL src/__tests__/performance/benchmark-broken.test.ts
  ● Performance Benchmark Tests › Authentication API Performance › POST /api/auth/register - should respond wit
hin 300ms

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [201, 400, 409]

    [0m [90m 88 |[39m
     [90m 89 |[39m       [90m// Response validation[39m
    [31m[1m>[22m[39m[90m 90 |[39m       expect([[35m201[39m[33m,[39m [35m400[39m[33m,[39m [35m40
9[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m [90m// Created or validation error[39m
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 91 |[39m     })[33m;[39m
     [90m 92 |[39m
     [90m 93 |[39m     it([32m'POST /api/auth/refresh - should respond within 150ms'[39m[33m,[39m [36mas
ync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/__tests__/performance/benchmark-broken.test.ts:90:31)

  ● Performance Benchmark Tests › Authentication API Performance › POST /api/auth/refresh - should respond with
in 150ms

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [200, 401, 403]

    [0m [90m 113 |[39m
     [90m 114 |[39m       [90m// Response validation[39m
    [31m[1m>[22m[39m[90m 115 |[39m       expect([[35m200[39m[33m,[39m [35m401[39m[33m,[39m [35m4
03[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m [90m// Success or token errors[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 116 |[39m     })[33m;[39m
     [90m 117 |[39m   })[33m;[39m
     [90m 118 |[39m[0m

      at Object.<anonymous> (src/__tests__/performance/benchmark-broken.test.ts:115:31)

  ● Performance Benchmark Tests › Agent API Performance › GET /api/agents - should respond within 100ms

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

    [0m [90m 139 |[39m
     [90m 140 |[39m       [90m// Response validation[39m
    [31m[1m>[22m[39m[90m 141 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 142 |[39m       expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'agents'[39m)[33m;
[39m
     [90m 143 |[39m       expect([33mArray[39m[33m.[39misArray(response[33m.[39mbody[33m.[39magents))
[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 144 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/performance/benchmark-broken.test.ts:141:31)

  ● Performance Benchmark Tests › Agent API Performance › GET /api/agents/:id/status - should respond within 50
ms

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [1]

    [0m [90m 163 |[39m
     [90m 164 |[39m       [90m// Response validation[39m
    [31m[1m>[22m[39m[90m 165 |[39m       expect([[35m1[39m])[33m.[39mtoContain(response[33m.[39msta
tus)[33m;[39m [90m// Success or not found[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 166 |[39m     })[33m;[39m
     [90m 167 |[39m   })[33m;[39m
     [90m 168 |[39m[0m

      at Object.<anonymous> (src/__tests__/performance/benchmark-broken.test.ts:165:19)

  ● Performance Benchmark Tests › Chat API Performance › POST /api/chat/completions - should respond within 500
0ms

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [1]

    [0m [90m 195 |[39m
     [90m 196 |[39m       [90m// Response validation[39m
    [31m[1m>[22m[39m[90m 197 |[39m       expect([[35m1[39m])[33m.[39mtoContain(response[33m.[39msta
tus)[33m;[39m [90m// Success or error[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 198 |[39m     })[33m;[39m
     [90m 199 |[39m
     [90m 200 |[39m     it([32m'GET /api/chat/history/:sessionId - should respond within 200ms'[39m[33m,[
39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/__tests__/performance/benchmark-broken.test.ts:197:19)

  ● Performance Benchmark Tests › Chat API Performance › GET /api/chat/history/:sessionId - should respond with
in 200ms

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [1]

    [0m [90m 219 |[39m
     [90m 220 |[39m       [90m// Response validation[39m
    [31m[1m>[22m[39m[90m 221 |[39m       expect([[35m1[39m])[33m.[39mtoContain(response[33m.[39msta
tus)[33m;[39m [90m// Success or not found[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 222 |[39m     })[33m;[39m
     [90m 223 |[39m   })[33m;[39m
     [90m 224 |[39m[0m

      at Object.<anonymous> (src/__tests__/performance/benchmark-broken.test.ts:221:19)

  ● Performance Benchmark Tests › Admin API Performance › GET /api/admin/stats - should respond within 300ms

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [1]

    [0m [90m 244 |[39m
     [90m 245 |[39m       [90m// Response validation[39m
    [31m[1m>[22m[39m[90m 246 |[39m       expect([[35m1[39m])[33m.[39mtoContain(response[33m.[39msta
tus)[33m;[39m [90m// Success or auth error[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 247 |[39m     })[33m;[39m
     [90m 248 |[39m
     [90m 249 |[39m     it([32m'GET /api/admin/audit - should respond within 500ms'[39m[33m,[39m [36masy
nc[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/__tests__/performance/benchmark-broken.test.ts:246:19)

  ● Performance Benchmark Tests › Admin API Performance › GET /api/admin/audit - should respond within 500ms

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [1]

    [0m [90m 266 |[39m
     [90m 267 |[39m       [90m// Response validation[39m
    [31m[1m>[22m[39m[90m 268 |[39m       expect([[35m1[39m])[33m.[39mtoContain(response[33m.[39msta
tus)[33m;[39m [90m// Success or auth error[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 269 |[39m     })[33m;[39m
     [90m 270 |[39m   })[33m;[39m
     [90m 271 |[39m[0m

      at Object.<anonymous> (src/__tests__/performance/benchmark-broken.test.ts:268:19)

  ● Performance Benchmark Tests › Queue Management API Performance › GET /api/queue/stats - should respond with
in 100ms

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [1]

    [0m [90m 291 |[39m
     [90m 292 |[39m       [90m// Response validation[39m
    [31m[1m>[22m[39m[90m 293 |[39m       expect([[35m1[39m])[33m.[39mtoContain(response[33m.[39msta
tus)[33m;[39m [90m// Success or auth error[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 294 |[39m     })[33m;[39m
     [90m 295 |[39m
     [90m 296 |[39m     it([32m'POST /api/queue/pause - should respond within 50ms'[39m[33m,[39m [36masy
nc[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/__tests__/performance/benchmark-broken.test.ts:293:19)

  ● Performance Benchmark Tests › Queue Management API Performance › POST /api/queue/pause - should respond wit
hin 50ms

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [1]

    [0m [90m 315 |[39m
     [90m 316 |[39m       [90m// Response validation[39m
    [31m[1m>[22m[39m[90m 317 |[39m       expect([[35m1[39m])[33m.[39mtoContain(response[33m.[39msta
tus)[33m;[39m [90m// Success or error[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 318 |[39m     })[33m;[39m
     [90m 319 |[39m   })[33m;[39m
     [90m 320 |[39m[0m

      at Object.<anonymous> (src/__tests__/performance/benchmark-broken.test.ts:317:19)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)

PASS src/__tests__/integration/basic.integration.test.ts
PASS src/__tests__/integration/basic.integration.fixed.test.ts
FAIL src/__tests__/performance/benchmark.test.ts
  ● Performance Benchmark Tests › Authentication API Performance › POST /api/auth/register - should respond wit
hin 300ms

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [201, 400, 409]

    [0m [90m 88 |[39m
     [90m 89 |[39m       [90m// Response validation[39m
    [31m[1m>[22m[39m[90m 90 |[39m       expect([[35m201[39m[33m,[39m [35m400[39m[33m,[39m [35m40
9[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m [90m// Created or validation error[39m
     [90m    |[39m                               [31m[1m^[22m[39m
     [90m 91 |[39m     })[33m;[39m
     [90m 92 |[39m
     [90m 93 |[39m     it([32m'POST /api/auth/refresh - should respond within 150ms'[39m[33m,[39m [36mas
ync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/__tests__/performance/benchmark.test.ts:90:31)

  ● Performance Benchmark Tests › Authentication API Performance › POST /api/auth/refresh - should respond with
in 150ms

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [200, 401, 403]

    [0m [90m 113 |[39m
     [90m 114 |[39m       [90m// Response validation[39m
    [31m[1m>[22m[39m[90m 115 |[39m       expect([[35m200[39m[33m,[39m [35m401[39m[33m,[39m [35m4
03[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m [90m// Success or token errors[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 116 |[39m     })[33m;[39m
     [90m 117 |[39m   })[33m;[39m
     [90m 118 |[39m[0m

      at Object.<anonymous> (src/__tests__/performance/benchmark.test.ts:115:31)

  ● Performance Benchmark Tests › Agent API Performance › GET /api/agents - should respond within 100ms

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 404

    [0m [90m 139 |[39m
     [90m 140 |[39m       [90m// Response validation[39m
    [31m[1m>[22m[39m[90m 141 |[39m       expect(response[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)
[33m;[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 142 |[39m       expect(response[33m.[39mbody)[33m.[39mtoHaveProperty([32m'agents'[39m)[33m;
[39m
     [90m 143 |[39m       expect([33mArray[39m[33m.[39misArray(response[33m.[39mbody[33m.[39magents))
[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m 144 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (src/__tests__/performance/benchmark.test.ts:141:31)

  ● Performance Benchmark Tests › Chat API Performance › POST /api/chat/completions - should respond within 500
0ms

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [200, 400, 500]

    [0m [90m 195 |[39m
     [90m 196 |[39m       [90m// Response validation[39m
    [31m[1m>[22m[39m[90m 197 |[39m       expect([[35m200[39m[33m,[39m [35m400[39m[33m,[39m [35m5
00[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m [90m// Success or error[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 198 |[39m     })[33m;[39m
     [90m 199 |[39m
     [90m 200 |[39m     it([32m'GET /api/chat/history/:sessionId - should respond within 200ms'[39m[33m,[
39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/__tests__/performance/benchmark.test.ts:197:31)

  ● Performance Benchmark Tests › Admin API Performance › GET /api/admin/stats - should respond within 300ms

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [200, 401, 403]

    [0m [90m 244 |[39m
     [90m 245 |[39m       [90m// Response validation[39m
    [31m[1m>[22m[39m[90m 246 |[39m       expect([[35m200[39m[33m,[39m [35m401[39m[33m,[39m [35m4
03[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m [90m// Success or auth error[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 247 |[39m     })[33m;[39m
     [90m 248 |[39m
     [90m 249 |[39m     it([32m'GET /api/admin/audit - should respond within 500ms'[39m[33m,[39m [36masy
nc[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/__tests__/performance/benchmark.test.ts:246:31)

  ● Performance Benchmark Tests › Admin API Performance › GET /api/admin/audit - should respond within 500ms

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [200, 401, 403]

    [0m [90m 266 |[39m
     [90m 267 |[39m       [90m// Response validation[39m
    [31m[1m>[22m[39m[90m 268 |[39m       expect([[35m200[39m[33m,[39m [35m401[39m[33m,[39m [35m4
03[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m [90m// Success or auth error[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 269 |[39m     })[33m;[39m
     [90m 270 |[39m   })[33m;[39m
     [90m 271 |[39m[0m

      at Object.<anonymous> (src/__tests__/performance/benchmark.test.ts:268:31)

  ● Performance Benchmark Tests › Queue Management API Performance › GET /api/queue/stats - should respond with
in 100ms

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [200, 401, 403]

    [0m [90m 291 |[39m
     [90m 292 |[39m       [90m// Response validation[39m
    [31m[1m>[22m[39m[90m 293 |[39m       expect([[35m200[39m[33m,[39m [35m401[39m[33m,[39m [35m4
03[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m [90m// Success or auth error[39m
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 294 |[39m     })[33m;[39m
     [90m 295 |[39m
     [90m 296 |[39m     it([32m'POST /api/queue/pause - should respond within 50ms'[39m[33m,[39m [36masy
nc[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/__tests__/performance/benchmark.test.ts:293:31)

  ● Performance Benchmark Tests › Queue Management API Performance › POST /api/queue/pause - should respond wit
hin 50ms

    expect(received).toContain(expected) // indexOf

    Expected value: 404
    Received array: [200, 400, 401, 403]

    [0m [90m 315 |[39m
     [90m 316 |[39m       [90m// Response validation[39m
    [31m[1m>[22m[39m[90m 317 |[39m       expect([[35m200[39m[33m,[39m [35m400[39m[33m,[39m [35m4
01[39m[33m,[39m [35m403[39m])[33m.[39mtoContain(response[33m.[39mstatus)[33m;[39m [90m// Success or
 error[39m
     [90m     |[39m                                    [31m[1m^[22m[39m
     [90m 318 |[39m     })[33m;[39m
     [90m 319 |[39m   })[33m;[39m
     [90m 320 |[39m[0m

      at Object.<anonymous> (src/__tests__/performance/benchmark.test.ts:317:36)

PASS src/__tests__/agentConfigService.test.ts
PASS src/__tests__/testUtilsSimple.ts

  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)

FAIL src/__tests__/integration/simplePerformance.test.ts
  ● Simple Performance Benchmark Tests › Basic API Performance Benchmarks › should respond to agents list withi
n 100ms

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

    [0m [90m 42 |[39m       expect(responseTime)[33m.[39mtoBeLessThan([35m100[39m)[33m;[39m
     [90m 43 |[39m       expect(response[33m.[39mbody)[33m.[39mtoBeDefined()[33m;[39m
    [31m[1m>[22m[39m[90m 44 |[39m       expect([33mArray[39m[33m.[39misArray(response[33m.[39mbody)
)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
     [90m    |[39m                                            [31m[1m^[22m[39m
     [90m 45 |[39m     })[33m;[39m
     [90m 46 |[39m
     [90m 47 |[39m     it([32m'should handle mock JWT token generation within 50ms'[39m[33m,[39m [36masy
nc[39m () [33m=>[39m {[0m

      at Object.<anonymous> (src/__tests__/integration/simplePerformance.test.ts:44:44)

  ● Simple Performance Benchmark Tests › Basic API Performance Benchmarks › should handle mock JWT token genera
tion within 50ms

    expected 200 "OK", got 404 "Not Found"

    [0m [90m 55 |[39m           password[33m:[39m [32m'testpassword'[39m
     [90m 56 |[39m         })
    [31m[1m>[22m[39m[90m 57 |[39m         [33m.[39mexpect([35m200[39m)[33m;[39m
     [90m    |[39m          [31m[1m^[22m[39m
     [90m 58 |[39m
     [90m 59 |[39m       [36mconst[39m responseTime [33m=[39m [33mDate[39m[33m.[39mnow() [33m-[39m 
startTime[33m;[39m
     [90m 60 |[39m       performanceResults[33m.[39mmockJwtGeneration [33m=[39m responseTime[33m;[39m[
0m

      at Object.<anonymous> (src/__tests__/integration/simplePerformance.test.ts:57:10)
      ----
      at Test._assertStatus (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14)
      at ../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
      at Test._assertFunction (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13)
      at Test.assert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23)
      at localAssert (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14)
      at Server.<anonymous> (../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: this.monitoringService.getCurrentMetrics is no
t a function
        at VisualizationDataService.collectPerformanceMetrics (F:\ss\aa\sssss\llmchat\backend\src\services\Visu
alizationDataService.ts:164:54)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:65:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 162 |[39m     })[33m;[39m
     [90m 163 |[39m
    [31m[1m>[22m[39m[90m 164 |[39m     [36mthis[39m[33m.[39mbroadcastUpdate({
     [90m     |[39m                                               [31m[1m^[22m[39m
     [90m 165 |[39m       timestamp[33m,[39m
     [90m 166 |[39m       type[33m:[39m [32m'system'[39m[33m,[39m
     [90m 167 |[39m       data[33m:[39m systemStats[33m,[39m[0m

      at VisualizationDataService.collectPerformanceMetrics (src/services/VisualizationDataService.ts:164:54)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:65:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: this.monitoringService.getCurrentMetrics is no
t a function
        at VisualizationDataService.collectPerformanceMetrics (F:\ss\aa\sssss\llmchat\backend\src\services\Visu
alizationDataService.ts:164:54)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:65:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 162 |[39m     })[33m;[39m
     [90m 163 |[39m
    [31m[1m>[22m[39m[90m 164 |[39m     [36mthis[39m[33m.[39mbroadcastUpdate({
     [90m     |[39m                                               [31m[1m^[22m[39m
     [90m 165 |[39m       timestamp[33m,[39m
     [90m 166 |[39m       type[33m:[39m [32m'system'[39m[33m,[39m
     [90m 167 |[39m       data[33m:[39m systemStats[33m,[39m[0m

      at VisualizationDataService.collectPerformanceMetrics (src/services/VisualizationDataService.ts:164:54)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:65:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Error collecting realtime data: TypeError: Cannot read properties of undefined (reading '
active')
        at VisualizationDataService.collectRedisStats (F:\ss\aa\sssss\llmchat\backend\src\services\Visualizatio
nDataService.ts:145:35)
        at VisualizationDataService.collectAllData (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDa
taService.ts:64:18)
        at Timeout._onTimeout (F:\ss\aa\sssss\llmchat\backend\src\services\VisualizationDataService.ts:39:28)
        at listOnTimeout (node:internal/timers:608:17)
        at processTimers (node:internal/timers:543:7)".

    [0m [90m 143 |[39m     [90m// 并行收集各种数据[39m
     [90m 144 |[39m     [36mconst[39m [queueStats[33m,[39m systemStats[33m,[39m redisStats[33m,[39m p
erformanceMetrics] [33m=[39m [36mawait[39m [33mPromise[39m[33m.[39mall([
    [31m[1m>[22m[39m[90m 145 |[39m       [36mthis[39m[33m.[39mcollectQueueStats(timestamp)[33m,[39m
     [90m     |[39m                                   [31m[1m^[22m[39m
     [90m 146 |[39m       [36mthis[39m[33m.[39mcollectSystemStats(timestamp)[33m,[39m
     [90m 147 |[39m       [36mthis[39m[33m.[39mcollectRedisStats(timestamp)[33m,[39m
     [90m 148 |[39m       [36mthis[39m[33m.[39mcollectPerformanceMetrics(timestamp)[33m,[39m[0m

      at VisualizationDataService.collectRedisStats (src/services/VisualizationDataService.ts:145:35)
      at VisualizationDataService.collectAllData (src/services/VisualizationDataService.ts:64:18)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:39:28)
      at processTimers (node:internal/timers:543:7)".
      at console.error (../node_modules/.pnpm/@jest+console@29.7.0/node_modules/@jest/console/build/BufferedCon
sole.js:127:10)
      at Timeout._onTimeout (src/services/VisualizationDataService.ts:42:25)

