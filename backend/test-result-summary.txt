
> @llmchat/backend@1.0.0 test
> jest --runInBand

node.exe : FAIL src/__tests__/integration/chat.integration.test.ts
At F:\ProgramFiles\nodejs\npm.ps1:29 char:3
+   & $NODE_EXE $NPM_CLI_JS $args
+   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (FAIL src/__test...gration.test.ts 
   :String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
 
  ● Test suite failed to run

    TOKEN_SECRET must be set and at least 32 characters long for security

    [0m [90m 90 |[39m     [36mthis[39m[33m.[39mtokenSecret [33m=[39m e
nvManager[33m.[39m[36mget[39m([32m'TOKEN_SECRET'[39m)[33m;[39m
     [90m 91 |[39m     [36mif[39m ([33m![39m[36mthis[39m[33m.[39mtoke
nSecret [33m||[39m [36mthis[39m[33m.[39mtokenSecret[33m.[39mlength [33
m<[39m [35m32[39m) {
    [31m[1m>[22m[39m[90m 92 |[39m       [36mthrow[39m [36mnew[39m [3
3mError[39m(
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 93 |[39m         [32m'TOKEN_SECRET must be set and at least 32 cha
racters long for security'[39m[33m,[39m
     [90m 94 |[39m       )[33m;[39m
     [90m 95 |[39m     }[0m

      at new AuthServiceV2 (src/services/AuthServiceV2.ts:92:13)
      at getAuthService (src/services/AuthServiceV2.ts:667:27)
      at Object.<anonymous> (src/services/authInstance.ts:27:21)
      at Object.<anonymous> (src/controllers/AgentController.ts:13:1)
      at Object.<anonymous> (src/routes/agents.ts:11:1)
      at Object.<anonymous> (src/index.ts:44:1)
      at Object.<anonymous> (src/__tests__/integration/chat.integration.test.ts
:16:1)

FAIL src/__tests__/integration/databaseMigration.integration.test.ts (10.186 s)
  ● Database Migration Integration Tests › Schema Initialization › should creat
e all required tables on initialization

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39
m [36mawait[39m [36mthis[39m[33m.[39mtestPool[33m.[39mconnect()[33m;[
39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT 
NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/in
dex.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUt
ils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.
integration.test.ts:11:5)

  ● Database Migration Integration Tests › Schema Initialization › should creat
e all required indexes

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39
m [36mawait[39m [36mthis[39m[33m.[39mtestPool[33m.[39mconnect()[33m;[
39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT 
NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/in
dex.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUt
ils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.
integration.test.ts:11:5)

  ● Database Migration Integration Tests › Schema Initialization › should have 
correct table schemas

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39
m [36mawait[39m [36mthis[39m[33m.[39mtestPool[33m.[39mconnect()[33m;[
39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT 
NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/in
dex.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUt
ils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.
integration.test.ts:11:5)

  ● Database Migration Integration Tests › Data Types and Constraints › should 
enforce UUID primary keys

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39
m [36mawait[39m [36mthis[39m[33m.[39mtestPool[33m.[39mconnect()[33m;[
39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT 
NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/in
dex.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUt
ils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.
integration.test.ts:11:5)

  ● Database Migration Integration Tests › Data Types and Constraints › should 
enforce foreign key constraints

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39
m [36mawait[39m [36mthis[39m[33m.[39mtestPool[33m.[39mconnect()[33m;[
39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT 
NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/in
dex.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUt
ils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.
integration.test.ts:11:5)

  ● Database Migration Integration Tests › Data Types and Constraints › should 
handle JSONB data type correctly

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39
m [36mawait[39m [36mthis[39m[33m.[39mtestPool[33m.[39mconnect()[33m;[
39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT 
NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/in
dex.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUt
ils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.
integration.test.ts:11:5)

  ● Database Migration Integration Tests › Data Types and Constraints › should 
handle timestamp columns correctly

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39
m [36mawait[39m [36mthis[39m[33m.[39mtestPool[33m.[39mconnect()[33m;[
39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT 
NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/in
dex.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUt
ils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.
integration.test.ts:11:5)

  ● Database Migration Integration Tests › Performance and Indexing › should us
e indexes for email lookups

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39
m [36mawait[39m [36mthis[39m[33m.[39mtestPool[33m.[39mconnect()[33m;[
39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT 
NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/in
dex.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUt
ils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.
integration.test.ts:11:5)

  ● Database Migration Integration Tests › Performance and Indexing › should ha
ndle large datasets efficiently

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39
m [36mawait[39m [36mthis[39m[33m.[39mtestPool[33m.[39mconnect()[33m;[
39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT 
NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/in
dex.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUt
ils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.
integration.test.ts:11:5)

  ● Database Migration Integration Tests › Data Integrity and Validation › shou
ld maintain referential integrity on cascade deletes

    read ECONNRESET

    [0m [90m 52 |[39m
     [90m 53 |[39m       [90m// 测试连接[39m
    [31m[1m>[22m[39m[90m 54 |[39m       [36mconst[39m client [33m=[39
m [36mawait[39m [36mthis[39m[33m.[39mtestPool[33m.[39mconnect()[33m;[
39m
     [90m    |[39m                      [31m[1m^[22m[39m
     [90m 55 |[39m       [36mawait[39m client[33m.[39mquery([32m'SELECT 
NOW()'[39m)[33m;[39m
     [90m 56 |[39m       client[33m.[39mrelease()[33m;[39m
     [90m 57 |[39m[0m

      at ../node_modules/.pnpm/pg-pool@3.10.1_pg@8.16.3/node_modules/pg-pool/in
dex.js:45:11
      at async DatabaseTestEnvironment.initialize (src/__tests__/utils/dbTestUt
ils.ts:54:22)
      at async Object.beforeAll (src/__tests__/utils/dbTestUtils.ts:431:5)
      at async Object.<anonymous> (src/__tests__/integration/databaseMigration.
integration.test.ts:11:5)

  ● Database Migration Integration Tests › Data Integrity and Validation › shou
ld prevent circular references

    read ECONNRESET

