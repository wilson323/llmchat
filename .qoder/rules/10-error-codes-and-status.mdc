---
alwaysApply: true
description: 统一错误码与语义化 HTTP 状态约定
---

约定
- 对外接口返回语义化 HTTP 状态码，并在响应体内提供 `code` 字段
- 避免泄漏内部堆栈；错误详情仅在日志中记录
- 常见：400 参数错误、401 未认证、403 无权限、404 资源不存在、409 冲突、422 语义错误、429 频率限制、500 服务器错误、502/503 上游/暂不可用

后端建议
- 统一错误构造与中间件处理；对齐 [backend/src/middleware](mdc:backend/src/middleware)
- 在 Service 层对外部调用增加超时/重试/熔断，失败时映射为业务语义错误码

测试
- 覆盖异常路径与边界；断言 HTTP 状态码与 `code` 字段
- 参考： [tests/e2e/chat_history.spec.ts](mdc:tests/e2e/chat_history.spec.ts)
