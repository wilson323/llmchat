# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

è¿™æ˜¯ä¸€ä¸ª**æ™ºèƒ½ä½“åˆ‡æ¢èŠå¤©åº”ç”¨**ï¼Œé‡‡ç”¨å‰ç«¯+åç«¯åˆ†ç¦»æ¶æ„ï¼Œæ”¯æŒå¤šä¸ª AI æä¾›å•†ï¼ˆFastGPTã€OpenAIã€Anthropicã€Difyï¼‰ä¹‹é—´çš„åŠ¨æ€åˆ‡æ¢ã€‚

### æŠ€æœ¯æ ˆ

**å‰ç«¯**: React 18 + TypeScript + Vite + Tailwind CSS + Zustand + React Router
**åç«¯**: Node.js + Express + TypeScript + PostgreSQL/MongoDB + Redis
**çŠ¶æ€ç®¡ç†**: Zustand (å‰ç«¯) + æœ¬åœ°å­˜å‚¨æŒä¹…åŒ–
**æµ‹è¯•**: Jest (åç«¯) + Vitest (å‰ç«¯) + Playwright (E2E)
**åŒ…ç®¡ç†å™¨**: pnpm with workspaces

### é¡¹ç›®ç»“æ„

```
llmchat/
â”œâ”€â”€ backend/                 # åç«¯æœåŠ¡ (ç«¯å£ 3001)
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ controllers/     # æ§åˆ¶å™¨ (AgentController, ChatController, AuthController)
â”‚       â”œâ”€â”€ services/        # ä¸šåŠ¡æœåŠ¡ (AgentConfigService, ChatProxyService, AuthServiceV2)
â”‚       â”œâ”€â”€ routes/          # è·¯ç”±å®šä¹‰ (/api/...)
â”‚       â”œâ”€â”€ middleware/      # ä¸­é—´ä»¶ (JWTè®¤è¯, ä¿æŠ¤ä¸­é—´ä»¶, æ—¥å¿—, é™æµ)
â”‚       â”œâ”€â”€ migrations/      # æ•°æ®åº“è¿ç§»æ–‡ä»¶ (PostgreSQL)
â”‚       â”œâ”€â”€ types/           # TypeScriptç±»å‹å®šä¹‰
â”‚       â””â”€â”€ utils/           # å·¥å…·å‡½æ•°å’Œæ—¥å¿—
â”œâ”€â”€ frontend/                # å‰ç«¯åº”ç”¨ (ç«¯å£ 3000)
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ components/      # Reactç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ agents/      # æ™ºèƒ½ä½“ç›¸å…³ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ chat/        # èŠå¤©ç›¸å…³ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ admin/       # ç®¡ç†åå°ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ theme/       # ä¸»é¢˜ç›¸å…³ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ ui/          # åŸºç¡€UIç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ cad/         # CADæ–‡ä»¶å¤„ç†ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ voice/       # è¯­éŸ³é€šè¯ç»„ä»¶
â”‚       â”‚   â””â”€â”€ workspace/   # å·¥ä½œåŒºç»„ä»¶
â”‚       â”œâ”€â”€ store/           # ZustandçŠ¶æ€ç®¡ç†
â”‚       â”œâ”€â”€ services/        # APIæœåŠ¡å±‚
â”‚       â”œâ”€â”€ hooks/           # React Hooks
â”‚       â””â”€â”€ types/           # TypeScriptç±»å‹å®šä¹‰
â”œâ”€â”€ shared-types/            # å‰åç«¯å…±äº«ç±»å‹å®šä¹‰
â”œâ”€â”€ config/                  # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ agents.json          # æ™ºèƒ½ä½“é…ç½®æ–‡ä»¶
â”œâ”€â”€ tests/                   # E2Eæµ‹è¯•
â”‚   â””â”€â”€ e2e/                 # Playwrightæµ‹è¯•æ–‡ä»¶
â””â”€â”€ docs/                    # é¡¹ç›®æ–‡æ¡£
```

## ğŸš€ å¼€å‘å‘½ä»¤

### ç¯å¢ƒè®¾ç½®
```bash
# å®‰è£…æ‰€æœ‰ä¾èµ–ï¼ˆä½¿ç”¨å·¥ä½œåŒºè‡ªåŠ¨å®‰è£…å‰åç«¯ï¼‰
pnpm install

# é…ç½®åç«¯ç¯å¢ƒå˜é‡
cp backend/.env.example backend/.env
# ç¼–è¾‘ backend/.env è®¾ç½®å¿…è¦é…ç½®ï¼ˆæ•°æ®åº“è¿æ¥ã€JWTå¯†é’¥ã€APIå¯†é’¥ç­‰ï¼‰

# é…ç½®æ™ºèƒ½ä½“ï¼ˆå¦‚éœ€è‡ªå®šä¹‰ï¼‰
cp config/agents.example.json config/agents.json

# ğŸ” å®‰å…¨é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…éœ€ï¼‰
# è®¾ç½®å¼ºå¯†ç çš„JWTå¯†é’¥ï¼ˆè‡³å°‘32å­—ç¬¦ï¼‰
# è®¾ç½®æ•°æ®åº“è¿æ¥åŠ å¯†å¯†é’¥
# é…ç½®å®‰å…¨ç¯å¢ƒå˜é‡
```

## ğŸ”’ å®‰å…¨é…ç½®

### å¿…éœ€ç¯å¢ƒå˜é‡ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

```bash
# JWTå®‰å…¨é…ç½®
TOKEN_SECRET="your-super-secure-jwt-secret-min-32-chars-long"
JWT_ALGORITHM="HS256"
JWT_EXPIRES_IN="1h"
JWT_ISSUER="llmchat-backend"
JWT_AUDIENCE="llmchat-frontend"

# å‡­è¯åŠ å¯†å¯†é’¥
CREDENTIALS_SALT="your-unique-credentials-salt-here"
DATABASE_ENCRYPTION_KEY="your-database-encryption-key"

# æ•°æ®åº“å®‰å…¨
DATABASE_URL="postgresql://username:password@localhost:5432/database?sslmode=require"
# æ³¨æ„ï¼šæ•°æ®åº“å¯†ç ç°åœ¨ä¼šè¢«åŠ å¯†å­˜å‚¨

# åº”ç”¨å®‰å…¨
NODE_ENV="production"
FRONTEND_URL="https://your-domain.com"
RATE_LIMIT_WINDOW_MS="900000"  # 15åˆ†é’Ÿ
RATE_LIMIT_MAX_REQUESTS="100"
```

### å®‰å…¨æœ€ä½³å®è·µ

1. **JWTå¯†é’¥å®‰å…¨**
   - ä½¿ç”¨è‡³å°‘32å­—ç¬¦çš„éšæœºå­—ç¬¦ä¸²
   - å®šæœŸè½®æ¢JWTå¯†é’¥
   - ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥

2. **æ•°æ®åº“å®‰å…¨**
   - æ•°æ®åº“å¯†ç ä½¿ç”¨åŠ å¯†å­˜å‚¨
   - å¯ç”¨SSLè¿æ¥
   - ä½¿ç”¨å¼ºå¯†ç ç­–ç•¥

3. **æ–‡ä»¶ä¸Šä¼ å®‰å…¨**
   - é™åˆ¶æ–‡ä»¶ç±»å‹å’Œå¤§å°
   - æ‰«ææ¶æ„è½¯ä»¶
   - ç”¨æˆ·è®¤è¯å¿…éœ€

4. **æ—¥å¿—å®‰å…¨**
   - æ•æ„Ÿä¿¡æ¯è‡ªåŠ¨è„±æ•
   - ä¸è®°å½•å¯†ç å’Œä»¤ç‰Œ
   - ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—

5. **APIå®‰å…¨**
   - æ‰€æœ‰ç®¡ç†ç«¯ç‚¹éœ€è¦è®¤è¯
   - å®æ–½è¯·æ±‚é€Ÿç‡é™åˆ¶
   - ä½¿ç”¨CORSç­–ç•¥

6. **å¯†ç å®‰å…¨**
   - ä½¿ç”¨bcryptæˆ–SHA-256åŠ ç›å“ˆå¸Œ
   - ä¸å­˜å‚¨æ˜æ–‡å¯†ç 
   - å¼ºåˆ¶å¯†ç å¤æ‚åº¦è¦æ±‚

### å®‰å…¨ä¿®å¤è¯´æ˜

#### å·²ä¿®å¤çš„å…³é”®å®‰å…¨æ¼æ´

1. **ğŸš¨ æ˜æ–‡å¯†ç å­˜å‚¨ï¼ˆå·²ä¿®å¤ï¼‰**
   - ç§»é™¤äº†æ•°æ®åº“ä¸­çš„æ˜æ–‡å¯†ç åˆ—
   - å®ç°äº†å¯†ç çš„å®‰å…¨å“ˆå¸Œå­˜å‚¨
   - ä½¿ç”¨ç›å€¼+SHA-256åŠ å¯†

2. **âš ï¸ æ•æ„Ÿä¿¡æ¯æ—¥å¿—ï¼ˆå·²ä¿®å¤ï¼‰**
   - å®ç°äº†æ—¥å¿—è„±æ•ç³»ç»Ÿ
   - è‡ªåŠ¨å±è”½å¯†ç ã€ä»¤ç‰Œã€APIå¯†é’¥
   - å®‰å…¨çš„æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²æ—¥å¿—

3. **ğŸ” JWTé…ç½®é—®é¢˜ï¼ˆå·²ä¿®å¤ï¼‰**
   - å¼ºåˆ¶ä½¿ç”¨å¼ºJWTå¯†é’¥
   - å®ç°äº†å®Œæ•´çš„JWTéªŒè¯
   - æ·»åŠ äº†ä»¤ç‰Œæ’¤é”€æ”¯æŒ

4. **ğŸ“ æ–‡ä»¶ä¸Šä¼ å®‰å…¨ï¼ˆå·²ä¿®å¤ï¼‰**
   - å®ç°äº†å…¨é¢çš„æ–‡ä»¶éªŒè¯
   - æ·»åŠ äº†æ¶æ„è½¯ä»¶æ‰«æ
   - å¼ºåˆ¶è¦æ±‚ç”¨æˆ·è®¤è¯

### å®‰å…¨å·¥å…·å’Œæ¨¡å—

- `src/utils/secureCredentials.ts` - å‡­æ®åŠ å¯†ç®¡ç†
- `src/utils/secureDb.ts` - å®‰å…¨æ•°æ®åº“é…ç½®
- `src/utils/secureJwt.ts` - å®‰å…¨JWTç®¡ç†
- `src/utils/secureUpload.ts` - å®‰å…¨æ–‡ä»¶ä¸Šä¼ éªŒè¯
- `src/utils/logSanitizer.ts` - æ—¥å¿—è„±æ•å·¥å…·

### ç”Ÿäº§ç¯å¢ƒå®‰å…¨æ£€æŸ¥æ¸…å•

```bash
# 1. éªŒè¯JWTé…ç½®
node -e "const { SecureJWT } = require('./dist/utils/secureJwt'); const validation = SecureJWT.validateConfiguration(); console.log('JWTé…ç½®éªŒè¯:', validation);"

# 2. æ£€æŸ¥æ•°æ®åº“å®‰å…¨
node -e "const { SecureCredentialsManager } = require('./dist/utils/secureCredentials'); console.log('åŠ å¯†å¯ç”¨:', SecureCredentialsManager.isEncryptionAvailable());"

# 3. éªŒè¯ç¯å¢ƒå˜é‡
pnpm run validate:env

# 4. è¿è¡Œå®‰å…¨æµ‹è¯•
pnpm run test:security  # å¦‚æœæœ‰å®‰å…¨æµ‹è¯•

# 5. æ£€æŸ¥ä¾èµ–æ¼æ´
pnpm audit --audit-level high
```

### å¼€å‘æ¨¡å¼
```bash
# æ¨èï¼šå¹¶å‘å¯åŠ¨å‰åç«¯å¼€å‘æœåŠ¡
pnpm run dev

# æˆ–åˆ†åˆ«å¯åŠ¨
pnpm run backend:dev    # åç«¯: http://localhost:3001 (ä½¿ç”¨ ts-node-dev çƒ­é‡è½½)
pnpm run frontend:dev   # å‰ç«¯: http://localhost:3000 (ä½¿ç”¨ Vite)
```

### æ„å»ºå’Œæµ‹è¯•
```bash
# æ„å»º
pnpm run build          # æ„å»ºå‰åç«¯ï¼ˆè‡ªåŠ¨å®‰è£…ä¾èµ–ï¼‰
pnpm run backend:build  # ä»…æ„å»ºåç«¯ (tsc)
pnpm run frontend:build # ä»…æ„å»ºå‰ç«¯ (tsc && vite build)

# æµ‹è¯•
pnpm test               # è¿è¡Œæ‰€æœ‰æµ‹è¯•
pnpm run backend:test   # åç«¯æµ‹è¯• (jest --runInBand)
pnpm run frontend:test  # å‰ç«¯æµ‹è¯•ï¼ˆvitestï¼‰
pnpm run test:e2e       # E2Eæµ‹è¯• (playwright)
pnpm run test:e2e:ui    # E2Eæµ‹è¯•UIæ¨¡å¼

# ä»£ç è´¨é‡
pnpm run lint               # æ£€æŸ¥å‰åç«¯ä»£ç 
pnpm run lint:fix           # ä¿®å¤å‰åç«¯ä»£ç é—®é¢˜
pnpm run backend:lint       # ä»…åç«¯ä»£ç æ£€æŸ¥
pnpm run backend:lint:fix   # ä»…åç«¯ä»£ç ä¿®å¤
pnpm run frontend:lint      # ä»…å‰ç«¯ä»£ç æ£€æŸ¥
pnpm run frontend:lint:fix  # ä»…å‰ç«¯ä»£ç ä¿®å¤
pnpm run type-check         # å‰ç«¯ TypeScript ç±»å‹æ£€æŸ¥
```

### æ•°æ®åº“æ“ä½œ
```bash
# è¿è¡Œæ•°æ®åº“è¿ç§»
pnpm run migrate:up         # æ‰§è¡Œè¿ç§»
pnpm run migrate:down       # å›æ»šè¿ç§»
pnpm run migrate:status     # æŸ¥çœ‹è¿ç§»çŠ¶æ€

# éªŒè¯é…ç½®å’Œç¯å¢ƒ
pnpm run validate:env       # éªŒè¯ç¯å¢ƒå˜é‡
pnpm run validate-config    # éªŒè¯æ™ºèƒ½ä½“é…ç½®
```

### ç”Ÿäº§éƒ¨ç½²
```bash
pnpm run build        # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
pnpm start           # å¯åŠ¨åç«¯æœåŠ¡ (node dist/index.js)
```

## ğŸ¯ æ ¸å¿ƒæ¶æ„æ¦‚å¿µ

### 1. æ™ºèƒ½ä½“ç³»ç»Ÿ (Multi-Agent Architecture)

- **æ™ºèƒ½ä½“é…ç½®**: `config/agents.json` å®šä¹‰æ‰€æœ‰å¯ç”¨çš„ AI æ™ºèƒ½ä½“
- **æ”¯æŒæä¾›å•†**: FastGPTã€OpenAIã€Anthropicã€Difyã€è‡ªå®šä¹‰
- **åŠ¨æ€åˆ‡æ¢**: ç”¨æˆ·å¯ä»¥åœ¨ä¸åŒæ™ºèƒ½ä½“é—´æ— ç¼åˆ‡æ¢
- **é…ç½®çƒ­é‡è½½**: é€šè¿‡ API `POST /api/agents/reload` æ— éœ€é‡å¯æœåŠ¡

### 2. è®¤è¯ä¸æˆæƒç³»ç»Ÿ

- **JWTè®¤è¯**: ä½¿ç”¨ JWT token è¿›è¡Œç”¨æˆ·è®¤è¯
- **AuthServiceV2**: ç»Ÿä¸€çš„è®¤è¯æœåŠ¡ï¼Œæ”¯æŒå¤šç§è®¤è¯æ–¹å¼
- **ä¸­é—´ä»¶ä¿æŠ¤**: JWTè®¤è¯ä¸­é—´ä»¶å’Œä¿æŠ¤ä¸­é—´ä»¶
- **å®‰å…¨å¢å¼º**: å¯†ç åŠ å¯†ã€é€Ÿç‡é™åˆ¶ã€è¯·æ±‚éªŒè¯

### 3. ä¼šè¯ç®¡ç†ç³»ç»Ÿ

```typescript
// æ•°æ®åº“ä¸­çš„ä¼šè¯å­˜å‚¨ç»“æ„
{
  id: string,              // UUID
  title: string,           // ä¼šè¯æ ‡é¢˜
  agentId: string,         // å…³è”çš„æ™ºèƒ½ä½“ID
  userId?: string,         // ç”¨æˆ·IDï¼ˆå¯é€‰ï¼‰
  messages: ChatMessage[], // æ¶ˆæ¯æ•°ç»„
  createdAt: Date,
  updatedAt: Date
}

// å‰ç«¯æœ¬åœ°å­˜å‚¨æ ¼å¼ï¼ˆç®€åŒ–ï¼‰
{
  conversations: {
    [agentId: string]: Array<{
      id: string;
      title: string;
      agentId: string;
      messages: Array<{'AI': string, 'HUMAN': string}>;
      createdAt: Date;
      updatedAt: Date;
    }>
  }
}
```

### 4. æ¶ˆæ¯æ ¼å¼ä¸æµå¼å“åº”

- **æ ¼å¼è½¬æ¢**: å‰ç«¯ç®€åŒ–æ ¼å¼ `{'AI': string, 'HUMAN': string}` ä¸åç«¯æ ‡å‡†æ ¼å¼ `{role: string, content: string}` ä¹‹é—´çš„è½¬æ¢
- **SSEæµå¼å“åº”**: æ”¯æŒ Server-Sent Eventsï¼Œå®æ—¶æ˜¾ç¤ºAIå›å¤
- **å¤šæä¾›å•†é€‚é…**: ç»Ÿä¸€çš„æ¥å£é€‚é…ä¸åŒAIæä¾›å•†çš„å“åº”æ ¼å¼

### 5. ä¸»é¢˜ç³»ç»Ÿ

- **ä¸‰ç§æ¨¡å¼**: äº®è‰²/æš—è‰²/è‡ªåŠ¨
- **è‡ªåŠ¨åˆ‡æ¢**: åŸºäºæ—¶é—´ schedule (06:00-18:00 äº®è‰²ï¼Œå…¶ä½™æš—è‰²)
- **æŒä¹…åŒ–**: ç”¨æˆ·åå¥½ä¿å­˜åˆ° localStorage

## ğŸ”§ API ç«¯ç‚¹

### è®¤è¯ç›¸å…³
- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/auth/refresh` - åˆ·æ–°token
- `POST /api/auth/logout` - ç”¨æˆ·ç™»å‡º

### æ™ºèƒ½ä½“ç®¡ç†
- `GET /api/agents` - è·å–å¯ç”¨æ™ºèƒ½ä½“åˆ—è¡¨
- `GET /api/agents/:id` - è·å–ç‰¹å®šæ™ºèƒ½ä½“ä¿¡æ¯
- `GET /api/agents/:id/status` - æ£€æŸ¥æ™ºèƒ½ä½“çŠ¶æ€
- `POST /api/agents/reload` - é‡æ–°åŠ è½½æ™ºèƒ½ä½“é…ç½®
- `GET /api/agents/:id/validate` - éªŒè¯æ™ºèƒ½ä½“é…ç½®

### èŠå¤©ä»£ç†
- `POST /api/chat/completions` - å‘é€èŠå¤©è¯·æ±‚ (æ”¯æŒæµå¼å’Œéæµå¼)
- `GET /api/chat/history/:sessionId` - è·å–èŠå¤©å†å²
- `POST /api/chat/save` - ä¿å­˜èŠå¤©è®°å½•

### ç®¡ç†åå°
- `GET /api/admin/stats` - è·å–ç»Ÿè®¡æ•°æ®
- `GET /api/admin/audit` - è·å–å®¡è®¡æ—¥å¿—
- `POST /api/admin/migrate` - æ‰§è¡Œæ•°æ®åº“è¿ç§»

## ğŸ“ ä»£ç è§„èŒƒå’Œæ³¨æ„äº‹é¡¹

### TypeScript é…ç½®
**åç«¯** (`backend/tsconfig.json`):
- ä¸¥æ ¼æ¨¡å¼: `strict: true` + é¢å¤–çš„ä¸¥æ ¼æ£€æŸ¥ï¼ˆ`exactOptionalPropertyTypes`, `noUncheckedIndexedAccess`ï¼‰
- è·¯å¾„åˆ«å: `@/*` æ˜ å°„åˆ° `src/*`ï¼Œæ”¯æŒ `@/types`, `@/services` ç­‰
- è¾“å‡ºç›®å½•: `dist/`ï¼Œä½¿ç”¨ CommonJS æ¨¡å—ç³»ç»Ÿ
- éœ€è¦ `tsconfig-paths/register` åœ¨è¿è¡Œæ—¶è§£æè·¯å¾„åˆ«å

**å‰ç«¯** (`frontend/tsconfig.json`):
- ä¸¥æ ¼æ¨¡å¼: `strict: true` + `noUnusedLocals`, `noUnusedParameters`
- è·¯å¾„åˆ«å: `@/*` æ˜ å°„åˆ° `src/*`ï¼Œæ”¯æŒ `@/components`, `@/hooks` ç­‰
- JSX: `react-jsx` æ¨¡å¼ï¼Œæ— éœ€å¯¼å…¥ React
- æ¨¡å—è§£æ: `bundler` æ¨¡å¼ï¼ˆVite ç‰¹æœ‰ï¼‰

### åŒ…ç®¡ç†å™¨å·¥ä½œåŒº
- **æ ¹ç›®å½•**: ç»Ÿä¸€çš„å·¥ä½œåŒºé…ç½®ï¼Œç®¡ç†æ‰€æœ‰ä¾èµ–
- **shared-types**: å‰åç«¯å…±äº«çš„ç±»å‹å®šä¹‰
- **ä¾èµ–ç­–ç•¥**: ä¼˜å…ˆä½¿ç”¨ pnpm workspaceï¼Œé¿å…é‡å¤å®‰è£…

### æ•°æ®åº“æ¶æ„
- **PostgreSQL**: ä¸»æ•°æ®åº“ï¼Œå­˜å‚¨ç”¨æˆ·ã€ä¼šè¯ã€æ¶ˆæ¯ç­‰
- **MongoDB**: å¯é€‰ï¼Œç”¨äºæ—¥å¿—å­˜å‚¨å’Œåˆ†æ
- **Redis**: ç¼“å­˜å’Œä¼šè¯å­˜å‚¨
- **è¿ç§»ç³»ç»Ÿ**: åŸºäºSQLæ–‡ä»¶çš„ç‰ˆæœ¬æ§åˆ¶è¿ç§»

### é”™è¯¯å¤„ç†
- **ç»Ÿä¸€é”™è¯¯æ ¼å¼**: `ApiError` æ¥å£ï¼ŒåŒ…å«é”™è¯¯ä»£ç ã€æ¶ˆæ¯ã€è¯¦æƒ…
- **è‡ªå®šä¹‰é”™è¯¯ç±»å‹**: `ValidationError`, `ResourceError`, `ExternalServiceError`
- **é”™è¯¯è¾¹ç•Œ**: å‰ç«¯Reacté”™è¯¯è¾¹ç•Œå’Œå…¨å±€é”™è¯¯å¤„ç†
- **æ—¥å¿—ç³»ç»Ÿ**: Winstonæ—¥å¿—è®°å½•ï¼Œæ”¯æŒæ–‡ä»¶è½®è½¬

### å®‰å…¨æªæ–½
- **JWTè®¤è¯**: å®‰å…¨çš„tokenè®¤è¯æœºåˆ¶
- **é€Ÿç‡é™åˆ¶**: åŸºäºIPå’Œç”¨æˆ·çš„è¯·æ±‚é™åˆ¶
- **è¾“å…¥éªŒè¯**: JoiéªŒè¯schema
- **ä¿æŠ¤ä¸­é—´ä»¶**: é˜²æ­¢æ¶æ„è¯·æ±‚å’Œæ»¥ç”¨
- **ç¯å¢ƒå˜é‡**: æ•æ„Ÿä¿¡æ¯é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†

## ğŸš¨ ä¼ä¸šçº§ä»£ç å®‰å…¨å‡†åˆ™

### âš ï¸ ä¸¥æ ¼ç¦æ­¢çš„å±é™©æ“ä½œ
- **ç¦æ­¢ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢ä»£ç ** - ç»å¯¹ç¦æ­¢ä½¿ç”¨ `.replace(/regex/, replacement)` ä¿®æ”¹æºä»£ç 
- **ç¦æ­¢åŠ¨æ€æ„é€ æ­£åˆ™è¡¨è¾¾å¼** - ç»å¯¹ç¦æ­¢ `new RegExp(userInput)` ç”¨äºä»£ç å¤„ç†
- **ç¦æ­¢ä½¿ç”¨sed/awkè¿›è¡Œä»£ç ä¿®æ”¹** - ç»å¯¹ç¦æ­¢ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·ä¿®æ”¹ä»£ç æ–‡ä»¶
- **ç¦æ­¢ä½¿ç”¨å­—ç¬¦ä¸²æ›¿æ¢ä¿®æ”¹ç»“æ„åŒ–æ•°æ®** - å¿…é¡»ä½¿ç”¨ä¸“é—¨çš„è§£æå™¨
- **ç¦æ­¢ä¼ä¸šçº§è‡ªåŠ¨ä¿®å¤** - æ‰€æœ‰ä¿®å¤å¿…é¡»ç»è¿‡å½±å“åˆ†æå’Œäººå·¥ç¡®è®¤

### âœ… ä¼ä¸šçº§å®‰å…¨æ›¿ä»£æ–¹æ¡ˆ
- **ASTä¼˜å…ˆä¿®å¤**: ä½¿ç”¨TypeScriptç¼–è¯‘å™¨APIè¿›è¡Œç²¾ç¡®çš„ASTæ“ä½œ
- **ç±»å‹å®‰å…¨ä¿®å¤**: ä½¿ç”¨ä¸“é—¨çš„ç±»å‹æ£€æŸ¥å’Œä¿®å¤å·¥å…·
- **é…ç½®æ–‡ä»¶**: ä½¿ç”¨ä¸“é—¨çš„é…ç½®è§£æåº“ï¼ˆå¦‚dotenvã€configç­‰ï¼‰
- **ä»£ç é‡æ„**: ä½¿ç”¨ä¼ä¸šçº§ASTè§£æå™¨è¿›è¡Œä»£ç å˜æ¢
- **æ–‡æœ¬å¤„ç†**: ä»…é™ç”¨äºæ—¥å¿—å¤„ç†å’Œæ•°æ®æ¸…ç†ï¼Œä¸ç”¨äºä»£ç ä¿®æ”¹

### ğŸ”’ ä¼ä¸šçº§å®‰å…¨æ£€æŸ¥æœºåˆ¶
é¡¹ç›®é›†æˆäº†å¤šå±‚å®‰å…¨æ£€æŸ¥ï¼š
1. `pnpm run security:audit` - å…¨é¢å®‰å…¨å®¡è®¡
2. `pnpm run security:check` - æäº¤å‰å®‰å…¨æ£€æŸ¥
3. `pnpm run enterprise:fix` - ä¼ä¸šçº§å®‰å…¨ä»£ç ä¿®å¤å·¥å…·
4. Pre-commit hooksè‡ªåŠ¨é˜»æ­¢å±é™©ä»£ç æäº¤
5. ä¼ä¸šçº§ä¿®å¤å½±å“åˆ†æå’Œé£é™©æ§åˆ¶
6. åŸå­æ“ä½œå’Œ100%å›æ»šæœºåˆ¶

### ğŸ¢ ä¼ä¸šçº§ä¿®å¤å·¥å…·
```bash
# ä¼ä¸šçº§å®‰å…¨ä¿®å¤ï¼ˆæ¨èï¼‰
pnpm run enterprise:fix              # ä¼ä¸šçº§ä¿®å¤å·¥å…·ï¼ˆdry-runæ¨¡å¼ï¼‰
pnpm run enterprise:fix --mode fix     # äº¤äº’å¼ä¿®å¤æ¨¡å¼
pnpm run enterprise:fix --config custom.json  # ä½¿ç”¨è‡ªå®šä¹‰é…ç½®
```

### ğŸ“Š ä¿®å¤å½±å“åˆ†æ
æ¯ä¸ªä¿®å¤éƒ½åŒ…å«å®Œæ•´çš„å½±å“åˆ†æï¼š
- **è¯­ä¹‰å˜åŒ–**: none | minor | major
- **æ€§èƒ½å½±å“**: none | low | medium | high
- **å¯è¯»æ€§å˜åŒ–**: none | positive | negative
- **ç ´åé£é™©**: none | low | medium | high
- **ç½®ä¿¡åº¦**: 0-100%
- **å˜åŒ–æè¿°**: è¯¦ç»†çš„ä¿®å¤è¯´æ˜

### ğŸ›¡ï¸ å®‰å…¨é…ç½®åŸåˆ™
- é¦–æ¬¡è¿è¡Œå¿…é¡»ä½¿ç”¨ `dry-run` æ¨¡å¼
- é«˜é£é™©é—®é¢˜ï¼ˆerrorï¼‰é»˜è®¤å¿…é¡»äººå·¥ç¡®è®¤
- ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ `auto-fix` æ¨¡å¼
- æ‰€æœ‰ä¿®å¤éƒ½æœ‰å®Œæ•´çš„å¤‡ä»½å’Œå›æ»šæœºåˆ¶
- ä¿®å¤å‰åè¿›è¡Œè¯­æ³•å’Œç±»å‹éªŒè¯
- é™åˆ¶æ–‡ä»¶å¤§å°å’Œå†…å­˜ä½¿ç”¨é˜²æ­¢ç³»ç»Ÿè¿‡è½½

## ğŸ” è°ƒè¯•å’Œå¼€å‘

### å¿«é€Ÿè°ƒè¯•å‘½ä»¤
```bash
# æ£€æŸ¥é¡¹ç›®çŠ¶æ€
git status                    # Git ä»“åº“çŠ¶æ€
pnpm run type-check          # TypeScript ç±»å‹æ£€æŸ¥
pnpm run lint                # ä»£ç è´¨é‡æ£€æŸ¥

# æ£€æŸ¥æ„å»ºäº§ç‰©
ls -la backend/dist/         # åç«¯æ„å»ºè¾“å‡º
ls -la frontend/dist/        # å‰ç«¯æ„å»ºè¾“å‡º

# æ£€æŸ¥é…ç½®
cat backend/.env             # åç«¯ç¯å¢ƒå˜é‡
cat config/agents.json       # æ™ºèƒ½ä½“é…ç½®

# æµ‹è¯• API ç«¯ç‚¹
curl http://localhost:3001/health                # å¥åº·æ£€æŸ¥
curl http://localhost:3001/api/agents            # è·å–æ™ºèƒ½ä½“åˆ—è¡¨

# æ•°æ®åº“æ“ä½œ
pnpm run migrate:status      # æŸ¥çœ‹è¿ç§»çŠ¶æ€
pnpm run validate:env        # éªŒè¯ç¯å¢ƒå˜é‡
```

### å¼€å‘æ³¨æ„äº‹é¡¹

**é…ç½®çƒ­é‡è½½**:
- åç«¯ä½¿ç”¨ `ts-node-dev` è‡ªåŠ¨é‡è½½ä»£ç å˜æ›´
- ä¿®æ”¹ `config/agents.json` åè°ƒç”¨ `POST /api/agents/reload` çƒ­é‡è½½
- å‰ç«¯ Vite è‡ªåŠ¨çƒ­æ›´æ–° (HMR)

**è·¯å¾„åˆ«åä½¿ç”¨**:
- åç«¯: ä½¿ç”¨ `@/` å‰ç¼€å¯¼å…¥ï¼Œå¦‚ `import { AgentService } from '@/services/AgentService'`
- å‰ç«¯: ä½¿ç”¨ `@/` å‰ç¼€å¯¼å…¥ï¼Œå¦‚ `import { Button } from '@/components/ui/Button'`
- è¿è¡Œæ—¶éœ€è¦ `tsconfig-paths/register`ï¼ˆåç«¯å·²é…ç½®åœ¨ dev è„šæœ¬ä¸­ï¼‰

**æ•°æ®åº“è°ƒè¯•**:
- è¿ç§»æ–‡ä»¶ä½ç½®: `backend/src/migrations/`
- æ•°æ®åº“è¿æ¥é…ç½®åœ¨ `backend/.env`
- ä½¿ç”¨ `pnpm run migrate:status` æ£€æŸ¥è¿ç§»çŠ¶æ€

**çŠ¶æ€ç®¡ç†è°ƒè¯•**:
- çŠ¶æ€ç‰ˆæœ¬: åœ¨ `chatStore.ts` ä¸­å®šä¹‰ï¼Œç‰ˆæœ¬ä¸åŒ¹é…æ—¶ä¼šæ¸…é™¤æ—§æ•°æ®
- æŒä¹…åŒ–é”®: `llmchat-store` (localStorage)
- æ¸…é™¤çŠ¶æ€: åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œ `localStorage.removeItem('llmchat-store')`

**è·¨åŸŸå’Œä»£ç†**:
- å¼€å‘ç¯å¢ƒ: å‰ç«¯ Vite é…ç½®ä»£ç† `/api -> http://localhost:3001`
- ç”Ÿäº§ç¯å¢ƒ: éœ€è¦é€šè¿‡ Nginx ç­‰åå‘ä»£ç†é…ç½®

### æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä½¿ç”¨

**Console è°ƒè¯•**:
```javascript
// æŸ¥çœ‹ Zustand çŠ¶æ€
window.localStorage.getItem('llmchat-store')

// æ¸…é™¤ä¼šè¯å†å²
localStorage.removeItem('llmchat-store')
```

**Network é¢æ¿**:
- æŸ¥çœ‹ SSE æµå¼å“åº”: è¿‡æ»¤ `/api/chat/completions`
- æ£€æŸ¥äº‹ä»¶æµ: æŸ¥çœ‹ `event:` å’Œ `data:` è¡Œ

**Application é¢æ¿**:
- LocalStorage: æŸ¥çœ‹ `llmchat-store` çš„æŒä¹…åŒ–æ•°æ®
- æ£€æŸ¥ä¼šè¯ç»“æ„: æŒ‰ `agentId` åˆ†ç»„çš„ä¼šè¯å­—å…¸

**React DevTools**:
- ç»„ä»¶æ ‘: æŸ¥çœ‹ç»„ä»¶å±‚çº§å’Œ props
- Profiler: æ€§èƒ½åˆ†æ

## ğŸ› ï¸ æ‰©å±•å’Œç»´æŠ¤æŒ‡å—

### æ·»åŠ æ–°çš„ AI æä¾›å•†

1. **å®ç° Provider ç±»** (`backend/src/services/ChatProxyService.ts`):
   ```typescript
   class NewProviderProxy extends BaseProviderProxy {
     async sendMessage(options: ChatOptions): Promise<ChatResponse> {
       // å®ç°æ ‡å‡†è¯·æ±‚è½¬æ¢
     }

     async sendStreamMessage(
       options: ChatOptions,
       onChunk: (text: string) => void
     ): Promise<void> {
       // å®ç°æµå¼å“åº”å¤„ç†
     }
   }
   ```

2. **æ›´æ–°ç±»å‹å®šä¹‰** (`backend/src/types/agent.ts`):
   ```typescript
   export type ProviderType = 'fastgpt' | 'openai' | 'anthropic' | 'dify' | 'new-provider';
   ```

3. **é…ç½®æ™ºèƒ½ä½“** (`config/agents.json`):
   ```json
   {
     "id": "new-agent",
     "provider": "new-provider",
     "endpoint": "https://api.newprovider.com/v1/chat",
     "apiKey": "sk-...",
     "features": {
       "supportsStream": true,
       "supportsFiles": true,
       "supportsImages": false
     }
   }
   ```

### æ•°æ®åº“è¿ç§»

**åˆ›å»ºæ–°è¿ç§»**:
```bash
# 1. åˆ›å»ºæ–°çš„è¿ç§»æ–‡ä»¶
echo "-- æ–°è¿ç§»æ–‡ä»¶" > backend/src/migrations/XXX_new_table.sql

# 2. ç¼–å†™è¿ç§»SQL
# åœ¨æ–°æ–‡ä»¶ä¸­ç¼–å†™ UP å’Œ DOWN SQLè¯­å¥

# 3. æ‰§è¡Œè¿ç§»
pnpm run migrate:up
```

**è¿ç§»æ–‡ä»¶æ ¼å¼**:
```sql
-- åˆ›å»ºç”¨æˆ·è¡¨
CREATE TABLE IF NOT EXISTS users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- æ·»åŠ ç´¢å¼•
CREATE INDEX idx_users_email ON users(email);
```

### è‡ªå®šä¹‰ä¸»é¢˜

1. **ä¿®æ”¹ Tailwind é…ç½®** (`frontend/tailwind.config.js`):
   ```javascript
   theme: {
     extend: {
       colors: {
         primary: { /* è‡ªå®šä¹‰é¢œè‰² */ }
       }
     }
   }
   ```

2. **æ›´æ–°ä¸»é¢˜ Provider** (`frontend/src/components/theme/ThemeProvider.tsx`):
   ```typescript
   // ä¿®æ”¹è‡ªåŠ¨åˆ‡æ¢æ—¶é—´
   const schedule = {
     light: { start: 6, end: 18 },  // è°ƒæ•´ä¸ºè‡ªå®šä¹‰æ—¶é—´æ®µ
     dark: { start: 18, end: 6 }
   };
   ```

3. **æ‰©å±•ä¸»é¢˜ç±»å‹** (`frontend/src/types/index.ts`):
   ```typescript
   export type ThemeMode = 'light' | 'dark' | 'auto' | 'custom';
   ```

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

**æ¶ˆæ¯åˆ—è¡¨ä¼˜åŒ–**:
- ä½¿ç”¨ `react-window` æˆ– `react-virtualized` è™šæ‹ŸåŒ–é•¿åˆ—è¡¨
- æ‡’åŠ è½½å†å²æ¶ˆæ¯ï¼ˆæŒ‰éœ€åŠ è½½æ—§ä¼šè¯ï¼‰

**æ™ºèƒ½ä½“é…ç½®ç¼“å­˜**:
- åç«¯: ä½¿ç”¨ Redis ç¼“å­˜æ™ºèƒ½ä½“é…ç½®ï¼Œé¿å…é¢‘ç¹è¯»å– JSON æ–‡ä»¶
- å‰ç«¯: ä½¿ç”¨ `useMemo` ç¼“å­˜æ™ºèƒ½ä½“åˆ—è¡¨

**æµå¼å“åº”ä¼˜åŒ–**:
- å®ç°æ–‡æœ¬åˆ†å—æ¸²æŸ“ï¼ˆé¿å…æ¯ä¸ªå­—ç¬¦éƒ½è§¦å‘é‡æ¸²æŸ“ï¼‰
- ä½¿ç”¨ `requestAnimationFrame` æ‰¹é‡æ›´æ–° UI

**æ„å»ºä¼˜åŒ–**:
- å‰ç«¯: ä»£ç åˆ†å‰²ï¼ˆæŒ‰è·¯ç”±ï¼‰ã€Tree shaking
- åç«¯: ç”Ÿäº§æ„å»ºç§»é™¤ source map

## ğŸ”§ å¸¸è§é—®é¢˜æ’æŸ¥

### ğŸ”’ å®‰å…¨ç›¸å…³é—®é¢˜

**é—®é¢˜**: JWTè®¤è¯å¤±è´¥ï¼Œæç¤º"æ— æ•ˆçš„è®¤è¯ä»¤ç‰Œ"
```bash
# æ£€æŸ¥JWTé…ç½®
echo $TOKEN_SECRET

# éªŒè¯å¯†é’¥é•¿åº¦ï¼ˆè‡³å°‘32å­—ç¬¦ï¼‰
echo ${#TOKEN_SECRET}

# æ£€æŸ¥JWTæ ¼å¼
node -e "const { SecureJWT } = require('./dist/utils/secureJwt'); try { const config = SecureJWT.getConfig(); console.log('JWTé…ç½®æœ‰æ•ˆ'); } catch(e) { console.error('JWTé…ç½®é”™è¯¯:', e.message); }"
```

**é—®é¢˜**: æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥åŠ å¯†é…ç½®
echo $CREDENTIALS_SALT

# éªŒè¯ç¯å¢ƒå˜é‡
pnpm run validate:env

# æ£€æŸ¥æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²æ ¼å¼ï¼ˆå¯†ç å°†è¢«è‡ªåŠ¨è„±æ•ï¼‰
echo $DATABASE_URL | node -e "const { LogSanitizer } = require('./dist/utils/logSanitizer'); console.log('è¿æ¥å­—ç¬¦ä¸²:', LogSanitizer.maskConnectionString(require('fs').readFileSync(0, 'utf8').trim()));"
```

**é—®é¢˜**: æ–‡ä»¶ä¸Šä¼ è¢«æ‹’ç»
```bash
# æ£€æŸ¥æ–‡ä»¶å¤§å°é™åˆ¶
# CADæ–‡ä»¶é™åˆ¶ï¼š10MB

# éªŒè¯æ–‡ä»¶ç±»å‹
# åªå…è®¸.dxfæ–‡ä»¶

# æ£€æŸ¥ç”¨æˆ·è®¤è¯
# æ‰€æœ‰CADç«¯ç‚¹ç°åœ¨éœ€è¦JWTè®¤è¯
```

**é—®é¢˜**: å¯†ç é‡ç½®å¤±è´¥
```bash
# ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„å¯†ç å“ˆå¸Œ
# ç³»ç»Ÿç°åœ¨ä½¿ç”¨SHA-256åŠ ç›å“ˆå¸Œ

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
# å¯†ç é‡ç½®éœ€è¦æ•°æ®åº“è®¿é—®æƒé™
```

**é—®é¢˜**: æ—¥å¿—ä¸­å‡ºç°æ•æ„Ÿä¿¡æ¯
```bash
# æ£€æŸ¥æ—¥å¿—è„±æ•æ˜¯å¦æ­£å¸¸å·¥ä½œ
# å¯†ç ã€ä»¤ç‰Œã€APIå¯†é’¥åº”è¯¥è¢«è‡ªåŠ¨å±è”½

# éªŒè¯å®‰å…¨æ—¥å¿—è®°å½•
grep -i "password\|token\|secret" logs/app.log | head -5
# åº”è¯¥çœ‹åˆ°è„±æ•åçš„æ—¥å¿—ï¼Œå¦‚ï¼š****æˆ– token***
```

### ç¼–è¯‘å’Œç±»å‹é”™è¯¯

**é—®é¢˜**: `Cannot find module '@/...'` æˆ–è·¯å¾„åˆ«åæ— æ³•è§£æ
```bash
# è§£å†³æ–¹æ¡ˆ
# 1. ç¡®è®¤ tsconfig.json ä¸­ baseUrl å’Œ paths é…ç½®æ­£ç¡®
# 2. åç«¯: ç¡®ä¿ä½¿ç”¨ tsconfig-paths/register
pnpm run backend:dev  # å·²é…ç½® -r tsconfig-paths/register

# 3. å‰ç«¯: Vite éœ€è¦åœ¨ vite.config.ts ä¸­é…ç½® resolve.alias
# å·²é…ç½®ï¼Œå¦‚æœ‰é—®é¢˜æ£€æŸ¥ vite.config.ts
```

**é—®é¢˜**: TypeScript ä¸¥æ ¼æ¨¡å¼é”™è¯¯ï¼ˆ`exactOptionalPropertyTypes` ç­‰ï¼‰
```bash
# åç«¯ä½¿ç”¨äº†é¢å¤–çš„ä¸¥æ ¼æ£€æŸ¥
# æ³¨æ„å¯é€‰å±æ€§ä¸èƒ½è®¾ç½®ä¸º undefinedï¼Œåº”è¯¥çœç•¥æˆ–è®¾ç½®ä¸ºå…·ä½“å€¼

# é”™è¯¯ç¤ºä¾‹
const config: Config = { optional: undefined };  // âŒ

# æ­£ç¡®ç¤ºä¾‹
const config: Config = {};  // âœ… çœç•¥å¯é€‰å±æ€§
```

### è¿è¡Œæ—¶é”™è¯¯

**é—®é¢˜**: åç«¯å¯åŠ¨å¤±è´¥ - "Cannot find module"
```bash
# æ£€æŸ¥ä¾èµ–æ˜¯å¦å®‰è£…
pnpm install

# æ£€æŸ¥ tsconfig-paths æ˜¯å¦æ³¨å†Œ
pnpm run backend:dev  # ç¡®ä¿ä½¿ç”¨é¡¹ç›®è„šæœ¬
```

**é—®é¢˜**: æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# 1. æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
cat backend/.env | grep DATABASE

# 2. éªŒè¯æ•°æ®åº“è¿æ¥
pnpm run validate:env

# 3. æ£€æŸ¥æ•°æ®åº“è¿ç§»çŠ¶æ€
pnpm run migrate:status
```

**é—®é¢˜**: å‰ç«¯ API è°ƒç”¨ 404 æˆ– CORS é”™è¯¯
```bash
# 1. æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
curl http://localhost:3001/health

# 2. æ£€æŸ¥å‰ç«¯ä»£ç†é…ç½®
# vite.config.ts ä¸­ç¡®è®¤ proxy è®¾ç½®ä¸º http://localhost:3001

# 3. ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥ CORS é…ç½®
# backend/.env ä¸­è®¾ç½®æ­£ç¡®çš„ FRONTEND_URL
```

**é—®é¢˜**: SSE æµå¼å“åº”å¡ä½æˆ–ä¸­æ–­
```bash
# 1. æ£€æŸ¥æ˜¯å¦å¯ç”¨äº†å‹ç¼©ï¼ˆåº”è¯¥ç¦ç”¨ï¼‰
# backend/src/index.ts å·²é’ˆå¯¹ SSE ç«¯ç‚¹ç¦ç”¨å‹ç¼©

# 2. æ£€æŸ¥åå‘ä»£ç†é…ç½®ï¼ˆNginxï¼‰
# éœ€è¦ç¦ç”¨ gzip å’Œç¼“å†²
location /api/chat/completions {
    proxy_buffering off;
    proxy_cache off;
    gzip off;
}

# 3. æµè§ˆå™¨ç½‘ç»œé¢æ¿æ£€æŸ¥äº‹ä»¶æµ
# ç¡®è®¤æ”¶åˆ° event: chunk å’Œ event: end
```

### é…ç½®å’Œç¯å¢ƒé—®é¢˜

**é—®é¢˜**: æ™ºèƒ½ä½“é…ç½®æ— æ³•åŠ è½½
```bash
# 1. æ£€æŸ¥é…ç½®æ–‡ä»¶è·¯å¾„
cat config/agents.json

# 2. éªŒè¯ JSON æ ¼å¼
npx jsonlint config/agents.json

# 3. çƒ­é‡è½½é…ç½®
curl -X POST http://localhost:3001/api/agents/reload

# 4. æ£€æŸ¥åç«¯æ—¥å¿—
pnpm run backend:dev  # æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º
```

**é—®é¢˜**: ç¯å¢ƒå˜é‡æœªç”Ÿæ•ˆ
```bash
# 1. ç¡®è®¤ .env æ–‡ä»¶ä½ç½®
ls backend/.env

# 2. æ£€æŸ¥ NODE_ENV è®¾ç½®
echo $NODE_ENV  # æˆ– Windows: echo %NODE_ENV%

# 3. éªŒè¯ç¯å¢ƒå˜é‡
pnpm run validate:env

# 4. é‡å¯æœåŠ¡
pnpm run backend:dev
```

### çŠ¶æ€å’Œå­˜å‚¨é—®é¢˜

**é—®é¢˜**: ä¼šè¯å†å²ä¸¢å¤±æˆ–çŠ¶æ€æ··ä¹±
```javascript
// æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ

// 1. æ£€æŸ¥å½“å‰å­˜å‚¨ç»“æ„
console.log(JSON.parse(localStorage.getItem('llmchat-store')));

// 2. æ£€æŸ¥ç‰ˆæœ¬å·
const store = JSON.parse(localStorage.getItem('llmchat-store'));
console.log('Store version:', store?.state?.version);

// 3. æ¸…é™¤å¹¶é‡ç½®ï¼ˆè°¨æ…æ“ä½œï¼‰
localStorage.removeItem('llmchat-store');
location.reload();
```

**é—®é¢˜**: åˆ‡æ¢æ™ºèƒ½ä½“åä¼šè¯æœªæ›´æ–°
```bash
# æ£€æŸ¥ chatStore.ts ä¸­çš„ selectAgent é€»è¾‘
# ç¡®è®¤æŒ‰ agentId æ­£ç¡®è·å–ä¼šè¯åˆ—è¡¨
```

### æ€§èƒ½é—®é¢˜

**é—®é¢˜**: å‰ç«¯æ¸²æŸ“å¡é¡¿
```bash
# 1. ä½¿ç”¨ React DevTools Profiler åˆ†æ
# 2. æ£€æŸ¥æ˜¯å¦æœ‰è¿‡å¤šçš„é‡æ¸²æŸ“
# 3. è€ƒè™‘æ¶ˆæ¯åˆ—è¡¨è™šæ‹ŸåŒ–ï¼ˆå¤§é‡æ¶ˆæ¯æ—¶ï¼‰
```

**é—®é¢˜**: åç«¯å“åº”æ…¢
```bash
# 1. æ£€æŸ¥é€Ÿç‡é™åˆ¶é…ç½®
# backend/.env ä¸­çš„ RATE_LIMIT_* å‚æ•°

# 2. æ£€æŸ¥å¤–éƒ¨ API è°ƒç”¨å»¶è¿Ÿ
# æŸ¥çœ‹åç«¯æ—¥å¿—ä¸­çš„è¯·æ±‚æ—¶é—´

# 3. è€ƒè™‘å¢åŠ è¯·æ±‚è¶…æ—¶
# REQUEST_TIMEOUT=30000 (30ç§’)
```

## ğŸ“Š ECharts åœ°å›¾é…ç½®

### ä¸­å›½åœ°å›¾æ•°æ®
é¡¹ç›®ä½¿ç”¨åŠ¨æ€åŠ è½½çš„æ–¹å¼åŠ è½½ä¸­å›½åœ°å›¾ GeoJSON æ•°æ®:

**æ•°æ®ä½ç½®**: `frontend/public/maps/china.json`
**æ•°æ®æ¥æº**: é˜¿é‡Œäº‘ DataV (https://geo.datav.aliyun.com/areas_v3/bound/100000_full.json)

**åŠ è½½æ–¹å¼**:
```typescript
// frontend/src/components/admin/AdminHome.tsx
fetch('/maps/china.json')
  .then(res => res.json())
  .then(chinaMap => {
    echarts.registerMap('china', chinaMap);
  });
```

**æ³¨æ„äº‹é¡¹**:
- æ–°ç‰ˆ echarts (5.x+) ä¸å†å†…ç½®åœ°å›¾ JSON æ•°æ®
- åœ°å›¾æ•°æ®éœ€è¦å•ç‹¬ä¸‹è½½å¹¶æ”¾ç½®åœ¨ `public/maps/` ç›®å½•
- å¼€å‘æ—¶ä¿®æ”¹ public ç›®å½•å†…å®¹éœ€è¦é‡å¯ Vite æœåŠ¡å™¨

**æ›´æ–°åœ°å›¾æ•°æ®**:
```bash
# ä¸‹è½½æœ€æ–°çš„ä¸­å›½åœ°å›¾æ•°æ®
curl -L "https://geo.datav.aliyun.com/areas_v3/bound/100000_full.json" -o frontend/public/maps/china.json

# ä¸‹è½½çœçº§åœ°å›¾(ç¤ºä¾‹:å¹¿ä¸œçœ 440000)
curl -L "https://geo.datav.aliyun.com/areas_v3/bound/440000_full.json" -o frontend/public/maps/guangdong.json
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
```bash
# åç«¯å•å…ƒæµ‹è¯•
pnpm run backend:test

# å‰ç«¯å•å…ƒæµ‹è¯•
pnpm run frontend:test

# æµ‹è¯•è¦†ç›–ç‡
pnpm run frontend:test:coverage
```

### E2Eæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰E2Eæµ‹è¯•
pnpm run test:e2e

# äº¤äº’æ¨¡å¼
pnpm run test:e2e:ui

# è°ƒè¯•æ¨¡å¼
pnpm run test:e2e:debug
```

### æµ‹è¯•æ–‡ä»¶ä½ç½®
- åç«¯æµ‹è¯•: `backend/src/__tests__/`
- å‰ç«¯æµ‹è¯•: `frontend/src/test/`
- E2Eæµ‹è¯•: `tests/e2e/`

## ğŸ“± ç”Ÿäº§éƒ¨ç½²

### Docker éƒ¨ç½²
```bash
# æ„å»ºé•œåƒ
docker build -t llmchat .

# è¿è¡Œå®¹å™¨
docker run -p 3001:3001 llmchat
```

### ç¯å¢ƒå˜é‡é…ç½®
ç”Ÿäº§ç¯å¢ƒå¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼š
- `DATABASE_URL`: PostgreSQL è¿æ¥å­—ç¬¦ä¸²
- `JWT_SECRET`: JWT å¯†é’¥
- `REDIS_URL`: Redis è¿æ¥å­—ç¬¦ä¸²ï¼ˆå¯é€‰ï¼‰
- `NODE_ENV`: è®¾ç½®ä¸º `production`

### å¥åº·æ£€æŸ¥
- å¥åº·æ£€æŸ¥ç«¯ç‚¹: `GET /health`
- æ•°æ®åº“è¿æ¥æ£€æŸ¥: `GET /health/db`
- å¤–éƒ¨æœåŠ¡æ£€æŸ¥: `GET /health/external`

## ğŸ”„ é˜¶æ®µæ€§æ‰§è¡Œè§„èŒƒå’Œæœºåˆ¶åŒ–æµç¨‹

### ğŸ“‹ é˜¶æ®µæ€§å¼€å‘æ‰§è¡Œæ ‡å‡†

ä¸ºç¡®ä¿é¡¹ç›®å¼€å‘çš„ç³»ç»Ÿæ€§å’Œä¸€è‡´æ€§ï¼Œå»ºç«‹ä»¥ä¸‹é˜¶æ®µæ€§æ‰§è¡Œæœºåˆ¶ï¼š

#### ğŸ”§ æ‰§è¡Œæµç¨‹æ ‡å‡†åŒ–

**æ¯ä¸ªé˜¶æ®µçš„å®Œæ•´æ‰§è¡Œæµç¨‹**ï¼š
1. **é˜¶æ®µåˆå§‹åŒ–**
   - æ˜ç¡®é˜¶æ®µç›®æ ‡å’ŒèŒƒå›´
   - åˆ¶å®šè¯¦ç»†æ‰§è¡Œè®¡åˆ’
   - é¢„ä¼°æ—¶é—´å’Œèµ„æºéœ€æ±‚

2. **å¼€å‘å®æ–½**
   - æŒ‰æ¨¡å—åŒ–æ–¹å¼å®ç°åŠŸèƒ½
   - ä¿æŒä»£ç è´¨é‡å’Œæµ‹è¯•è¦†ç›–
   - åŠæ—¶è®°å½•æŠ€æœ¯å†³ç­–å’Œå®ç°ç»†èŠ‚

3. **æµ‹è¯•éªŒè¯**
   - è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•å¥—ä»¶
   - è¿›è¡ŒåŠŸèƒ½éªŒè¯å’Œæ€§èƒ½æµ‹è¯•
   - æ£€æŸ¥ä»£ç è´¨é‡å’Œç±»å‹å®‰å…¨

4. **é˜¶æ®µåæ€**
   - æ€»ç»“é˜¶æ®µæˆæœå’Œç»éªŒæ•™è®­
   - è¯†åˆ«é—®é¢˜å’Œæ”¹è¿›æœºä¼š
   - æ›´æ–°æŠ€æœ¯æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—

5. **Gitå·¥ä½œæµ**
   - æ›´æ–°è¿œç¨‹ä¸»åˆ†æ”¯æœ€æ–°ä»£ç 
   - è§£å†³æ‰€æœ‰åˆå¹¶å†²çª
   - æäº¤æ›´æ”¹å¹¶åˆ›å»ºPR
   - åˆå¹¶åˆ°ä¸»åˆ†æ”¯

6. **æ–‡æ¡£æ›´æ–°**
   - æ›´æ–°CLAUDE.mdæ–‡æ¡£
   - è®°å½•é˜¶æ®µæ€§æˆæœ
   - å½¢æˆæ ‡å‡†åŒ–è§„èŒƒ

#### ğŸ¯ è´¨é‡ä¿è¯æœºåˆ¶

**è‡ªåŠ¨æµ‹è¯•æ£€æµ‹**ï¼š
```bash
# 1. æ ¸å¿ƒæ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥
find src -name "*.ts" -type f | head -10

# 2. æ„å»ºçŠ¶æ€éªŒè¯
pnpm run build

# 3. ç±»å‹æ£€æŸ¥
pnpm run type-check

# 4. ä»£ç è´¨é‡æ£€æŸ¥
pnpm run lint

# 5. æµ‹è¯•å¥—ä»¶æ‰§è¡Œ
pnpm test
```

**å¼‚å¸¸å¤„ç†æ ‡å‡†**ï¼š
- âš ï¸ è½»å¾®é—®é¢˜ï¼šè®°å½•ä½†ä¸é˜»æ­¢æµç¨‹
- ğŸš¨ ä¸¥é‡é—®é¢˜ï¼šå¿…é¡»ä¿®å¤åæ‰èƒ½ç»§ç»­
- ğŸ“‹ é—®é¢˜è·Ÿè¸ªï¼šä½¿ç”¨TODOå·¥å…·è®°å½•æ‰€æœ‰å¾…è§£å†³é—®é¢˜

#### ğŸ“Š é˜¶æ®µæ€§æŠ¥å‘Šæ¨¡æ¿

æ¯ä¸ªé˜¶æ®µå®Œæˆåå¿…é¡»ç”ŸæˆåŒ…å«ä»¥ä¸‹å†…å®¹çš„æŠ¥å‘Šï¼š

```markdown
# Phase X.X: [é˜¶æ®µåç§°] - å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ é˜¶æ®µæ¦‚è¿°
[é˜¶æ®µç›®æ ‡å’ŒèƒŒæ™¯è¯´æ˜]

## âœ… å·²å®Œæˆé¡¹ç›®
### 1. [åŠŸèƒ½æ¨¡å—1]
**çŠ¶æ€**: âœ… å®Œæˆ
**å®æ–½å†…å®¹**: [è¯¦ç»†æè¿°]
**æŠ€æœ¯ç»†èŠ‚**: [å…³é”®å®ç°]
**é¢„æœŸæ•ˆæœ**: [æ€§èƒ½/è´¨é‡æå‡]

### 2. [åŠŸèƒ½æ¨¡å—2]
[åŒä¸Šæ ¼å¼]

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½é›†æˆ
[åŠŸèƒ½æ•´åˆè¯´æ˜]

## ğŸ“Š æ€§èƒ½æå‡é¢„æœŸ
| é¡¹ç›® | é¢„æœŸæå‡ | å®ç°çŠ¶æ€ |
|------|---------|---------|

## ğŸ§ª è´¨é‡ä¿è¯
### éªŒè¯ç»“æœ
- âœ… æ ¸å¿ƒåŠŸèƒ½å®Œæ•´æ€§: [æ•°æ®]
- âœ… æµ‹è¯•é€šè¿‡ç‡: [æ•°æ®]
- âœ… æ„å»ºçŠ¶æ€: [çŠ¶æ€]

### æµ‹è¯•çŠ¶æ€
**é€šè¿‡æµ‹è¯•**: [æ•°é‡]/[æ€»æ•°]
**å¾…ä¿®å¤**: [é—®é¢˜æè¿°]

## ğŸš€ æŠ€æœ¯åˆ›æ–°ç‚¹
[åˆ›æ–°å†…å®¹æè¿°]

## ğŸ” å·²çŸ¥é—®é¢˜ä¸é™åˆ¶
[é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ]

## ğŸ“ˆ ä¸‹ä¸€é˜¶æ®µè®¡åˆ’
[åç»­å·¥ä½œå®‰æ’]

## ğŸ’¡ ç»éªŒæ€»ç»“
[å…³é”®ç»éªŒå’Œæ•™è®­]
```

#### ğŸ”„ Gitå·¥ä½œæµæ ‡å‡†åŒ–

**åˆ†æ”¯ç®¡ç†ç­–ç•¥**ï¼š
1. **ä¸»åˆ†æ”¯ä¿æŠ¤**: `main`åˆ†æ”¯å§‹ç»ˆä¿æŒç¨³å®šçŠ¶æ€
2. **åŠŸèƒ½åˆ†æ”¯**: æ¯ä¸ªé˜¶æ®µä½¿ç”¨ç‹¬ç«‹åŠŸèƒ½åˆ†æ”¯
3. **åˆå¹¶ç­–ç•¥**: å…ˆæ›´æ–°è¿œç¨‹ä¸»åˆ†æ”¯ï¼Œå†è§£å†³å†²çªï¼Œæœ€ååˆå¹¶

**æ ‡å‡†åŒ–Gitå‘½ä»¤åºåˆ—**ï¼š
```bash
# 1. å®Œæˆé˜¶æ®µå¼€å‘
git add .
git commit -m "feat: å®ŒæˆPhase X.X [åŠŸèƒ½æè¿°]

# 2. æ¨é€åˆ°è¿œç¨‹åŠŸèƒ½åˆ†æ”¯
git push origin feature/phase-x-x

# 3. åˆ‡æ¢åˆ°ä¸»åˆ†æ”¯
git checkout main

# 4. æ›´æ–°è¿œç¨‹ä¸»åˆ†æ”¯
git pull origin main

# 5. è§£å†³å†²çªï¼ˆå¦‚æœ‰ï¼‰
# [æ‰‹åŠ¨è§£å†³å†²çªæ–‡ä»¶]
git add .
git commit -m "feat: è§£å†³ä¸»åˆ†æ”¯åˆå¹¶å†²çª"

# 6. åˆå¹¶åŠŸèƒ½åˆ†æ”¯
git merge feature/phase-x-x

# 7. æ¨é€åˆ°ä¸»åˆ†æ”¯
git push origin main
```

**å†²çªè§£å†³æ ‡å‡†æµç¨‹**ï¼š
1. ğŸ“‹ è¯†åˆ«å†²çªæ–‡ä»¶å’Œç±»å‹
2. ğŸ” åˆ†æå†²çªåŸå› å’Œå½±å“
3. âš–ï¸ é€‰æ‹©åˆé€‚çš„è§£å†³æ–¹æ¡ˆ
4. âœ… éªŒè¯è§£å†³ç»“æœ
5. ğŸ“ è®°å½•å†²çªè§£å†³è¿‡ç¨‹

#### ğŸ“š æ–‡æ¡£æ›´æ–°æœºåˆ¶

**CLAUDE.mdæ›´æ–°è§„åˆ™**ï¼š
- æ¯ä¸ªé˜¶æ®µå®Œæˆåå¿…é¡»æ›´æ–°
- è®°å½•æ–°åŠŸèƒ½çš„ä½¿ç”¨æ–¹æ³•
- æ›´æ–°é¡¹ç›®æ¶æ„è¯´æ˜
- æ·»åŠ å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ

**æŠ€æœ¯æ–‡æ¡£è¦æ±‚**ï¼š
- ğŸ“ APIæ–‡æ¡£ï¼šä½¿ç”¨Swaggerè‡ªåŠ¨ç”Ÿæˆ
- ğŸ“‹ ç”¨æˆ·æŒ‡å—ï¼šåŒ…å«å®Œæ•´ä½¿ç”¨æµç¨‹
- ğŸ”§ å¼€å‘æ–‡æ¡£ï¼šåŒ…å«æ¶æ„è®¾è®¡å’Œå®ç°ç»†èŠ‚
- ğŸ› æ•…éšœæ’é™¤ï¼šå¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

#### ğŸ¯ æŒç»­æ”¹è¿›æœºåˆ¶

**é˜¶æ®µæ€§åæ€æ ‡å‡†**ï¼š
1. **æˆæœè¯„ä¼°**: ä¸é¢„æœŸç›®æ ‡å¯¹æ¯”åˆ†æ
2. **è¿‡ç¨‹å›é¡¾**: è¯†åˆ«æµç¨‹ä¸­çš„é—®é¢˜å’Œæœºä¼š
3. **æŠ€æœ¯å€ºåŠ¡**: è®°å½•å’Œè§„åˆ’æŠ€æœ¯å€ºåŠ¡å¤„ç†
4. **ç»éªŒæ€»ç»“**: å½¢æˆå¯å¤ç”¨çš„æœ€ä½³å®è·µ

**æœºåˆ¶åŒ–è½å®æªæ–½**ï¼š
- ğŸ“‹ æ£€æŸ¥æ¸…å•ï¼šä¸ºæ¯ä¸ªé˜¶æ®µåˆ›å»ºæ ‡å‡†åŒ–æ£€æŸ¥æ¸…å•
- ğŸ”„ è‡ªåŠ¨åŒ–ï¼šå°†é‡å¤æ€§å·¥ä½œè‡ªåŠ¨åŒ–
- ğŸ“Š æŒ‡æ ‡ç›‘æ§ï¼šå»ºç«‹è´¨é‡æŒ‡æ ‡ç›‘æ§ä½“ç³»
- ğŸ“ çŸ¥è¯†ç®¡ç†ï¼šå»ºç«‹é¡¹ç›®çŸ¥è¯†åº“

#### ğŸš¨ å¼‚å¸¸å¤„ç†æœºåˆ¶

**ä¸¥é‡é—®é¢˜å¤„ç†æµç¨‹**ï¼š
1. âš ï¸ é—®é¢˜è¯†åˆ«ï¼šè‡ªåŠ¨æ£€æµ‹æˆ–æ‰‹åŠ¨å‘ç°
2. ğŸ“Š å½±å“è¯„ä¼°ï¼šè¯„ä¼°é—®é¢˜å¯¹é¡¹ç›®çš„å½±å“
3. ğŸ”§ è§£å†³æ–¹æ¡ˆï¼šåˆ¶å®šå’Œå®æ–½è§£å†³æ–¹æ¡ˆ
4. âœ… éªŒè¯æµ‹è¯•ï¼šç¡®ä¿é—®é¢˜å½»åº•è§£å†³
5. ğŸ“ å¤ç›˜æ€»ç»“ï¼šåˆ†æé—®é¢˜æ ¹æœ¬åŸå› å¹¶é¢„é˜²

**å›æ»šæœºåˆ¶**ï¼š
- ğŸ“¦ ç‰ˆæœ¬æ§åˆ¶ï¼šä½¿ç”¨Gitè¿›è¡Œç‰ˆæœ¬ç®¡ç†
- ğŸ”„ å¿«é€Ÿå›æ»šï¼šæ”¯æŒå¿«é€Ÿå›æ»šåˆ°ç¨³å®šç‰ˆæœ¬
- ğŸ“‹ å½±å“è¯„ä¼°ï¼šè¯„ä¼°å›æ»šå¯¹ç°æœ‰åŠŸèƒ½çš„å½±å“
- âœ… æ¢å¤éªŒè¯ï¼šç¡®ä¿å›æ»šåç³»ç»Ÿæ­£å¸¸å·¥ä½œ

#### ğŸ“ˆ æˆåŠŸæ ‡å‡†é‡åŒ–

**è´¨é‡æŒ‡æ ‡**ï¼š
- ä»£ç è¦†ç›–ç‡ï¼š> 80%
- æµ‹è¯•é€šè¿‡ç‡ï¼š> 95%
- æ„å»ºæˆåŠŸç‡ï¼š100%
- ç±»å‹é”™è¯¯ï¼š0ä¸ª

**æ€§èƒ½æŒ‡æ ‡**ï¼š
- APIå“åº”æ—¶é—´ï¼š< 200ms
- é¡µé¢åŠ è½½æ—¶é—´ï¼š< 3s
- æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–ï¼š20-70%æå‡
- å†…å­˜ä½¿ç”¨ï¼šä¼˜åŒ–20-40%

**æµç¨‹æŒ‡æ ‡**ï¼š
- é˜¶æ®µå®Œæˆå‡†æ—¶ç‡ï¼š> 90%
- å†²çªè§£å†³æ—¶é—´ï¼š< 30åˆ†é’Ÿ
- æ–‡æ¡£æ›´æ–°åŠæ—¶æ€§ï¼š100%
- é—®é¢˜ä¿®å¤å“åº”æ—¶é—´ï¼š< 2å°æ—¶

---

**æ‰§è¡Œè¦æ±‚**ï¼š
- âœ… ä¸¥æ ¼æŒ‰ç…§æ­¤æ ‡å‡†æ‰§è¡Œæ¯ä¸ªé˜¶æ®µ
- âœ… æ‰€æœ‰åç¦»æ ‡å‡†çš„æƒ…å†µéœ€è¦è®°å½•å’Œè¯´æ˜
- âœ… æŒç»­ä¼˜åŒ–å’Œå®Œå–„æ ‡å‡†æµç¨‹
- âœ… ç¡®ä¿å…¨å±€ä¸€è‡´æ€§å’Œå¯é æ€§

## Task Master AI Instructions
**Import Task Master's development workflow commands and guidelines, treat as if import is in the main CLAUDE.md file.**
@./.taskmaster/CLAUDE.md
