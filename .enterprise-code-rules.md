# ğŸ¢ ä¼ä¸šçº§ä»£ç ä¿®å¤è§„åˆ™æ‰‹å†Œ

## ğŸ“‹ é¡¹ç›®ç‰¹å®šè§„åˆ™é…ç½®

### ğŸ”’ æœ¬é¡¹ç›®ä¸¥æ ¼ç¦æ­¢çš„å±é™©æ¨¡å¼
```typescript
// âŒ ä¸¥æ ¼ç¦æ­¢ï¼šæ­£åˆ™è¡¨è¾¾å¼ä»£ç æ›¿æ¢
const content = fileContent.replace(/import\s+.*from\s+['\"](.*)['\"]/, 'import * from $1');
const config = JSON.parse(jsonStr.replace(/\bpassword['\"]?\s*:\s*['\"](.*)['\"]/, 'password: \"***\"'));

// âŒ ä¸¥æ ¼ç¦æ­¢ï¼šåŠ¨æ€æ„é€ æ­£åˆ™è¡¨è¾¾å¼
const regex = new RegExp(userInput, 'g');
const result = text.replace(regex, replacement);

// âŒ ä¸¥æ ¼ç¦æ­¢ï¼šå‘½ä»¤è¡Œæ–‡æœ¬ä¿®æ”¹
execSync(`sed -i 's/old/new/g' ${file}`);

// âŒ ä¸¥æ ¼ç¦æ­¢ï¼šä¼ä¸šçº§è‡ªåŠ¨ä¿®å¤ä¸ç»è¿‡ç¡®è®¤
if (isHighRisk) {
  const fixed = autoFix(code); // ç¦æ­¢
}
```

### âœ… æœ¬é¡¹ç›®æ¨èçš„å®‰å…¨æ¨¡å¼
```typescript
// âœ… æ¨èï¼šASTè§£æå’Œæ“ä½œ
import * as ts from 'typescript';
const sourceFile = ts.createSourceFile(fileName, content, ts.ScriptTarget.Latest);
const ast = ts.factory.createStringLiteral("safe replacement");

// âœ… æ¨èï¼šä¸“é—¨çš„JSONå¤„ç†
const config = JSON.parse(jsonContent);
config.sensitiveField = "***";

// âœ… æ¨èï¼šç±»å‹å®‰å…¨å¤„ç†
interface SafeConfig {
  readonly apiUrl: string;
  readonly maxRetries: number;
}

// âœ… æ¨èï¼šä¼ä¸šçº§ä¿®å¤å·¥å…·
pnpm run enterprise:fix  // dry-runæ¨¡å¼é¢„è§ˆ
pnpm run enterprise:fix --mode fix  // äº¤äº’å¼ä¿®å¤
```

## ğŸ¯ æœ¬é¡¹ç›®ä¼ä¸šçº§ä¿®å¤è§„åˆ™

### 1. React Hookå®‰å…¨è§„åˆ™ (errorçº§åˆ«)
```typescript
// âŒ å±é™©ï¼šHookåœ¨æ¡ä»¶è¯­å¥ä¸­ä½¿ç”¨
if (condition) {
  const [state, setState] = useState(null); // å±é™©
  useEffect(() => {}, [state]); // å¯èƒ½çš„å†…å­˜æ³„æ¼
}

// âœ… å®‰å…¨ï¼šHookåœ¨ç»„ä»¶é¡¶å±‚ä½¿ç”¨
const MyComponent = () => {
  const [state, setState] = useState(null);
  const [data, setData] = useState(null);

  useEffect(() => {
    // å®‰å…¨çš„Hookä½¿ç”¨
  }, [data]); // ä¾èµ–æ•°ç»„æ­£ç¡®
}
```

### 2. Ref.current å®‰å…¨è§„åˆ™ (errorçº§åˆ«)
```typescript
// âŒ å±é™©ï¼šref.currentåœ¨ä¾èµ–æ•°ç»„ä¸­
useEffect(() => {
  fetchData(ref.current.value);
}, [ref.current]); // å±é™©ï¼šå¯èƒ½å¯¼è‡´æ— é™å¾ªç¯

// âœ… å®‰å…¨ï¼šç¨³å®šçš„å¼•ç”¨
useEffect(() => {
  fetchData(ref.current.value);
}, []); // ä¾èµ–æ•°ç»„ä¸ºç©ºæˆ–ç¨³å®šå€¼

// âœ… å®‰å…¨ï¼šå›è°ƒå‡½æ•°ä¸­çš„refä½¿ç”¨
useEffect(() => {
  const updateRef = () => {
    fetchData(ref.current.value);
  };
  updateRef();
}, [updateRef]); // ç¨³å®šçš„å‡½æ•°å¼•ç”¨
```

### 3. ç±»å‹å®‰å…¨è§„åˆ™ (warningçº§åˆ«)
```typescript
// âŒ é¿å…ï¼šéšå¼anyç±»å‹
const data: any = fetchData(); // é¿å…
const config = {} as any; // é¿å…

// âœ… æ¨èï¼šæ˜ç¡®çš„ç±»å‹å®šä¹‰
interface ApiResponse {
  success: boolean;
  data: unknown;
  error?: string;
}

const data: ApiResponse = await fetchData();
const config: Record<string, unknown> = {};
```

### 4. å¯¹è±¡å­—é¢é‡è§„åˆ™ (warningçº§åˆ«)
```typescript
// âŒ é¿å…ï¼šæ— ç±»å‹æ³¨è§£çš„å¯¹è±¡å­—é¢é‡
const config = {
  apiUrl: 'https://api.example.com',
  timeout: 5000
};

// âœ… æ¨èï¼šæ˜ç¡®çš„ç±»å‹å®šä¹‰
interface AppConfig {
  apiUrl: string;
  timeout: number;
  retries?: number;
}

const config: AppConfig = {
  apiUrl: 'https://api.example.com',
  timeout: 5000
};
```

### 5. æ¨¡å—ç³»ç»Ÿè§„åˆ™ (warningçº§åˆ«)
```typescript
// âŒ é¿å…ï¼šCommonJS requireï¼ˆå¦‚æœé¡¹ç›®ä½¿ç”¨ESæ¨¡å—ï¼‰
const lib = require('./library'); // é¿å…

// âœ… æ¨èï¼šESæ¨¡å—å¯¼å…¥
import lib from './library';
import { helper } from './utils';

// âœ… æ¨èï¼šåŠ¨æ€å¯¼å…¥ï¼ˆæŒ‰éœ€åŠ è½½ï¼‰
const lib = await import('./library');
```

### 6. é…ç½®å®‰å…¨è§„åˆ™ (warningçº§åˆ«)
```typescript
// âŒ é¿å…ï¼šç¡¬ç¼–ç çš„æ•æ„Ÿå€¼
const API_KEY = "sk-1234567890abcdef";
const DB_PASSWORD = "password123";

// âœ… æ¨èï¼šç¯å¢ƒå˜é‡
const API_KEY = process.env.API_KEY;
const DB_PASSWORD = process.env.DB_PASSWORD;

// âœ… æ¨èï¼šé…ç½®éªŒè¯
const config = {
  apiKey: process.env.API_KEY || throw new Error('API_KEY is required'),
  dbPassword: process.env.DB_PASSWORD || throw new Error('DB_PASSWORD is required')
};
```

## ğŸ“Š ä¿®å¤å½±å“åˆ†ææ ‡å‡†

### è¯­ä¹‰å˜åŒ–çº§åˆ«
- **none**: ä¿®å¤ä¸æ”¹å˜ä»£ç è¯­ä¹‰ï¼ˆæ¨èï¼‰
- **minor**: è½»å¾®çš„è¯­ä¹‰å˜åŒ–ï¼Œéœ€è¦æµ‹è¯•éªŒè¯
- **major**: é‡å¤§è¯­ä¹‰å˜åŒ–ï¼Œéœ€è¦å…¨é¢æµ‹è¯•

### æ€§èƒ½å½±å“çº§åˆ«
- **none**: æ— æ€§èƒ½å½±å“
- **low**: è½»å¾®æ€§èƒ½æå‡æˆ–é™ä½
- **medium**: æ˜æ˜¾æ€§èƒ½å˜åŒ–
- **high**: é‡å¤§æ€§èƒ½å½±å“

### å¯è¯»æ€§å˜åŒ–çº§åˆ«
- **none**: å¯è¯»æ€§æ— å˜åŒ–
- **positive**: æé«˜ä»£ç å¯è¯»æ€§ï¼ˆæ¨èï¼‰
- **negative**: é™ä½ä»£ç å¯è¯»æ€§

### ç ´åé£é™©çº§åˆ«
- **none**: æ— ç ´åé£é™©ï¼ˆæ¨èï¼‰
- **low**: ä½ç ´åé£é™©ï¼Œå½±å“èŒƒå›´å°
- **medium**: ä¸­ç­‰ç ´åé£é™©ï¼Œéœ€è¦æµ‹è¯•éªŒè¯
- **high**: é«˜ç ´åé£é™©ï¼Œéœ€è¦å…¨é¢è¯„ä¼°

## ğŸ›¡ï¸ ä¼ä¸šçº§å®‰å…¨æ£€æŸ¥æ¸…å•

### ä¿®å¤å‰æ£€æŸ¥
- [ ] æ–‡ä»¶å¤§å° < 1MB
- [ ] å†…å­˜ä½¿ç”¨ < 500MB
- [ ] è¯­æ³•æ£€æŸ¥é€šè¿‡
- [ ] ç±»å‹æ£€æŸ¥é€šè¿‡
- [ ] ä¾èµ–åˆ†æå®Œæˆ
- [ ] å¤‡ä»½æ–‡ä»¶å·²åˆ›å»º

### ä¿®å¤è¿‡ç¨‹æ£€æŸ¥
- [ ] ASTèŠ‚ç‚¹ç²¾ç¡®å®šä½
- [ ] ä¿®å¤å½±å“åˆ†æå®Œæˆ
- [ ] äººå·¥ç¡®è®¤ï¼ˆé«˜é£é™©é—®é¢˜ï¼‰
- [ ] åŸå­æ“ä½œæ‰§è¡Œ
- [ ] ä¿®å¤éªŒè¯é€šè¿‡

### ä¿®å¤åæ£€æŸ¥
- [ ] è¯­æ³•æ£€æŸ¥é€šè¿‡
- [ ] ç±»å‹æ£€æŸ¥é€šè¿‡
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] ä»£ç å®¡æŸ¥å®Œæˆ
- [ ] éƒ¨ç½²å‰éªŒè¯å®Œæˆ

## ğŸ”§ æœ¬é¡¹ç›®ä½¿ç”¨æŒ‡å—

### æ—¥å¸¸å¼€å‘
```bash
# æ¯æ—¥å¼€å‘å‰æ£€æŸ¥
pnpm run security:check

# æäº¤å‰æ£€æŸ¥
pnpm run lint && pnpm run type-check && pnpm run security:check

# ä»£ç è´¨é‡æ£€æŸ¥
pnpm run quality-check
```

### ä»£ç ä¿®å¤æµç¨‹
```bash
# 1. åˆ†æé—®é¢˜ï¼ˆdry-runæ¨¡å¼ï¼‰
pnpm run enterprise:fix

# 2. å®¡æŸ¥ä¿®å¤é¢„è§ˆå’Œå½±å“åˆ†æ
# æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºçš„è¯¦ç»†æŠ¥å‘Š

# 3. äº¤äº’å¼ä¿®å¤ï¼ˆéœ€è¦ç¡®è®¤ï¼‰
pnpm run enterprise:fix --mode fix

# 4. éªŒè¯ä¿®å¤ç»“æœ
pnpm run type-check && pnpm run test
```

### å›¢é˜Ÿåä½œ
```bash
# å›¢é˜Ÿä»£ç å®¡æŸ¥
pnpm run enterprise:fix --mode fix
# ç”Ÿæˆè¯¦ç»†æŠ¥å‘Šä¾›å›¢é˜Ÿå®¡æŸ¥

# CI/CDé›†æˆ
pnpm run enterprise:fix --config .github/workflows/enterprise-fix.yml
```

## ğŸ“ˆ é…ç½®ç®¡ç†

### ç¯å¢ƒç‰¹å®šé…ç½®
```bash
# å¼€å‘ç¯å¢ƒé…ç½®
cp .enterprise-code-fixer.config.dev.json .enterprise-code-fixer.config.json

# æµ‹è¯•ç¯å¢ƒé…ç½®
cp .enterprise-code-fixer.config.test.json .enterprise-code-fixer.config.json

# ç”Ÿäº§ç¯å¢ƒé…ç½®
cp .enterprise-code-fixer.config.prod.json .enterprise-code-fixer.config.json
```

### å›¢é˜Ÿé…ç½®åŒæ­¥
```bash
# æ›´æ–°å›¢é˜Ÿé…ç½®
pnpm run enterprise:fix --sync-config

# éªŒè¯é…ç½®ä¸€è‡´æ€§
pnpm run enterprise:fix --validate-config
```

## ğŸš¨ ç´§æ€¥æƒ…å†µå¤„ç†

### é«˜é£é™©ä¿®å¤å›æ»š
```bash
# ç´§æ€¥å›æ»šæ‰€æœ‰ä¿®å¤
pnpm run enterprise:fix --rollback

# å›æ»šç‰¹å®šæ–‡ä»¶
pnpm run enterprise:fix --rollback --file src/components/MyComponent.tsx
```

### å®‰å…¨ç´§æ€¥åœæ­¢
```bash
# ç«‹å³åœæ­¢æ‰€æœ‰ä¿®å¤æ“ä½œ
pnpm run enterprise:fix --emergency-stop
```

## ğŸ“š ä¼ä¸šçº§æœ€ä½³å®è·µ

### 1. æ¸è¿›å¼ä¿®å¤
- å°æ‰¹é‡ä¿®å¤ï¼Œæ¯æ¬¡å¤„ç†5-10ä¸ªæ–‡ä»¶
- ä¿®å¤åç«‹å³æµ‹è¯•éªŒè¯
- å»ºç«‹ä¿®å¤å†å²è®°å½•

### 2. å›¢é˜Ÿåä½œ
- é‡è¦ä¿®å¤éœ€è¦å›¢é˜Ÿå®¡æŸ¥
- å»ºç«‹ä¿®å¤æ ‡å‡†å’Œæµç¨‹
- å®šæœŸå®‰å…¨åŸ¹è®­

### 3. æŒç»­æ”¹è¿›
- æ”¶é›†å›¢é˜Ÿåé¦ˆ
- ä¼˜åŒ–ä¿®å¤è§„åˆ™
- æ›´æ–°å®‰å…¨é…ç½®

### 4. ç›‘æ§å’ŒæŠ¥å‘Š
- å»ºç«‹ä¿®å¤æŒ‡æ ‡ç›‘æ§
- å®šæœŸç”Ÿæˆå®‰å…¨æŠ¥å‘Š
- è·Ÿè¸ªä¿®å¤æ•ˆæœ

## ğŸ”— ç›¸å…³èµ„æº

- [TypeScript AST APIæ–‡æ¡£](https://github.com/microsoft/TypeScript/wiki/Using-the-Compiler-API)
- [ä¼ä¸šçº§é…ç½®ç¤ºä¾‹](./.enterprise-code-fixer.config.json)
- [å®‰å…¨é…ç½®æ¨¡å¼](./.enterprise-fixer-schema.json)
- [ä¼ä¸šçº§ä¿®å¤å·¥å…·](./backend/src/scripts/enterprise-code-fixer.ts)

---

**è®°ä½**: å®‰å…¨ä¿®å¤å·¥å…·æ˜¯è¾…åŠ©å·¥å…·ï¼Œä¸èƒ½æ›¿ä»£äººå·¥åˆ¤æ–­ã€‚ä¼ä¸šçº§å®‰å…¨è¦æ±‚å·¥å…·å’Œäººå·¥ç›¸ç»“åˆï¼Œç¡®ä¿ä»£ç è´¨é‡å’Œé¡¹ç›®å®‰å…¨ã€‚