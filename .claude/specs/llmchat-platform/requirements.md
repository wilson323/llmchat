# LLMChat é¡¹ç›®åŸºçº¿è§„èŒƒ
> ç‰ˆæœ¬: 1.0.0 | ç”Ÿæˆæ—¥æœŸ: 2025-01-15 | åŸºäº: [é¡¹ç›®å®ªç«  v1.0.0](.specify/memory/constitution.md)

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®åç§°
**LLMChat** - æ™ºèƒ½ä½“åˆ‡æ¢èŠå¤©åº”ç”¨

### é¡¹ç›®ä½¿å‘½
æ„å»ºä¸€ä¸ªä¼ä¸šçº§çš„å¤š AI æ™ºèƒ½ä½“åˆ‡æ¢å¹³å°ï¼Œæ”¯æŒ FastGPTã€OpenAIã€Anthropicã€Dify ç­‰å¤šä¸ª AI æä¾›å•†çš„æ— ç¼é›†æˆå’Œåˆ‡æ¢ã€‚

### æ ¸å¿ƒä»·å€¼ä¸»å¼ 
- âœ… **å¤šæ™ºèƒ½ä½“æ”¯æŒ**: åŠ¨æ€åˆ‡æ¢ä¸åŒ AI æä¾›å•†å’Œæ™ºèƒ½ä½“
- âœ… **ç»Ÿä¸€æ¥å£**: æ ‡å‡†åŒ–çš„ API æ¥å£é€‚é…ä¸åŒæä¾›å•†
- âœ… **ä¼ä¸šçº§è´¨é‡**: é›¶å®¹å¿ TypeScript é”™è¯¯ï¼Œ80%+ æµ‹è¯•è¦†ç›–ç‡
- âœ… **å®‰å…¨ä¼˜å…ˆ**: JWT è®¤è¯ã€å¯†ç åŠ å¯†ã€è¾“å…¥éªŒè¯
- âœ… **çœŸå®ç¯å¢ƒ**: ç¦æ­¢æ¨¡æ‹Ÿæ•°æ®ï¼Œæ‰€æœ‰åŠŸèƒ½åŸºäºçœŸå® API

## ğŸ¯ é¡¹ç›®ç›®æ ‡

### çŸ­æœŸç›®æ ‡ï¼ˆ1-3 ä¸ªæœˆï¼‰
1. âœ… å®Œæˆæ ¸å¿ƒæ™ºèƒ½ä½“åˆ‡æ¢åŠŸèƒ½
2. âœ… å®ç° FastGPTã€OpenAIã€Anthropic é›†æˆ
3. âœ… å»ºç«‹å®Œæ•´çš„è®¤è¯å’Œæˆæƒç³»ç»Ÿ
4. âœ… è¾¾åˆ° 80% æµ‹è¯•è¦†ç›–ç‡
5. ğŸ”„ å®Œæˆç®¡ç†åå°æ‰€æœ‰åŠŸèƒ½
6. ğŸ”„ å®ç°å®Œæ•´çš„é˜Ÿåˆ—ç®¡ç†ç³»ç»Ÿ
7. ğŸ”„ å®Œæˆ CI/CD è‡ªåŠ¨åŒ–æµæ°´çº¿

### ä¸­æœŸç›®æ ‡ï¼ˆ3-6 ä¸ªæœˆï¼‰
1. ğŸ“‹ æ”¯æŒæ›´å¤š AI æä¾›å•†ï¼ˆDifyã€è‡ªå®šä¹‰ï¼‰
2. ğŸ“‹ å®ç°é«˜çº§ä¼šè¯ç®¡ç†ï¼ˆå¤šè½®å¯¹è¯ã€ä¸Šä¸‹æ–‡ä¿æŒï¼‰
3. ğŸ“‹ æ€§èƒ½ä¼˜åŒ–ï¼ˆå“åº”æ—¶é—´ <200msï¼‰
4. ğŸ“‹ å®Œå–„ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ
5. ğŸ“‹ å¤šè¯­è¨€æ”¯æŒ

### é•¿æœŸç›®æ ‡ï¼ˆ6-12 ä¸ªæœˆï¼‰
1. ğŸ“‹ ä¼ä¸šçº§éƒ¨ç½²æ–¹æ¡ˆï¼ˆDocker/K8sï¼‰
2. ğŸ“‹ æ’ä»¶ç³»ç»Ÿï¼ˆæ”¯æŒç¬¬ä¸‰æ–¹æ‰©å±•ï¼‰
3. ğŸ“‹ é«˜çº§åˆ†æå’ŒæŠ¥è¡¨
4. ğŸ“‹ ç§»åŠ¨ç«¯åº”ç”¨
5. ğŸ“‹ å¼€æºç¤¾åŒºç‰ˆæœ¬

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ
- **å‰ç«¯**: React 18 + TypeScript + Vite + Tailwind CSS + Zustand
- **åç«¯**: Node.js + Express + TypeScript + PostgreSQL + Redis
- **æµ‹è¯•**: Jest (åç«¯) + Vitest (å‰ç«¯) + Playwright (E2E)
- **éƒ¨ç½²**: Docker + Nginx + PM2
- **CI/CD**: GitHub Actions

### ç³»ç»Ÿæ¶æ„å›¾
```mermaid
graph TB
    subgraph "å‰ç«¯å±‚"
        UI[React UI]
        Store[Zustand Store]
        API[API Service]
    end
    
    subgraph "åç«¯å±‚"
        Gateway[API Gateway]
        Auth[è®¤è¯æœåŠ¡]
        AgentMgr[æ™ºèƒ½ä½“ç®¡ç†]
        Chat[èŠå¤©ä»£ç†æœåŠ¡]
        Queue[é˜Ÿåˆ—ç®¡ç†]
    end
    
    subgraph "æ•°æ®å±‚"
        DB[(PostgreSQL)]
        Cache[(Redis)]
        Files[æ–‡ä»¶å­˜å‚¨]
    end
    
    subgraph "å¤–éƒ¨æœåŠ¡"
        FastGPT[FastGPT API]
        OpenAI[OpenAI API]
        Anthropic[Anthropic API]
        Dify[Dify API]
    end
    
    UI --> Store
    Store --> API
    API --> Gateway
    
    Gateway --> Auth
    Gateway --> AgentMgr
    Gateway --> Chat
    Gateway --> Queue
    
    Auth --> DB
    AgentMgr --> DB
    Chat --> Cache
    Queue --> Redis
    
    Chat --> FastGPT
    Chat --> OpenAI
    Chat --> Anthropic
    Chat --> Dify
```

### æ•°æ®æµæ¶æ„
```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant F as å‰ç«¯
    participant G as API Gateway
    participant A as è®¤è¯æœåŠ¡
    participant C as èŠå¤©æœåŠ¡
    participant AI as AIæä¾›å•†
    participant DB as æ•°æ®åº“
    
    U->>F: å‘é€æ¶ˆæ¯
    F->>G: POST /api/chat/completions
    G->>A: éªŒè¯JWT Token
    A->>DB: æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
    DB-->>A: è¿”å›ç”¨æˆ·æ•°æ®
    A-->>G: éªŒè¯é€šè¿‡
    G->>C: è½¬å‘èŠå¤©è¯·æ±‚
    C->>AI: è°ƒç”¨AI API
    AI-->>C: æµå¼è¿”å›å“åº”
    C-->>F: SSEæµå¼æ¨é€
    F-->>U: å®æ—¶æ˜¾ç¤ºå›å¤
```

## ğŸ“ ç›®å½•ç»“æ„è§„èŒƒ

### åç«¯ç»“æ„
```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ controllers/         # æ§åˆ¶å™¨å±‚ï¼ˆHTTPè¯·æ±‚å¤„ç†ï¼‰
â”‚   â”‚   â”œâ”€â”€ AgentController.ts
â”‚   â”‚   â”œâ”€â”€ ChatController.ts
â”‚   â”‚   â”œâ”€â”€ AuthController.ts
â”‚   â”‚   â””â”€â”€ AdminController.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ services/           # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ AgentConfigService.ts     # æ™ºèƒ½ä½“é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ ChatProxyService.ts       # èŠå¤©ä»£ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ AuthServiceV2.ts          # è®¤è¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ MonitoringService.ts      # ç›‘æ§æœåŠ¡
â”‚   â”‚   â””â”€â”€ QueueManager.ts           # é˜Ÿåˆ—ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/             # è·¯ç”±å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ agents.ts
â”‚   â”‚   â”œâ”€â”€ chat.ts
â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚   â”‚   â””â”€â”€ admin.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/         # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ jwtAuth.ts            # JWTè®¤è¯
â”‚   â”‚   â”œâ”€â”€ protectMiddleware.ts  # ä¿æŠ¤ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ rateLimiter.ts        # é€Ÿç‡é™åˆ¶
â”‚   â”‚   â””â”€â”€ requestLogger.ts      # è¯·æ±‚æ—¥å¿—
â”‚   â”‚
â”‚   â”œâ”€â”€ types/              # TypeScriptç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ agent.ts
â”‚   â”‚   â”œâ”€â”€ chat.ts
â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚   â”‚   â””â”€â”€ api.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ logger.ts
â”‚   â”‚   â”œâ”€â”€ errors.ts
â”‚   â”‚   â”œâ”€â”€ validators.ts
â”‚   â”‚   â””â”€â”€ helpers.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ migrations/         # æ•°æ®åº“è¿ç§»
â”‚   â”‚   â”œâ”€â”€ 001_create_users.sql
â”‚   â”‚   â”œâ”€â”€ 002_create_sessions.sql
â”‚   â”‚   â””â”€â”€ 003_create_messages.sql
â”‚   â”‚
â”‚   â””â”€â”€ index.ts           # å…¥å£æ–‡ä»¶
â”‚
â”œâ”€â”€ tests/                 # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ __mocks__/
â”‚
â”œâ”€â”€ dist/                  # ç¼–è¯‘è¾“å‡º
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ package.json
â””â”€â”€ .env.example
```

### å‰ç«¯ç»“æ„
```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/        # Reactç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ui/           # åŸºç¡€UIç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Input.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Dialog.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Card.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ agents/       # æ™ºèƒ½ä½“ç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ AgentList.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ AgentCard.tsx
â”‚   â”‚   â”‚   â””â”€â”€ AgentSelector.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ chat/         # èŠå¤©ç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatWindow.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ MessageList.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ MessageInput.tsx
â”‚   â”‚   â”‚   â””â”€â”€ StreamingMessage.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ admin/        # ç®¡ç†åå°
â”‚   â”‚   â”‚   â”œâ”€â”€ AdminDashboard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ AgentManagement.tsx
â”‚   â”‚   â”‚   â””â”€â”€ UserManagement.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ layouts/      # å¸ƒå±€ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ MainLayout.tsx
â”‚   â”‚       â””â”€â”€ AdminLayout.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ store/            # ZustandçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ chatStore.ts
â”‚   â”‚   â”œâ”€â”€ agentStore.ts
â”‚   â”‚   â””â”€â”€ authStore.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ services/         # APIæœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ agentService.ts
â”‚   â”‚   â”œâ”€â”€ chatService.ts
â”‚   â”‚   â””â”€â”€ authService.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/            # è‡ªå®šä¹‰Hooks
â”‚   â”‚   â”œâ”€â”€ useChat.ts
â”‚   â”‚   â”œâ”€â”€ useAgents.ts
â”‚   â”‚   â””â”€â”€ useAuth.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ types/            # TypeScriptç±»å‹
â”‚   â”‚   â”œâ”€â”€ agent.ts
â”‚   â”‚   â”œâ”€â”€ chat.ts
â”‚   â”‚   â””â”€â”€ common.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/            # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ api.ts
â”‚   â”‚   â”œâ”€â”€ storage.ts
â”‚   â”‚   â””â”€â”€ helpers.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ App.tsx
â”‚   â””â”€â”€ main.tsx
â”‚
â”œâ”€â”€ public/
â”œâ”€â”€ tests/
â”œâ”€â”€ dist/
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tsconfig.json
â””â”€â”€ package.json
```

## ğŸ”Œ API æ¥å£è§„èŒƒ

### è®¤è¯ç›¸å…³ API

#### POST /api/auth/login
ç”¨æˆ·ç™»å½•

**è¯·æ±‚ä½“**:
```typescript
{
  email: string;      // é‚®ç®±åœ°å€
  password: string;   // å¯†ç 
}
```

**å“åº”**:
```typescript
{
  token: string;      // JWT token
  user: {
    id: string;
    email: string;
    role: 'user' | 'admin';
    createdAt: Date;
  }
}
```

#### POST /api/auth/register
ç”¨æˆ·æ³¨å†Œ

**è¯·æ±‚ä½“**:
```typescript
{
  email: string;
  password: string;
  name?: string;
}
```

#### POST /api/auth/refresh
åˆ·æ–° token

**è¯·æ±‚å¤´**:
```
Authorization: Bearer <token>
```

### æ™ºèƒ½ä½“ç®¡ç† API

#### GET /api/agents
è·å–æ‰€æœ‰å¯ç”¨æ™ºèƒ½ä½“

**å“åº”**:
```typescript
{
  agents: Array<{
    id: string;
    name: string;
    provider: 'fastgpt' | 'openai' | 'anthropic' | 'dify';
    description: string;
    status: 'active' | 'inactive';
    features: {
      supportsStream: boolean;
      supportsFiles: boolean;
      supportsImages: boolean;
    };
  }>;
}
```

#### GET /api/agents/:id/status
æ£€æŸ¥æ™ºèƒ½ä½“çŠ¶æ€

#### POST /api/agents/reload
é‡æ–°åŠ è½½æ™ºèƒ½ä½“é…ç½®ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰

### èŠå¤©ç›¸å…³ API

#### POST /api/chat/completions
å‘é€èŠå¤©è¯·æ±‚ï¼ˆæ”¯æŒæµå¼å’Œéæµå¼ï¼‰

**è¯·æ±‚ä½“**:
```typescript
{
  agentId: string;
  messages: Array<{
    role: 'user' | 'assistant' | 'system';
    content: string;
  }>;
  stream?: boolean;        // æ˜¯å¦ä½¿ç”¨æµå¼å“åº”
  sessionId?: string;      // ä¼šè¯ID
}
```

**å“åº”ï¼ˆéæµå¼ï¼‰**:
```typescript
{
  message: {
    role: 'assistant';
    content: string;
  };
  sessionId: string;
}
```

**å“åº”ï¼ˆæµå¼ï¼‰**: Server-Sent Events
```
event: chunk
data: {"text": "éƒ¨åˆ†å›å¤å†…å®¹"}

event: end
data: {"sessionId": "xxx"}
```

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

#### users è¡¨
```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    name VARCHAR(255),
    role VARCHAR(50) DEFAULT 'user',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### sessions è¡¨
```sql
CREATE TABLE sessions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    agent_id VARCHAR(255) NOT NULL,
    title VARCHAR(500),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### messages è¡¨
```sql
CREATE TABLE messages (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    session_id UUID REFERENCES sessions(id),
    role VARCHAR(50) NOT NULL,
    content TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### æµ‹è¯•å±‚çº§

#### 1. å•å…ƒæµ‹è¯•ï¼ˆ80%+ è¦†ç›–ç‡ï¼‰
**å·¥å…·**: Jest (åç«¯) / Vitest (å‰ç«¯)

**æµ‹è¯•èŒƒå›´**:
- æ‰€æœ‰ä¸šåŠ¡é€»è¾‘å‡½æ•°
- æ‰€æœ‰å·¥å…·å‡½æ•°
- æ‰€æœ‰ç±»æ–¹æ³•
- è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸æƒ…å†µ

**ç¤ºä¾‹**:
```typescript
// backend/tests/unit/AgentConfigService.test.ts
describe('AgentConfigService', () => {
  it('should load agent configuration from file', async () => {
    const service = new AgentConfigService();
    const agents = await service.getAllAgents();
    expect(agents).toBeInstanceOf(Array);
    expect(agents.length).toBeGreaterThan(0);
  });

  it('should throw error for invalid agent ID', async () => {
    const service = new AgentConfigService();
    await expect(service.getAgentById('invalid'))
      .rejects.toThrow('Agent not found');
  });
});
```

#### 2. é›†æˆæµ‹è¯•ï¼ˆå…³é”®æµç¨‹ï¼‰
**å·¥å…·**: Jest + Supertest

**æµ‹è¯•èŒƒå›´**:
- API ç«¯ç‚¹é›†æˆ
- æ•°æ®åº“äº¤äº’
- æœåŠ¡é—´é€šä¿¡
- è®¤è¯å’Œæˆæƒæµç¨‹

**ç¤ºä¾‹**:
```typescript
// backend/tests/integration/auth.test.ts
describe('Authentication API', () => {
  it('should login successfully with valid credentials', async () => {
    const response = await request(app)
      .post('/api/auth/login')
      .send({
        email: 'test@example.com',
        password: 'Test123!'
      });

    expect(response.status).toBe(200);
    expect(response.body).toHaveProperty('token');
    expect(response.body.user.email).toBe('test@example.com');
  });
});
```

#### 3. E2E æµ‹è¯•ï¼ˆå…³é”®ç”¨æˆ·æµç¨‹ï¼‰
**å·¥å…·**: Playwright

**æµ‹è¯•åœºæ™¯**:
- ç”¨æˆ·æ³¨å†Œå’Œç™»å½•
- æ™ºèƒ½ä½“åˆ‡æ¢
- å‘é€æ¶ˆæ¯å’Œæ¥æ”¶å›å¤
- ç®¡ç†åå°æ“ä½œ

**ç¤ºä¾‹**:
```typescript
// tests/e2e/chat.spec.ts
test('should send message and receive response', async ({ page }) => {
  await page.goto('http://localhost:3000');
  await page.fill('[data-testid="email-input"]', 'test@example.com');
  await page.fill('[data-testid="password-input"]', 'Test123!');
  await page.click('[data-testid="login-button"]');
  
  await page.waitForSelector('[data-testid="chat-window"]');
  await page.fill('[data-testid="message-input"]', 'Hello AI');
  await page.click('[data-testid="send-button"]');
  
  await page.waitForSelector('[data-testid="assistant-message"]');
  const response = await page.textContent('[data-testid="assistant-message"]');
  expect(response).toBeTruthy();
});
```

### æµ‹è¯•è¦†ç›–ç‡è¦æ±‚
- **æ•´ä½“è¦†ç›–ç‡**: â‰¥80%
- **å…³é”®æ¨¡å—**: â‰¥90%
  - AuthService
  - ChatProxyService
  - AgentConfigService
- **å·¥å…·å‡½æ•°**: â‰¥95%

### æµ‹è¯•æ‰§è¡Œ
```bash
# å•å…ƒæµ‹è¯•
pnpm run backend:test       # åç«¯å•å…ƒæµ‹è¯•
pnpm run frontend:test      # å‰ç«¯å•å…ƒæµ‹è¯•

# é›†æˆæµ‹è¯•
pnpm run test:integration   # é›†æˆæµ‹è¯•

# E2E æµ‹è¯•
pnpm run test:e2e          # E2Eæµ‹è¯•
pnpm run test:e2e:ui       # E2Eæµ‹è¯•UIæ¨¡å¼

# å…¨éƒ¨æµ‹è¯•
pnpm test                  # è¿è¡Œæ‰€æœ‰æµ‹è¯•
```

## ğŸ”’ å®‰å…¨è§„èŒƒ

### è®¤è¯å’Œæˆæƒ
- âœ… JWT Token è®¤è¯ï¼ˆHS256 ç®—æ³•ï¼‰
- âœ… Token è¿‡æœŸæ—¶é—´ï¼š1å°æ—¶
- âœ… Refresh Token æœºåˆ¶
- âœ… å¯†ç å“ˆå¸Œï¼šbcryptï¼ˆsalt rounds: 10ï¼‰
- âœ… è§’è‰²åŸºç¡€æƒé™æ§åˆ¶ï¼ˆRBACï¼‰

### æ•°æ®å®‰å…¨
- âœ… è¾“å…¥éªŒè¯ï¼ˆæ‰€æœ‰ API ç«¯ç‚¹ï¼‰
- âœ… SQL æ³¨å…¥é˜²æŠ¤ï¼ˆä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼‰
- âœ… XSS é˜²æŠ¤ï¼ˆå‰ç«¯è¾“å‡ºå‡€åŒ–ï¼‰
- âœ… CSRF é˜²æŠ¤
- âœ… é€Ÿç‡é™åˆ¶ï¼ˆAPIè°ƒç”¨é™åˆ¶ï¼‰

### API å®‰å…¨
- âœ… API å¯†é’¥é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†
- âœ… æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
- âœ… HTTPS å¼ºåˆ¶ä½¿ç”¨ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- âœ… CORS ç­–ç•¥é…ç½®
- âœ… è¯·æ±‚å¤§å°é™åˆ¶

### æ—¥å¿—å’Œå®¡è®¡
- âœ… æ“ä½œæ—¥å¿—è®°å½•
- âœ… æ•æ„Ÿä¿¡æ¯è„±æ•
- âœ… é”™è¯¯æ—¥å¿—ç›‘æ§
- âœ… å®‰å…¨äº‹ä»¶å‘Šè­¦

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### å“åº”æ—¶é—´
- API å“åº”æ—¶é—´ï¼ˆP95ï¼‰: <200ms
- é¦–å±åŠ è½½æ—¶é—´: <3s
- æµå¼å“åº”å»¶è¿Ÿ: <100ms

### èµ„æºä½¿ç”¨
- å†…å­˜ä½¿ç”¨: <500MBï¼ˆæ­£å¸¸è´Ÿè½½ï¼‰
- CPU ä½¿ç”¨: <50%ï¼ˆæ­£å¸¸è´Ÿè½½ï¼‰
- æ•°æ®åº“è¿æ¥æ± : 10-50ä¸ªè¿æ¥

### å¹¶å‘èƒ½åŠ›
- åŒæ—¶åœ¨çº¿ç”¨æˆ·: >1000
- æ¯ç§’è¯·æ±‚æ•°(QPS): >100
- æ¶ˆæ¯ååé‡: >50æ¡/ç§’

## ğŸš€ éƒ¨ç½²ç­–ç•¥

### å¼€å‘ç¯å¢ƒ
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
pnpm run dev

# å‰ç«¯: http://localhost:3000
# åç«¯: http://localhost:3001
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# æ„å»º
pnpm run build

# å¯åŠ¨
pnpm start

# ä½¿ç”¨ PM2
pm2 start ecosystem.config.js
```

### Docker éƒ¨ç½²
```bash
# æ„å»ºé•œåƒ
docker build -t llmchat:latest .

# è¿è¡Œå®¹å™¨
docker-compose up -d
```

### ç¯å¢ƒå˜é‡
```bash
# å¿…éœ€ç¯å¢ƒå˜é‡
DATABASE_URL=postgresql://...
JWT_SECRET=your_jwt_secret
REDIS_URL=redis://localhost:6379

# AI æä¾›å•† API å¯†é’¥
FASTGPT_API_KEY=...
OPENAI_API_KEY=...
ANTHROPIC_API_KEY=...

# å¯é€‰é…ç½®
PORT=3001
NODE_ENV=production
LOG_LEVEL=info
```

## ğŸ“ å¼€å‘è§„èŒƒéµå®ˆæ£€æŸ¥æ¸…å•

### æäº¤å‰æ£€æŸ¥
- [ ] TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡ (`pnpm run type-check`)
- [ ] ESLint æ£€æŸ¥é€šè¿‡ (`pnpm run lint`)
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡ (`pnpm test`)
- [ ] ä»£ç æ ¼å¼åŒ–æ­£ç¡® (`pnpm run lint:fix`)
- [ ] æ— å®‰å…¨æ¼æ´ (`pnpm audit`)

### ä»£ç å®¡æŸ¥æ£€æŸ¥
- [ ] ä»£ç ç¬¦åˆ TypeScript ä¸¥æ ¼æ¨¡å¼
- [ ] æ‰€æœ‰å‡½æ•°æœ‰ç±»å‹æ³¨è§£
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] æµ‹è¯•è¦†ç›–å……åˆ†
- [ ] æ— ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯
- [ ] æ³¨é‡Šæ¸…æ™°å‡†ç¡®
- [ ] æ— æ¨¡æ‹Ÿæ•°æ®/æœåŠ¡

### PR åˆå¹¶æ£€æŸ¥
- [ ] CI/CD æµæ°´çº¿å…¨éƒ¨é€šè¿‡
- [ ] è‡³å°‘ 1 äººä»£ç å®¡æŸ¥æ‰¹å‡†
- [ ] æ— åˆå¹¶å†²çª
- [ ] æ–‡æ¡£å·²æ›´æ–°
- [ ] å˜æ›´æ—¥å¿—å·²è®°å½•

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®å®ªç« ](.specify/memory/constitution.md) - æ ¸å¿ƒåŸåˆ™å’Œæ²»ç†è§„åˆ™
- [CLAUDE.md](CLAUDE.md) - AI åŠ©æ‰‹ä¸Šä¸‹æ–‡æ–‡æ¡£
- [CODE_QUALITY_STANDARDS.md](CODE_QUALITY_STANDARDS.md) - ä»£ç è´¨é‡æ ‡å‡†
- [DEVELOPMENT_STANDARDS.md](DEVELOPMENT_STANDARDS.md) - å¼€å‘è§„èŒƒå’Œæœ€ä½³å®è·µ
- [README.md](README.md) - é¡¹ç›®æ¦‚è¿°å’Œå¿«é€Ÿå¼€å§‹
- [API æ–‡æ¡£] - Swagger API æ–‡æ¡£ï¼ˆè¿è¡Œæ—¶ç”Ÿæˆï¼‰

## ğŸ“ æ”¯æŒå’Œè”ç³»

- **é¡¹ç›®ä»“åº“**: [GitHub Repository URL]
- **æ–‡æ¡£ç½‘ç«™**: [Documentation URL]
- **é—®é¢˜è¿½è¸ª**: [Issue Tracker URL]
- **å›¢é˜Ÿè”ç³»**: [Team Email]

---

**è§„èŒƒç‰ˆæœ¬**: 1.0.0  
**æœ€åæ›´æ–°**: 2025-01-15  
**ç»´æŠ¤è€…**: LLMChat å¼€å‘å›¢é˜Ÿ


---

## Clarifications

### Session 2025-01-16

**æ¾„æ¸…ç›®æ ‡**: æ˜ç¡®TypeScripté”™è¯¯ä¿®å¤çš„æ‰§è¡Œç­–ç•¥å’Œä¼˜å…ˆçº§

#### å·²è®°å½•çš„å…³é”®å†³ç­–

1. **Q: å®æ–½ä¼˜å…ˆçº§ç­–ç•¥ï¼Ÿ**
   - **A: è´¨é‡ä¼˜å…ˆ** - å…ˆä¿®å¤æ‰€æœ‰236ä¸ªTypeScripté”™è¯¯ï¼Œå†å¼€å‘æ–°åŠŸèƒ½
   - **å½±å“**: æš‚ç¼“tasks.mdä¸­çš„æ–°åŠŸèƒ½ä»»åŠ¡ï¼Œèšç„¦ä»£ç è´¨é‡åŸºçº¿

2. **Q: é”™è¯¯ä¿®å¤çš„é¡ºåºï¼Ÿ**
   - **A: åˆ†æ¨¡å—æ‰¹é‡ä¿®å¤** - ç›‘æ§ç³»ç»Ÿ  CAD  UI  Hooks  Demoç¦ç”¨
   - **å½±å“**: æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡ä¿®å¤å·¥ä½œï¼Œæé«˜æ•ˆç‡

3. **Q: CADåŠŸèƒ½çš„å®ç°èŒƒå›´ï¼Ÿ**
   - **A: å®Œæ•´CADå·¥ä½œæµ** - åŒ…å«æŸ¥çœ‹å™¨ + èŠå¤©é›†æˆ + æ–‡ä»¶ä¸Šä¼  + ç®¡ç†
   - **å½±å“**: CADæ˜¯æ ¸å¿ƒåŠŸèƒ½ï¼ˆéDemoï¼‰ï¼Œå¿…é¡»å®Œæ•´å®ç°å¹¶ä¿®å¤æ‰€æœ‰é”™è¯¯
   - **ä¿®æ­£**: CADä¼˜å…ˆçº§ä»P2æå‡è‡³P0

4. **Q: Demoç»„ä»¶çš„å¤„ç†æ–¹å¼ï¼Ÿ**
   - **A: æš‚æ—¶ç¦ç”¨è·¯ç”±** - æ€§èƒ½å¯¹æ¯”Demoä¸éœ€è¦ï¼Œæ³¨é‡Šè·¯ç”±èŠ‚çœä¿®å¤æ—¶é—´
   - **å½±å“**: èŠ‚çœ~2å°æ—¶ï¼Œå‡å°‘30ä¸ªé”™è¯¯ï¼Œä»£ç ä¿ç•™ä¾¿äºæœªæ¥å¯ç”¨

#### æ‰§è¡Œè®¡åˆ’ç¡®è®¤

åŸºäºä»¥ä¸Šæ¾„æ¸…ï¼Œæ‰§è¡Œè®¡åˆ’åˆ†ä¸º7ä¸ªæ‰¹æ¬¡ï¼š
- **ç¬¬1æ‰¹** : æ ¸å¿ƒèŠå¤©åŠŸèƒ½ (27ä¸ª) - å·²å®Œæˆ
- **ç¬¬2æ‰¹**: ç›‘æ§ç³»ç»Ÿ (~100ä¸ª) - 6-8å°æ—¶
- **ç¬¬3æ‰¹**: CADå®Œæ•´åŠŸèƒ½ (~60ä¸ª) - 4-5å°æ—¶
- **ç¬¬4æ‰¹**: UIç»„ä»¶ (~25ä¸ª) - 2-3å°æ—¶
- **ç¬¬5æ‰¹**: Hooksç­‰ (~21ä¸ª) - 1.5å°æ—¶
- **ç¬¬6æ‰¹**: Demoç¦ç”¨ (~300ä¸ª) - 0.5å°æ—¶
- **ç¬¬7æ‰¹**: æœ€ç»ˆéªŒè¯ - 1å°æ—¶

**æ€»é¢„è®¡æ—¶é—´**: 15-20å°æ—¶ï¼ˆ2-3ä¸ªå·¥ä½œæ—¥ï¼‰
**æœ€ç»ˆç›®æ ‡**: Frontend TypeScripté›¶é”™è¯¯

---
