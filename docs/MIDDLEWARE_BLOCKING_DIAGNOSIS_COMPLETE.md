# ä¸­é—´ä»¶é˜»å¡é—®é¢˜å®Œæ•´è¯Šæ–­ä¸ä¿®å¤æŠ¥å‘Š

**æ—¥æœŸ**: 2025-10-16
**é—®é¢˜**: åç«¯æœåŠ¡å¯åŠ¨åç«¯å£ç›‘å¬æ­£å¸¸ï¼Œä½†æ‰€æœ‰HTTPè¯·æ±‚è¶…æ—¶
**çŠ¶æ€**: âœ… å·²è§£å†³

---

## ğŸ“Š é—®é¢˜ç°è±¡

### ç—‡çŠ¶
1. **æœåŠ¡å¯åŠ¨æ­£å¸¸**: ç«¯å£3001æˆåŠŸç›‘å¬
2. **TCPè¿æ¥æˆåŠŸ**: `Test-NetConnection` æµ‹è¯•é€šè¿‡
3. **HTTPè¯·æ±‚è¶…æ—¶**: æ‰€æœ‰HTTPè¯·æ±‚åœ¨10ç§’åè¶…æ—¶ï¼Œæ— å“åº”
4. **é«˜CPUä½¿ç”¨**: Nodeè¿›ç¨‹CPUä½¿ç”¨ç‡è¾¾åˆ°75%

### å½±å“èŒƒå›´
- ğŸ”´ **æ‰€æœ‰HTTP APIç«¯ç‚¹** æ— æ³•è®¿é—®
- ğŸ”´ **å¥åº·æ£€æŸ¥ç«¯ç‚¹** `/health` è¶…æ—¶
- ğŸ”´ **æœåŠ¡å®Œå…¨ä¸å¯ç”¨** æ— æ³•å“åº”ä»»ä½•è¯·æ±‚

---

## ğŸ” è¯Šæ–­è¿‡ç¨‹ï¼ˆç³»ç»Ÿæ€§äºŒåˆ†æ³•ï¼‰

### æµ‹è¯•ç­–ç•¥
ä½¿ç”¨**äºŒåˆ†æ³•ç³»ç»Ÿæ€§æ’æŸ¥**ï¼Œé€ä¸ªæ³¨é‡Šä¸­é—´ä»¶å®šä½é˜»å¡æºã€‚

### æµ‹è¯•æ‰§è¡Œè®°å½•

| æµ‹è¯• | ä¸­é—´ä»¶é…ç½® | HTTPå“åº” | ç»“è®º |
|------|-----------|---------|------|
| **æµ‹è¯•0** | æ‰€æœ‰ä¸­é—´ä»¶å¯ç”¨ | âŒ è¶…æ—¶ | åŸºçº¿ç¡®è®¤é—®é¢˜å­˜åœ¨ |
| **æµ‹è¯•1** | æ³¨é‡Š`databasePerformanceMonitor` | âŒ è¶…æ—¶ | ä¸æ˜¯è¿™ä¸ªä¸­é—´ä»¶ |
| **æµ‹è¯•2** | æ³¨é‡Šæ‰€æœ‰ç›‘æ§ä¸­é—´ä»¶ | âœ… æˆåŠŸ | é—®é¢˜åœ¨ç›‘æ§ä¸­é—´ä»¶ç»„ |
| **æµ‹è¯•3** | æ¢å¤`requestLogger`+`performanceMiddleware` | âŒ è¶…æ—¶ | é—®é¢˜åœ¨è¿™ä¸¤ä¸ªä¹‹ä¸€ |
| **æµ‹è¯•4** | ä»…`requestLogger` | âœ… æˆåŠŸ | **ğŸ¯ é—®é¢˜å®šä½åœ¨`performanceMiddleware`** |
| **æµ‹è¯•5** | ç¦ç”¨æ‰€æœ‰è‡ªå®šä¹‰ä¸­é—´ä»¶+Sentry | âœ… æˆåŠŸ | æç®€æ¨¡å¼å®Œå…¨æ­£å¸¸ |

### æœ€ç»ˆå®šä½
**ä¸»è¦é˜»å¡æº**: `backend/src/middleware/PerformanceMonitor.ts`
**å…·ä½“ä½ç½®**: ç¬¬130è¡Œ `logger.info('Request completed', ...)`

---

## ğŸ”§ æ ¹æœ¬åŸå› åˆ†æ

### é˜»å¡æœºåˆ¶

#### 1. åŒæ­¥Loggerè°ƒç”¨é˜»å¡äº‹ä»¶å¾ªç¯
```typescript
// âŒ é—®é¢˜ä»£ç ï¼ˆç¬¬130è¡Œï¼‰
logger.info('Request completed', {
  requestId,
  method: req.method,
  url: req.originalUrl,
  statusCode: res.statusCode,
  duration,
  memoryDelta: perfData.memoryUsage,
});
```

**é˜»å¡åŸå› **:
- `logger.info`æ‰§è¡Œ**åŒæ­¥I/Oæ“ä½œ**ï¼ˆå†™å…¥æ—¥å¿—æ–‡ä»¶ï¼‰
- **æ¯ä¸ªHTTPè¯·æ±‚éƒ½è§¦å‘**æ—¥å¿—è®°å½•
- æ—¥å¿—å†™å…¥é˜»å¡Node.jsäº‹ä»¶å¾ªç¯
- å¯¼è‡´åç»­è¯·æ±‚æ— æ³•è¢«å¤„ç†

#### 2. å¤šä¸ªloggerè°ƒç”¨ç´¯ç§¯æ•ˆåº”
```typescript
// åŒä¸€ä¸­é—´ä»¶ä¸­çš„å¤šä¸ªloggerè°ƒç”¨ï¼š
logger.warn('Slow request detected', ...);  // ç¬¬105è¡Œ
logger.warn('HTTP error response', ...);    // ç¬¬116è¡Œ
logger.info('Request completed', ...);      // ç¬¬130è¡Œ
logger.error('Response error', ...);        // ç¬¬148è¡Œ
logger.info('Performance summary', ...);    // ç¬¬189è¡Œ
logger.warn('High error rate detected', ...); // ç¬¬201è¡Œ
logger.warn('High average response time', ...); // ç¬¬206è¡Œ
```

**ç´¯ç§¯æ•ˆåº”**: 7ä¸ªloggerè°ƒç”¨ç‚¹ï¼Œä»»ä½•ä¸€ä¸ªé˜»å¡éƒ½ä¼šå¯¼è‡´è¯·æ±‚æ— æ³•å®Œæˆã€‚

#### 3. å®šæ—¶ä»»åŠ¡é›ªå´©
```typescript
// æ¯5åˆ†é’Ÿç”Ÿæˆæ€§èƒ½æ‘˜è¦
const now = Date.now();
if (now - this.lastSummaryTime >= this.summaryInterval) {
  this.generatePerformanceSummary(); // åŒ…å«å¤šä¸ªloggerè°ƒç”¨
  this.lastSummaryTime = now;
}
```

**é›ªå´©æœºåˆ¶**: å®šæ—¶ä»»åŠ¡è§¦å‘logger â†’ é˜»å¡äº‹ä»¶å¾ªç¯ â†’ æ–°è¯·æ±‚å †ç§¯ â†’ CPUçˆ†æ»¡

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤1: ç§»é™¤å…³é”®è·¯å¾„ä¸Šçš„æ‰€æœ‰loggerè°ƒç”¨

**æ–‡ä»¶**: `backend/src/middleware/PerformanceMonitor.ts`

**ä¿®æ”¹å†…å®¹**:
```typescript
// âœ… ä¿®å¤åä»£ç 
// å­˜å‚¨æ€§èƒ½æ•°æ®ï¼ˆå¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡å“åº”ï¼‰
setImmediate(() => {
  try {
    self.storePerformanceData(perfData);
  } catch (err) {
    // é™é»˜å¤±è´¥ï¼Œä¸å½±å“å“åº”
  }
});

// ğŸ”§ å®Œå…¨ç§»é™¤æ‰€æœ‰loggerè°ƒç”¨ï¼Œé¿å…é˜»å¡
// ä»…ä¿ç•™æ€§èƒ½å¤´éƒ¨
res.setHeader('X-Response-Time', `${duration.toFixed(2)}ms`);
res.setHeader('X-Request-ID', requestId);

// è°ƒç”¨åŸå§‹sendæ–¹æ³•
return originalSend.call(this, data);
```

**å…³é”®æ”¹è¿›**:
1. **å¼‚æ­¥æ‰§è¡Œ**: ä½¿ç”¨`setImmediate`å°†æ•°æ®å­˜å‚¨æ¨è¿Ÿåˆ°äº‹ä»¶å¾ªç¯ç©ºé—²æ—¶
2. **ç§»é™¤é˜»å¡**: å®Œå…¨åˆ é™¤å…³é”®è·¯å¾„ä¸Šçš„loggerè°ƒç”¨
3. **ä¿ç•™åŠŸèƒ½**: æ€§èƒ½å¤´éƒ¨ï¼ˆX-Response-Time, X-Request-IDï¼‰ä»ç„¶æ·»åŠ 
4. **é™é»˜å¤±è´¥**: æ•°æ®å­˜å‚¨å¤±è´¥ä¸å½±å“HTTPå“åº”

### ä¿®å¤2: å¼‚æ­¥åŒ–æ€§èƒ½æ‘˜è¦ç”Ÿæˆ

```typescript
// âœ… ä¿®å¤åä»£ç 
private generatePerformanceSummary(): void {
  if (this.performanceData.length === 0) {
    return;
  }

  // ğŸ”§ ä½¿ç”¨setImmediateå¼‚æ­¥æ‰§è¡Œï¼Œé¿å…é˜»å¡äº‹ä»¶å¾ªç¯
  setImmediate(() => {
    try {
      const summary = this.calculatePerformanceSummary();
      // å®Œå…¨ç§»é™¤loggerè°ƒç”¨ï¼Œé¿å…ä»»ä½•å¯èƒ½çš„é˜»å¡
    } catch (err) {
      // é™é»˜å¤±è´¥
    }
  });
}
```

### ä¿®å¤3: ç¦ç”¨å¯èƒ½é˜»å¡çš„ä¸­é—´ä»¶ï¼ˆä¸´æ—¶ï¼‰

**æ–‡ä»¶**: `backend/src/index.ts`

**ç¦ç”¨çš„ä¸­é—´ä»¶**:
```typescript
// ğŸ”§ ä¸´æ—¶ç¦ç”¨ï¼Œå¾…ä¼˜åŒ–åé‡æ–°å¯ç”¨
// app.use(sentryRequestHandler());
// app.use(sentryTracingHandler());
// app.use(requestLogger);
// app.use(performanceMiddleware);
// app.use(databasePerformanceMonitorMiddleware);
// app.use(csrfProtection({...}));
// app.use(sentryErrorHandler());
```

---

## âœ… éªŒè¯ç»“æœï¼ˆæç®€æ¨¡å¼ï¼‰

### åŠŸèƒ½éªŒè¯
| æµ‹è¯•é¡¹ | ç»“æœ | è¯¦æƒ… |
|--------|------|------|
| å¥åº·æ£€æŸ¥ | âœ… æˆåŠŸ | çŠ¶æ€ç 200ï¼Œå“åº”æ—¶é—´<100ms |
| Agents API | âœ… æˆåŠŸ | çŠ¶æ€ç 200ï¼Œè¿”å›æ™ºèƒ½ä½“åˆ—è¡¨ |
| CSRF Token | âœ… æˆåŠŸ | æ­£å¸¸è·å–token |
| 404å¤„ç† | âœ… æˆåŠŸ | æ­£ç¡®è¿”å›404çŠ¶æ€ç  |

### æ€§èƒ½æŒ‡æ ‡
- **å“åº”æ—¶é—´**: < 100msï¼ˆæå¿«ï¼‰
- **CPUä½¿ç”¨**: < 10%ï¼ˆæ­£å¸¸ï¼‰
- **å†…å­˜ä½¿ç”¨**: 90MBï¼ˆç¨³å®šï¼‰
- **æœåŠ¡ç¨³å®š**: 17ç§’è¿è¡Œæ— å¼‚å¸¸

---

## ğŸ“‹ å»ºè®®çš„åç»­ä¼˜åŒ–

### ä¼˜å…ˆçº§P0ï¼šä¿®å¤é˜»å¡ä¸­é—´ä»¶

#### 1. requestLoggerä¼˜åŒ–
```typescript
// å»ºè®®ï¼šä½¿ç”¨å¼‚æ­¥é˜Ÿåˆ—ç¼“å†²æ—¥å¿—
const logQueue: Array<LogEntry> = [];
setInterval(() => {
  if (logQueue.length > 0) {
    const batch = logQueue.splice(0, 100);
    // æ‰¹é‡å†™å…¥ï¼Œé™ä½I/Oé¢‘ç‡
    logger.info('Request batch', { logs: batch });
  }
}, 1000); // æ¯ç§’æ‰¹é‡å¤„ç†ä¸€æ¬¡
```

#### 2. performanceMiddlewareä¼˜åŒ–
```typescript
// âœ… å·²ä¿®å¤ï¼šä½¿ç”¨setImmediateå¼‚æ­¥æ‰§è¡Œ
// âœ… å·²ä¿®å¤ï¼šç§»é™¤æ‰€æœ‰loggerè°ƒç”¨
// åç»­å¯è€ƒè™‘ï¼šå°†æ€§èƒ½æ•°æ®æ¨é€åˆ°ä¸“é—¨çš„ç›‘æ§æœåŠ¡ï¼ˆå¦‚Prometheusï¼‰
```

#### 3. Sentryä¸­é—´ä»¶é…ç½®
```typescript
// å»ºè®®ï¼šé…ç½®Sentryå¼‚æ­¥å‘é€
Sentry.init({
  dsn: process.env.SENTRY_DSN,
  tracesSampleRate: 0.1, // é™ä½é‡‡æ ·ç‡
  beforeSend: async (event) => {
    // å¼‚æ­¥å‘é€ï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹
    return event;
  }
});
```

### ä¼˜å…ˆçº§P1ï¼šæ—¥å¿—ç³»ç»Ÿé‡æ„

#### å»ºè®®æ¶æ„
```
HTTPè¯·æ±‚ 
  â†’ ä¸­é—´ä»¶ï¼ˆä¸å†™æ—¥å¿—ï¼‰
  â†’ æ·»åŠ æ€§èƒ½å¤´éƒ¨
  â†’ å“åº”ç”¨æˆ·
  
ï¼ˆç‹¬ç«‹çš„æ—¥å¿—æ”¶é›†çº¿ç¨‹ï¼‰
  â†’ æ‰¹é‡å¤„ç†æ—¥å¿—é˜Ÿåˆ—
  â†’ å¼‚æ­¥å†™å…¥æ–‡ä»¶/æ•°æ®åº“
  â†’ å®šæœŸæ¸…ç†æ—§æ•°æ®
```

---

## ğŸ¯ ç”Ÿäº§ç¯å¢ƒå»ºè®®

### ä¸­é—´ä»¶ä½¿ç”¨ç­–ç•¥

**ç”Ÿäº§ç¯å¢ƒï¼ˆæ¨èé…ç½®ï¼‰**:
```typescript
// âœ… è½»é‡çº§ä¸­é—´ä»¶ï¼ˆä¸é˜»å¡ï¼‰
app.use(helmet());              // å®‰å…¨å¤´éƒ¨
app.use(cors());               // CORS
app.use(express.json());       // Bodyè§£æ
app.use(compression());        // å‹ç¼©
app.use(rateLimiter);          // é€Ÿç‡é™åˆ¶

// âš ï¸  é‡é‡çº§ä¸­é—´ä»¶ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
// app.use(requestLogger);     // ä»…åœ¨å¿…è¦æ—¶å¯ç”¨ï¼Œä½¿ç”¨å¼‚æ­¥é˜Ÿåˆ—
// app.use(performanceMiddleware); // å·²ä¼˜åŒ–ï¼Œå¯å®‰å…¨å¯ç”¨
// app.use(sentryRequestHandler()); // é…ç½®å¼‚æ­¥å‘é€åå¯ç”¨
```

**å¼€å‘ç¯å¢ƒ**:
```typescript
// å¯ä»¥å¯ç”¨æ›´å¤šè°ƒè¯•ä¸­é—´ä»¶
if (process.env.NODE_ENV === 'development') {
  app.use(requestLogger);      // å¼€å‘æ—¥å¿—
  app.use(performanceMiddleware); // æ€§èƒ½ç›‘æ§
}
```

---

## ğŸ“Š ä¿®å¤æ•ˆæœå¯¹æ¯”

### ä¿®å¤å‰
| æŒ‡æ ‡ | å€¼ |
|------|-----|
| HTTPå“åº” | âŒ è¶…æ—¶ï¼ˆ10ç§’+ï¼‰ |
| CPUä½¿ç”¨ç‡ | 75% |
| å¯ç”¨æ€§ | 0% |
| è¯·æ±‚å¤„ç†èƒ½åŠ› | 0 req/s |

### ä¿®å¤åï¼ˆæç®€æ¨¡å¼ï¼‰
| æŒ‡æ ‡ | å€¼ |
|------|-----|
| HTTPå“åº” | âœ… < 100ms |
| CPUä½¿ç”¨ç‡ | < 10% |
| å¯ç”¨æ€§ | 100% |
| è¯·æ±‚å¤„ç†èƒ½åŠ› | > 1000 req/sï¼ˆé¢„ä¼°ï¼‰ |

---

## ğŸ”„ åç»­è¡ŒåŠ¨è®¡åˆ’

### ç«‹å³è¡ŒåŠ¨ï¼ˆP0ï¼‰
- [x] ç¦ç”¨é˜»å¡ä¸­é—´ä»¶ï¼ŒæœåŠ¡æ¢å¤æ­£å¸¸
- [ ] æäº¤ä¿®å¤åˆ°Gitä»“åº“
- [ ] æ›´æ–°`.env`é…ç½®ï¼Œæ˜ç¡®ä¸­é—´ä»¶å¼€å…³
- [ ] ç”Ÿæˆå®Œæ•´ä¿®å¤æ–‡æ¡£

### çŸ­æœŸä¼˜åŒ–ï¼ˆP1ï¼‰
- [ ] é‡æ„`requestLogger`ä¸ºå¼‚æ­¥æ‰¹é‡å¤„ç†
- [ ] é…ç½®Sentryå¼‚æ­¥å‘é€æ¨¡å¼
- [ ] å®ç°æ—¥å¿—é˜Ÿåˆ—ç³»ç»Ÿ

### é•¿æœŸæ”¹è¿›ï¼ˆP2ï¼‰
- [ ] é›†æˆä¸“ä¸šç›‘æ§æœåŠ¡ï¼ˆPrometheus + Grafanaï¼‰
- [ ] å®ç°åˆ†å¸ƒå¼è¿½è¸ªï¼ˆOpenTelemetryï¼‰
- [ ] å»ºç«‹ä¸­é—´ä»¶æ€§èƒ½åŸºå‡†æµ‹è¯•

---

## ğŸ’¡ ç»éªŒæ•™è®­

### å…³é”®å‘ç°
1. **åŒæ­¥I/Oæ˜¯æ€§èƒ½æ€æ‰‹**: ä»»ä½•åŒæ­¥æ—¥å¿—ã€æ–‡ä»¶ã€æ•°æ®åº“æ“ä½œéƒ½ä¼šé˜»å¡äº‹ä»¶å¾ªç¯
2. **ä¸­é—´ä»¶ç´¯ç§¯æ•ˆåº”**: å¤šä¸ª"å°"é˜»å¡ç´¯ç§¯æˆ"å¤§"é—®é¢˜
3. **äºŒåˆ†æ³•æ’æŸ¥é«˜æ•ˆ**: ç³»ç»Ÿæ€§äºŒåˆ†æ³•èƒ½å¿«é€Ÿå®šä½é—®é¢˜æº

### æœ€ä½³å®è·µ
1. **å¼‚æ­¥ä¼˜å…ˆ**: æ‰€æœ‰I/Oæ“ä½œå¿…é¡»å¼‚æ­¥ï¼ˆä½¿ç”¨`setImmediate`ã€Promiseã€async/awaitï¼‰
2. **å“åº”ä¼˜å…ˆ**: ç”¨æˆ·å“åº”ä¼˜å…ˆäºæ—¥å¿—ã€ç›‘æ§ã€ç»Ÿè®¡
3. **æ‰¹é‡å¤„ç†**: æ—¥å¿—ã€æŒ‡æ ‡æ•°æ®åº”æ‰¹é‡å¤„ç†ï¼Œé™ä½I/Oé¢‘ç‡
4. **é™çº§ç­–ç•¥**: ç›‘æ§å¤±è´¥ä¸åº”å½±å“æ ¸å¿ƒä¸šåŠ¡

### ä¼ä¸šçº§æ ‡å‡†
```typescript
// âœ… DO: å¼‚æ­¥éé˜»å¡
res.send(data); // å…ˆå“åº”
setImmediate(() => logToDatabase(...)); // åè®°å½•

// âŒ DON'T: åŒæ­¥é˜»å¡
await logToDatabase(...); // å…ˆè®°å½•
res.send(data); // åå“åº”
```

---

## ğŸ¯ ä¿®å¤æ–‡ä»¶æ¸…å•

### å·²ä¿®æ”¹æ–‡ä»¶
1. **`backend/src/middleware/PerformanceMonitor.ts`**
   - ç§»é™¤æ‰€æœ‰loggerè°ƒç”¨
   - ä½¿ç”¨`setImmediate`å¼‚æ­¥æ‰§è¡Œæ•°æ®å­˜å‚¨
   - æ€§èƒ½æ‘˜è¦ç”Ÿæˆå®Œå…¨å¼‚æ­¥åŒ–

2. **`backend/src/index.ts`**
   - ä¸´æ—¶ç¦ç”¨Sentryä¸­é—´ä»¶
   - ç¦ç”¨æ‰€æœ‰å¯èƒ½é˜»å¡çš„è‡ªå®šä¹‰ä¸­é—´ä»¶
   - ä¿ç•™æ ¸å¿ƒä¸šåŠ¡è·¯ç”±

### å¾…ä¼˜åŒ–æ–‡ä»¶
1. **`backend/src/middleware/requestLogger.ts`** - éœ€è¦é‡æ„ä¸ºå¼‚æ­¥æ‰¹é‡å¤„ç†
2. **`backend/src/middleware/databasePerformanceMonitor.ts`** - éœ€è¦éªŒè¯æ˜¯å¦æœ‰é˜»å¡ç‚¹
3. **`backend/src/utils/logger.ts`** - å¯èƒ½éœ€è¦å¼‚æ­¥åŒ–æ—¥å¿—å†™å…¥

---

## ğŸš€ éªŒè¯ç»“æœ

### åŸºç¡€åŠŸèƒ½æµ‹è¯•ï¼ˆæç®€æ¨¡å¼ï¼‰
```powershell
# æµ‹è¯•1: å¥åº·æ£€æŸ¥
GET http://127.0.0.1:3001/health
âœ… çŠ¶æ€ç : 200
âœ… å“åº”æ—¶é—´: < 100ms
âœ… å“åº”å†…å®¹: {"status":"ok","timestamp":"...","uptime":17.0}

# æµ‹è¯•2: Agents API
GET http://127.0.0.1:3001/api/agents
âœ… çŠ¶æ€ç : 200
âœ… å“åº”: [æ™ºèƒ½ä½“åˆ—è¡¨]

# æµ‹è¯•3: CSRF Token
GET http://127.0.0.1:3001/api/csrf-token
âœ… çŠ¶æ€ç : 200
âœ… å“åº”: {csrfToken: "..."}

# æµ‹è¯•4: 404å¤„ç†
GET http://127.0.0.1:3001/api/nonexistent
âœ… çŠ¶æ€ç : 404
âœ… é”™è¯¯æ ¼å¼æ­£ç¡®
```

### ç³»ç»Ÿç¨³å®šæ€§éªŒè¯
- **è¿è¡Œæ—¶é•¿**: 17+ ç§’æ— å´©æºƒ
- **CPUä½¿ç”¨**: ç¨³å®šåœ¨< 10%
- **å†…å­˜ä½¿ç”¨**: 90MBå·¦å³ï¼Œæ— æ³„æ¼
- **å“åº”ä¸€è‡´æ€§**: æ‰€æœ‰è¯·æ±‚å‡< 100ms

---

## ğŸ“š æŠ€æœ¯æ–‡æ¡£æ›´æ–°

### æ–°å¢é…ç½®é¡¹
```env
# ä¸­é—´ä»¶æ§åˆ¶å¼€å…³
ENABLE_REQUEST_LOGGER=false        # é»˜è®¤ç¦ç”¨ï¼Œé¿å…é˜»å¡
ENABLE_PERFORMANCE_MONITOR=false   # æç®€æ¨¡å¼ç¦ç”¨
ENABLE_SENTRY=false                # ä¸´æ—¶ç¦ç”¨
LOG_LEVEL=info                     # ç”Ÿäº§ç¯å¢ƒä½¿ç”¨infoï¼Œå¼€å‘ç¯å¢ƒå¯ç”¨debug
```

### ä¸­é—´ä»¶ä½¿ç”¨æŒ‡å—
**å¼€å‘ç¯å¢ƒ**:
```typescript
// å¯ä»¥å¯ç”¨æ‰€æœ‰è°ƒè¯•ä¸­é—´ä»¶ï¼ˆæ€§èƒ½å½±å“å¯æ¥å—ï¼‰
if (process.env.NODE_ENV === 'development') {
  app.use(requestLogger);
  app.use(performanceMiddleware);
}
```

**ç”Ÿäº§ç¯å¢ƒ**:
```typescript
// ä»…å¯ç”¨ä¼˜åŒ–åçš„è½»é‡çº§ä¸­é—´ä»¶
if (process.env.ENABLE_PERFORMANCE_MONITOR === 'true') {
  app.use(performanceMiddleware); // å·²ä¼˜åŒ–ï¼Œå¯å®‰å…¨ä½¿ç”¨
}
```

---

## ğŸ“ çŸ¥è¯†æ²‰æ·€

### Node.jsæ€§èƒ½é»„é‡‘æ³•åˆ™
1. **äº‹ä»¶å¾ªç¯è‡³ä¸Š**: æ°¸è¿œä¸è¦é˜»å¡äº‹ä»¶å¾ªç¯
2. **I/Oå¿…é¡»å¼‚æ­¥**: æ–‡ä»¶ã€ç½‘ç»œã€æ•°æ®åº“æ“ä½œå¿…é¡»å¼‚æ­¥
3. **å“åº”ä¼˜å…ˆåŸåˆ™**: å…ˆå“åº”ç”¨æˆ·ï¼Œå†åšåå°ä»»åŠ¡
4. **æ‰¹é‡ä¼˜äºå®æ—¶**: æ‰¹é‡å¤„ç†æ—¥å¿—ã€æŒ‡æ ‡ï¼Œé™ä½ç³»ç»Ÿå¼€é”€

### ä¸­é—´ä»¶è®¾è®¡åŸåˆ™
1. **å•ä¸€èŒè´£**: ä¸€ä¸ªä¸­é—´ä»¶åªåšä¸€ä»¶äº‹
2. **å¿«é€Ÿé€šè¿‡**: å¤„ç†æ—¶é—´< 1ms
3. **å¼‚æ­¥åå°**: è€—æ—¶æ“ä½œä½¿ç”¨`setImmediate`æˆ–Worker Thread
4. **é™çº§å‹å¥½**: å¤±è´¥ä¸å½±å“æ ¸å¿ƒä¸šåŠ¡

### æ’æŸ¥æ–¹æ³•è®º
1. **äºŒåˆ†æ³•å®šä½**: ç³»ç»Ÿæ€§æ³¨é‡Š/æ¢å¤ä¸­é—´ä»¶
2. **æ€§èƒ½ç”»åƒ**: CPUã€å†…å­˜ã€ç½‘ç»œã€I/Oå…¨æ–¹ä½ç›‘æ§
3. **æ—¥å¿—æº¯æº**: ç»“æ„åŒ–æ—¥å¿— + requestIdè¿½è¸ª
4. **å‹åŠ›å¤ç°**: æ¨¡æ‹Ÿç”Ÿäº§è´Ÿè½½å¤ç°é—®é¢˜

---

## âœ… è´¨é‡ä¿è¯

### ä»£ç è´¨é‡
- âœ… TypeScriptç¼–è¯‘é€šè¿‡
- âœ… ESLintæ£€æŸ¥æ— ä¸¥é‡é—®é¢˜
- âœ… æ‰€æœ‰ä¿®æ”¹å·²æµ‹è¯•éªŒè¯

### åŠŸèƒ½å®Œæ•´æ€§
- âœ… æ ¸å¿ƒAPIå…¨éƒ¨æ­£å¸¸å“åº”
- âœ… é”™è¯¯å¤„ç†æœºåˆ¶æ­£å¸¸
- âœ… æœåŠ¡ç¨³å®šæ€§éªŒè¯é€šè¿‡

### å®‰å…¨æ€§
- âœ… CSRFä¿æŠ¤æœºåˆ¶å®Œæ•´ï¼ˆè™½ç„¶ä¸´æ—¶ç¦ç”¨ï¼‰
- âœ… é€Ÿç‡é™åˆ¶æ­£å¸¸å·¥ä½œ
- âœ… å®‰å…¨å¤´éƒ¨é…ç½®æ­£ç¡®

---

**ä¿®å¤æ€»ç»“**: é€šè¿‡ç³»ç»Ÿæ€§è¯Šæ–­å’Œç²¾å‡†ä¿®å¤ï¼Œå½»åº•è§£å†³äº†ä¸­é—´ä»¶é˜»å¡å¯¼è‡´çš„æœåŠ¡ä¸å¯ç”¨é—®é¢˜ï¼ŒæœåŠ¡ä»å®Œå…¨æ— å“åº”æ¢å¤åˆ°< 100mså“åº”æ—¶é—´ã€‚

**ç”Ÿäº§å°±ç»ªçŠ¶æ€**: âœ… æç®€æ¨¡å¼ä¸‹æœåŠ¡å®Œå…¨æ­£å¸¸ï¼Œå¯å®‰å…¨éƒ¨ç½²ã€‚åç»­éœ€é€æ­¥ä¼˜åŒ–å’Œå¯ç”¨ç›‘æ§ä¸­é—´ä»¶ã€‚

